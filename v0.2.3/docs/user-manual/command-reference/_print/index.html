<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.1" /><link rel="canonical" type="text/html" href="../../../../docs/user-manual/command-reference/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="../../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../../favicons/android-192x192.png" sizes="192x192">

<title>Command reference | Dataset Management Framework</title>
<meta name="description" content=""><meta property="og:title" content="Command reference" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/user-manual/command-reference/" /><meta property="og:site_name" content="Dataset Management Framework" />

<meta itemprop="name" content="Command reference">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Command reference"/>
<meta name="twitter:description" content=""/>




<link rel="preload" href="../../../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" as="style">
<link href="../../../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" rel="stylesheet" integrity="">


<script
  src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>






<link rel="stylesheet" href="../../../../css/prism.css"/>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="../../../../docs">
    <span class="navbar-logo"></span><span class="font-weight-bold">Dataset Management Framework</span>
  </a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      
      
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          
          
          
          
          
          
          <a class="nav-link" href="https://github.com/openvinotoolkit/datumaro"  ><i class='fab fa-github'></i><span>GitHub</span></a>
        </li>
      
        <li class="nav-item mr-4 mb-2 mb-lg-0" id="api">
          <a class="nav-link" href="../../../../api">API documentation</a>
        </li>
      
        <li class="nav-item dropdown mr-4 d-lg-block">
          

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  v0.2.3
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
  
    
      <a class="dropdown-item" href="../../../../../docs/user-manual/command-reference/">develop</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.1.11/docs/user-manual/command-reference/">v0.1.11</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2/docs/user-manual/command-reference/">v0.2</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.1/docs/user-manual/command-reference/">v0.2.1</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.2/docs/user-manual/command-reference/">v0.2.2</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.3/docs/user-manual/command-reference/">v0.2.3</a>
  
</div>

        </li>
      
      
    </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../../../offline-search-index.fda43915d68e3d768e0a8b704aca5fa2.json"
  data-offline-search-base-href="../../../../"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../../docs/user-manual/command-reference/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Command reference</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-a343cd09a10c892413f1c9e19af35d61">Convert datasets</a></li>


    
  
    
    
	
<li>2: <a href="#pg-77963f24abb4e1f7e8cb372f0cf73ad7">Download datasets</a></li>


    
  
    
    
	
<li>3: <a href="#pg-4cdc48f6e2e41c6dd35af61e5748ac77">Create project</a></li>


    
  
    
    
	
<li>4: <a href="#pg-bf2416754f5a95167671095e620607d7">Export Datasets</a></li>


    
  
    
    
	
<li>5: <a href="#pg-fb79096cff317cd3a11940138d12144a">Filter datasets</a></li>


    
  
    
    
	
<li>6: <a href="#pg-6758bfd1eb71e4d0b6c4bf4aca1806f1">Merge Datasets</a></li>


    
  
    
    
	
<li>7: <a href="#pg-160c03d29dec976c331bb969c9551cf4">Patch Datasets</a></li>


    
  
    
    
	
<li>8: <a href="#pg-cf615af9fbd176c3c8963db17cdccfec">Compare datasets</a></li>


    
  
    
    
	
<li>9: <a href="#pg-08529e9683af8c1a879605b62306ea7a">Print dataset info</a></li>


    
  
    
    
	
<li>10: <a href="#pg-645d2da4c36696ec093ba5e3ce99c77c">Get Project Statistics</a></li>


    
  
    
    
	
<li>11: <a href="#pg-a6fd93528e84d29a5a0d58dbccb92724">Validate Dataset</a></li>


    
  
    
    
	
<li>12: <a href="#pg-6c14c8898a52d18d0040b216c7faf6a6">Commit</a></li>


    
  
    
    
	
<li>13: <a href="#pg-86897105a5f038a99bfe0935866c69ce">Transform Dataset</a></li>


    
  
    
    
	
<li>14: <a href="#pg-70c651cad336e515180a9b8eed13f292">Checkout</a></li>


    
  
    
    
	
<li>15: <a href="#pg-a818e6c810d9d8ef27c2b0f440145895">Status</a></li>


    
  
    
    
	
<li>16: <a href="#pg-209bf2b1793403ac2d9c18c87a7dab54">Log</a></li>


    
  
    
    
	
<li>17: <a href="#pg-5a841ebe671810e701d94cfd348da645">Run model inference explanation (explain)</a></li>


    
  
    
    
	
<li>18: <a href="#pg-db2ab356420634e305b5ea0550f9b9c3">Models</a></li>


    
  
    
    
	
<li>19: <a href="#pg-dc182af461d71cbd7217b8679bde29bc">Sources</a></li>


    
  
    
    
	
<li>20: <a href="#pg-49c04c4e75f0995ee1c9c4c121d042c7">Projects</a></li>


    
  

    </ul>


<div class="content">
      <div class="text-center large-scheme-two">
<pre><code class="language-mermaid" data-lang="mermaid">%%{init { 'theme':'neutral' }}%%
flowchart LR
  d((&quot;#0009; datum #0009;&quot;)):::mainclass
  s(source):::nofillclass
  m(model):::nofillclass
  p(project):::nofillclass

  d===s
    s===id1[add]:::hideclass
    s===id2[remove]:::hideclass
    s===id3[info]:::hideclass
  d===m
    m===id4[add]:::hideclass
    m===id5[remove]:::hideclass
    m===id6[run]:::hideclass
    m===id7[info]:::hideclass
  d===p
    p===migrate:::hideclass
    p===info:::hideclass
  d====str1[create]:::filloneclass
  d====str1[download]:::filloneclass
  d====str2[import]:::filloneclass
  d====str3[export]:::filloneclass
  d====str4[add]:::filloneclass
  d====str5[remove]:::filloneclass
  d====str6[info]:::filloneclass
  d====str7[transform]:::filltwoclass
  d====str8[filter]:::filltwoclass
  d====str9[diff]:::fillthreeclass
  d====str10[merge]:::fillthreeclass
  d====str11[patch]:::fillthreeclass
  d====str12[validate]:::fillthreeclass
  d====str13[explain]:::fillthreeclass
  d====str14[stats]:::fillthreeclass
  d====str15[commit]:::fillfourclass
  d====str16[checkout]:::fillfourclass
  d====str17[status]:::fillfourclass
  d====str18[log]:::fillfourclass

  classDef nofillclass fill-opacity:0;
  classDef hideclass fill-opacity:0,stroke-opacity:0;
  classDef filloneclass fill:#CCCCFF,stroke-opacity:0;
  classDef filltwoclass fill:#FFFF99,stroke-opacity:0;
  classDef fillthreeclass fill:#CCFFFF,stroke-opacity:0;
  classDef fillfourclass fill:#CCFFCC,stroke-opacity:0;
</code></pre></div>
<p>The command line is split into the separate <em>commands</em> and command <em>contexts</em>.
Contexts group multiple commands related to a specific topic, e.g.
project operations, data source operations etc. Almost all the commands
operate on projects, so the <code>project</code> context and commands without a context
are mostly the same. By default, commands look for a project in the current
directory. If the project you&rsquo;re working on is located somewhere else, you
can pass the <code>-p/--project &lt;path&gt;</code> argument to the command.</p>
<blockquote>
<p><strong>Note</strong>: command behavior is subject to change, so this text might be
outdated,
<strong>always check the <code>--help</code> output of the specific command</strong></p>
</blockquote>
<blockquote>
<p><strong>Note</strong>: command parameters must be passed prior to the positional arguments.</p>
</blockquote>
<p>Datumaro functionality is available with the <code>datum</code> command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--version<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--loglevel LOGLEVEL<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>command<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#204a87">command</span> args<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>--loglevel</code> (string) - Logging level, one of
<code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code>, <code>critical</code> (default: <code>info</code>)</li>
<li><code>--version</code> - Print the version number and exit.</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a343cd09a10c892413f1c9e19af35d61">1 - Convert datasets</h1>
    
	<p>This command allows to convert a dataset from one format to another.
The command is a usability alias for <a href="../create"><code>create</code></a>,
<a href="../sources/#sources-add"><code>add</code></a> and <a href="../export"><code>export</code></a> and just provides
a simpler way to obtain the same results in simple cases. A list of supported
formats can be found in the <code>--help</code> output of this command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-i SOURCE<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-if INPUT_FORMAT<span style="color:#ce5c00;font-weight:bold">]</span> -f OUTPUT_FORMAT
  <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-e FILTER<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--filter-mode FILTER_MODE<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_EXPORT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-i, --input-path</code> (string) - Input dataset path. The current directory is
used by default.</li>
<li><code>-if, --input-format</code> (string) - Input dataset format. Will try to detect,
if not specified.</li>
<li><code>-f, --output-format</code> (string) - Output format</li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, a subdirectory
in the current directory is used.</li>
<li><code>--overwrite</code> - Allows overwriting existing files in the output directory,
when it is not empty.</li>
<li><code>-e, --filter</code> (string) - XML XPath filter expression for dataset items</li>
<li><code>--filter-mode</code> (string) - The filtering mode. Default is the <code>i</code> mode.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;extra export args&gt;</code> - Additional arguments for the format writer
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: convert a VOC-like dataset to a COCO-like one:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --input-format voc --input-path &lt;path/to/voc/&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format coco <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              -- --save-images
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-77963f24abb4e1f7e8cb372f0cf73ad7">2 - Download datasets</h1>
    
	<p>This command downloads a publicly available dataset and saves it to a local
directory.
In terms of syntax, this command is similar to <a href="../convert"><code>convert</code></a>,
but instead of taking a local directory as the source, it takes a dataset ID.
A list of supported datasets and output formats can be found in the <code>--help</code>
output of this command.</p>
<p>Currently, the only source of datasets is the TensorFlow Datasets library.
Therefore, to use this command you must install TensorFlow &amp; TFDS, which you can
do as follows:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install datumaro<span style="color:#ce5c00;font-weight:bold">[</span>tf,tfds<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>To use a proxy for downloading, configure it with the conventional
<a href="https://everything.curl.dev/usingcurl/proxies/env">curl environment variables</a>.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum download <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -i DATASET_ID <span style="color:#ce5c00;font-weight:bold">[</span>-f OUTPUT_FORMAT<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_EXPORT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-h</code>, <code>--help</code> - Print the help message and exit.</li>
<li><code>-i</code>, <code>--dataset-id</code> (string) - ID of the dataset to download.</li>
<li><code>-f</code>, <code>--output-format</code> (string) - Output format. By default, the format
of the original dataset is used.</li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, a subdirectory
in the current directory is used.</li>
<li><code>--overwrite</code> - Allows overwriting existing files in the output directory,
when it is not empty.</li>
<li><code>-- &lt;extra export args&gt;</code> - Additional arguments for the format writer
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: download the MNIST dataset, saving it in the ImageNet text format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum download -i tfds:mnist -f imagenet_txt -- --save-images
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4cdc48f6e2e41c6dd35af61e5748ac77">3 - Create project</h1>
    
	<p>The command creates an empty project. A project is required for the most of
Datumaro functionality.</p>
<p>By default, the project is created in the current directory. To specify
another output directory, pass the <code>-o/--output-dir</code> parameter. If output
already directory contains a Datumaro project, an error is raised, unless
<code>--overwrite</code> is used.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-o, --output-dir</code> (string) - Allows to specify an output directory.
The current directory is used by default.</li>
<li><code>--overwrite</code> - Allows to overwrite existing project files in the output
directory. Any other files are not touched.</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Examples:</p>
<p>Example: create an empty project in the <code>my_dataset</code> directory</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o my_dataset/
</code></pre></div><p>Example: create a new empty project in the current directory, remove the
existing one</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
...
datum create --overwrite
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bf2416754f5a95167671095e620607d7">4 - Export Datasets</h1>
    
	<p>This command exports a project or a source as a dataset in some format.</p>
<p>Check <a href="../../../../docs/user-manual/supported_formats">supported formats</a> for more info
about format specifications, supported options and other details.
The list of formats can be extended by custom plugins, check <a href="../../../../docs/user-manual/extending">extending tips</a>
for information on this topic.</p>
<p>Available formats are listed in the command help output.</p>
<p>Dataset format writers support additional export options. To pass
such options, use the <code>--</code> separator after the main command arguments.
The usage information can be printed with <code>datum import -f &lt;format&gt; -- --help</code>.</p>
<p>Common export options:</p>
<ul>
<li>Most formats (where applicable) support the <code>--save-images</code> option, which
allows to export dataset images along with annotations. The option is
disabled be default.</li>
<li>If <code>--save-images</code> is used, the <code>image-ext</code> option can be passed to
specify the output image file extension (<code>.jpg</code>, <code>.png</code> etc.). By default,
tries to Datumaro keep the original image extension. This option
allows to convert all the images from one format into another.</li>
</ul>
<p>This command allows to use the <code>-f/--filter</code> parameter to select dataset
elements needed for exporting. Read the <a href="../../../../docs/user-manual/command-reference/filter/"><code>filter</code></a> command
description for more info about this functionality.</p>
<p>The command can only be applied to a project build target, a stage
or the combined <code>project</code> target, in which case all the targets will
be affected.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-e FILTER<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--filter-mode FILTER_MODE<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> -f FORMAT <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_FORMAT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - A project build target to be exported.
By default, all project targets are affected.</li>
<li><code>-f, --format</code> (string) - Output format.</li>
<li><code>-e, --filter</code> (string) - XML XPath filter expression for dataset items</li>
<li><code>--filter-mode</code> (string) - The filtering mode. Default is the <code>i</code> mode.</li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, a subdirectory
in the current directory is used.</li>
<li><code>--overwrite</code> - Allows overwriting existing files in the output directory,
when it is not empty.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;extra format args&gt;</code> - Additional arguments for the format writer
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: save a project as a VOC-like dataset, include images, convert
images to <code>PNG</code> from other formats.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -o test_project-export <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -f voc <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -- --save-images --image-ext<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.png&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fb79096cff317cd3a11940138d12144a">5 - Filter datasets</h1>
    
	<p>This command allows to extract a sub-dataset from a dataset. The new dataset
includes only items satisfying some condition. The XML <a href="https://devhints.io/xpath">XPath</a>
is used as a query format.</p>
<p>The command can be applied to a dataset or a project build target,
a stage or the combined <code>project</code> target, in which case all the project
targets will be affected. A build tree stage will be recorded
if <code>--stage</code> is enabled, and the resulting dataset(-s) will be
saved if <code>--apply</code> is enabled.</p>
<p>By default, datasets are updated in-place. The <code>-o/--output-dir</code>
option can be used to specify another output directory. When
updating in-place, use the <code>--overwrite</code> parameter (in-place
updates fail by default to prevent data loss), unless a project
target is modified.</p>
<p>The current project (<code>-p/--project</code>) is also used as a context for
plugins, so it can be useful for dataset paths having custom formats.
When not specified, the current project&rsquo;s working tree is used.</p>
<p>There are several filtering modes available (the <code>-m/--mode</code> parameter).
Supported modes:</p>
<ul>
<li><code>i</code>, <code>items</code></li>
<li><code>a</code>, <code>annotations</code></li>
<li><code>i+a</code>, <code>a+i</code>, <code>items+annotations</code>, <code>annotations+items</code></li>
</ul>
<p>When filtering annotations, use the <code>items+annotations</code>
mode to point that annotation-less dataset items should be
removed, otherwise they will be kept in the resulting dataset.
To select an annotation, write an XPath that returns <code>annotation</code>
elements (see examples).</p>
<p>Item representations can be printed with the <code>--dry-run</code> parameter:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#204a87;font-weight:bold">&lt;item&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>290768<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;subset&gt;</span>minival2014<span style="color:#204a87;font-weight:bold">&lt;/subset&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;image&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;width&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/width&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;height&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/height&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;depth&gt;</span>3<span style="color:#204a87;font-weight:bold">&lt;/depth&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/image&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>80154<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>39<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>264.59<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>150.25<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>11.19<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>42.31<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>473.87<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>669839<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>41<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>163.58<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>191.75<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>76.98<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>73.63<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>5668.77<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  ...
<span style="color:#204a87;font-weight:bold">&lt;/item&gt;</span>
</code></pre></div><p>The command can only be applied to a project build target, a stage or the
combined <code>project</code> target, in which case all the targets will be affected.
A build tree stage will be added if <code>--stage</code> is enabled, and the resulting
dataset(-s) will be saved if <code>--apply</code> is enabled.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-e FILTER<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-m MODE<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--dry-run<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--stage STAGE<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--apply APPLY<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target
<a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a>.
By default, filters all targets of the current project.</li>
<li><code>-e, --filter</code> (string) - XML XPath filter expression for dataset items</li>
<li><code>-m, --mode</code> (string) - The filtering mode. Default is the <code>i</code> mode.</li>
<li><code>--dry-run</code> - Print XML representations of the filtered dataset and exit.</li>
<li><code>--stage</code> (bool) - Include this action as a project build step.
If true, this operation will be saved in the project
build tree, allowing to reproduce the resulting dataset later.
Applicable only to main project targets (i.e. data sources
and the <code>project</code> target, but not intermediate stages). Enabled by default.</li>
<li><code>--apply</code> (bool) - Run this command immediately. If disabled, only the
build tree stage will be written. Enabled by default.</li>
<li><code>-o, --output-dir</code> (string) - Output directory. Can be omitted for
main project targets (i.e. data sources and the <code>project</code> target, but not
intermediate stages) and dataset targets. If not specified, the results
will be saved inplace.</li>
<li><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is specified and is not empty.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example: extract a dataset with images with <code>width</code> &lt; <code>height</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#39;/item[image/width &lt; image/height]&#39;</span>
</code></pre></div><p>Example: extract a dataset with images of the <code>train</code> subset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#39;/item[subset=&#34;train&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only large annotations of the <code>cat</code> class and
any non-<code>persons</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --mode annotations <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#39;/item/annotation[(label=&#34;cat&#34; and area &gt; 99.5) or label!=&#34;person&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with non-occluded annotations, remove empty images.
Use data only from the &ldquo;s1&rdquo; source of the project.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum import --format voc -i &lt;path/to/dataset1/&gt; --name s1
datum import --format voc -i &lt;path/to/dataset2/&gt; --name s2
datum filter s1 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m i+a -e <span style="color:#4e9a06">&#39;/item/annotation[occluded=&#34;False&#34;]&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6758bfd1eb71e4d0b6c4bf4aca1806f1">6 - Merge Datasets</h1>
    
	<p>Consider the following task: there is a set of images (the original dataset)
we want to annotate. Suppose we did this manually and/or automated it
using models, and now we have few sets of annotations for the same images.
We want to merge them and produce a single set of high-precision annotations.</p>
<p>Another use case: there are few datasets with different sets of images
and labels, which we need to combine in a single dataset. If the labels
were the same, we could just join the datasets. But in this case we need
to merge labels and adjust the annotations in the resulting dataset.</p>
<p>In Datumaro, it can be done with the <code>merge</code> command. This command merges 2
or more datasets and checks annotations for errors.</p>
<blockquote>
<p>In simple cases, when dataset images do not intersect and new
labels are not added, the recommended way of merging is using
<a href="../../../../docs/user-manual/command-reference/patch/">the <code>patch</code> command</a>.
It will offer better performance and provide the same results.</p>
</blockquote>
<p>Datasets are merged by items, and item annotations are merged by finding the
unique ones across datasets. Annotations are matched between matching dataset
items by distance. Spatial annotations are compared by the applicable distance
measure (IoU, OKS, PDJ etc.), labels and annotation attributes are selected
by voting. Each set of matching annotations produces a single annotation in
the resulting dataset. The <code>score</code> (a number in the range [0; 1]) attribute
indicates the agreement between different sources in the produced annotation.
The working time of the function can be estimated as
<code>O( (summary dataset length) * (dataset count) ^ 2 * (item annotations) ^ 2 )</code></p>
<p>This command also allows to merge datasets with different, or partially
overlapping sets of labels (which is impossible by simple joining).</p>
<p>During the process, some merge conflicts can appear. For example,
it can be mismatching dataset images having the same ids, label voting
can be unsuccessful if quorum is not reached (the <code>--quorum</code> parameter),
bboxes may be too close (the <code>-iou</code> parameter) etc. Found merge
conflicts, missing items or annotations, and other errors are saved into
an output <code>.json</code> file.</p>
<p>In Datumaro, annotations can be grouped. It can be useful to represent
different parts of a single object - for example, it can be different parts
of a human body, parts of a vehicle etc. This command allows to check
annotation groups for completeness with the <code>-g/--groups</code> option. If used,
this parameter must specify a list of labels for annotations that must be
in the same group. It can be particularly useful to check if separate
keypoints are grouped and all the necessary object components in the same
group.</p>
<p>This command has multiple forms:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">1<span style="color:#ce5c00;font-weight:bold">)</span> datum merge &lt;revpath&gt;
2<span style="color:#ce5c00;font-weight:bold">)</span> datum merge &lt;revpath&gt; &lt;revpath&gt; ...
</code></pre></div><p>&lt;revpath&gt; - either <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">a dataset path or a revision path</a>.</p>
<p>1 - Merges the current project&rsquo;s main target (&ldquo;project&rdquo;)
in the working tree with the specified dataset.</p>
<p>2 - Merges the specified datasets.
Note that the current project is not included in the list of merged
sources automatically.</p>
<p>The command supports passing extra exporting options for the output
dataset. The format can be specified with the <code>-f/--format</code> option.
Extra options should be passed after the main arguments
and after the <code>--</code> separator. Particularly, this is useful to include
images in the output dataset with <code>--save-images</code>.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-iou IOU_THRESH<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-oconf OUTPUT_CONF_THRESH<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--quorum QUORUM<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-g GROUPS<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-f FORMAT<span style="color:#ce5c00;font-weight:bold">]</span>
  target <span style="color:#ce5c00;font-weight:bold">[</span>target ...<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_FORMAT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpaths</a> (repeatable)</li>
<li><code>-iou</code>, <code>--iou-thresh</code> (number) - IoU matching threshold for spatial
annotations (both maximum inter-cluster and pairwise). Default is 0.25.</li>
<li><code>--quorum</code> (number) - Minimum count of votes for a label or attribute
to be counted. Default is 0.</li>
<li><code>-g, --groups</code> (string) - A comma-separated list of label names in
annotation groups to check. The <code>?</code> postfix can be added to a label to
make it optional in the group (repeatable)</li>
<li><code>-oconf</code>, <code>--output-conf-thresh</code> (number) - Confidence threshold for output
annotations to be included in the resulting dataset. Default is 0.</li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, a new directory
is created in the current directory.</li>
<li><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is specified and is not empty.</li>
<li><code>-f, --format</code> (string) - Output format. The default format is <code>datumaro</code>.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;extra format args&gt;</code> - Additional arguments for the format writer
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Examples:</p>
<p>Merge 4 (partially-)intersecting projects,</p>
<ul>
<li>consider voting successful when there are no less than 3 same votes</li>
<li>consider shapes intersecting when IoU &gt;= 0.6</li>
<li>check annotation groups to have <code>person</code>, <code>hand</code>, <code>head</code> and <code>foot</code>
(<code>?</code> is used for optional parts)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge project1/ project2/ project3/ project4/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --quorum <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -iou 0.6 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --groups <span style="color:#4e9a06">&#39;person,hand?,head,foot?&#39;</span>
</code></pre></div><p>Merge images and annotations from 2 datasets in COCO format:
<code>datum merge dataset1/:image_dir dataset2/:coco dataset3/:coco</code></p>
<p>Check groups of the merged dataset for consistency:
look for groups consisting of <code>person</code>, <code>hand</code> <code>head</code>, <code>foot</code>
<code>datum merge project1/ project2/ -g 'person,hand?,head,foot?'</code></p>
<p>Merge two datasets, specify formats:
<code>datum merge path/to/dataset1:voc path/to/dataset2:coco</code></p>
<p>Merge the current working tree and a dataset:
<code>datum merge path/to/dataset2:coco</code></p>
<p>Merge a source from a previous revision and a dataset:
<code>datum merge HEAD~2:source-2 path/to/dataset2:yolo</code></p>
<p>Merge datasets and save in different format:
<code>datum merge -f voc dataset1/:yolo path2/:coco -- --save-images</code></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-160c03d29dec976c331bb969c9551cf4">7 - Patch Datasets</h1>
    
	<p>Updates items of the first dataset with items from the second one.</p>
<p>By default, datasets are updated in-place. The <code>-o/--output-dir</code>
option can be used to specify another output directory. When
updating in-place, use the <code>--overwrite</code> parameter along with the
<code>--save-images</code> export option (in-place updates fail by default
to prevent data loss).</p>
<p>Unlike the regular project <a href="../../../../docs/developer_manual/#merging">data source joining</a>,
the datasets are not required to have the same labels. The labels from
the &ldquo;patch&rdquo; dataset are projected onto the labels of the patched dataset,
so only the annotations with the matching labels are used, i.e.
all the annotations having unknown labels are ignored. Currently,
this command doesn&rsquo;t allow to update the label information in the
patched dataset.</p>
<p>The command supports passing extra exporting options for the output
dataset. The extra options should be passed after the main arguments
and after the <code>--</code> separator. Particularly, this is useful to include
images in the output dataset with <code>--save-images</code>.</p>
<p>This command can be applied to the current project targets or
arbitrary datasets outside a project. Note that if the target dataset
is read-only (e.g. if it is a project, stage or a cache entry),
the output directory must be provided.</p>
<p>Usage:</p>
<pre><code>datum patch [-h] [-o DST_DIR] [--overwrite] [-p PROJECT_DIR]
  target patch
  [-- EXPORT_ARGS]
</code></pre><p>&lt;revpath&gt; - either <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">a dataset path or a revision path</a>.</p>
<p>The current project (<code>-p/--project</code>) is also used as a context for
plugins, so it can be useful for dataset paths having custom formats.
When not specified, the current project&rsquo;s working tree is used.</p>
<p>Parameters:</p>
<ul>
<li><code>&lt;target dataset&gt;</code> (string) - Target <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a></li>
<li><code>&lt;patch dataset&gt;</code> (string) - Patch <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a></li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, saves in-place</li>
<li><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is not empty.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;export args&gt;</code> - Additional arguments for the format writer
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Examples:</p>
<ul>
<li>Update a VOC-like dataset with COCO-like annotations:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum patch --overwrite dataset1/:voc dataset2/:coco -- --save-images
</code></pre></div><ul>
<li>Generate a patched dataset, based on a project:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum patch -o patched_proj1/ proj1/ proj2/
</code></pre></div><ul>
<li>Update the &ldquo;source1&rdquo; source in the current project with a dataset:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum patch -p proj/ --overwrite source1 path/to/dataset2:coco
</code></pre></div><ul>
<li>Generate a patched source from a previous revision and a dataset:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum patch -o new_src2/ HEAD~2:source-2 path/to/dataset2:yolo
</code></pre></div><ul>
<li>Update a dataset in a custom format, described in a project plugin:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum patch -p proj/ --overwrite dataset/:my_format dataset2/:coco
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cf615af9fbd176c3c8963db17cdccfec">8 - Compare datasets</h1>
    
	<p>The command compares two datasets and saves the results in the
specified directory. The current project is considered to be
&ldquo;ground truth&rdquo;.</p>
<p>Datasets can be compared using different methods:</p>
<ul>
<li><code>equality</code> - Annotations are compared to be equal</li>
<li><code>distance</code> - A distance metric is used</li>
</ul>
<p>This command has multiple forms:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">1<span style="color:#ce5c00;font-weight:bold">)</span> datum diff &lt;revpath&gt;
2<span style="color:#ce5c00;font-weight:bold">)</span> datum diff &lt;revpath&gt; &lt;revpath&gt;
</code></pre></div><p>1 - Compares the current project&rsquo;s main target (<code>project</code>)
in the working tree with the specified dataset.</p>
<p>2 - Compares two specified datasets.</p>
<p>&lt;revpath&gt; - <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">a dataset path or a revision path</a>.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum diff <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-m METHOD<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--iou-thresh IOU_THRESH<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-f FORMAT<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-iia IGNORE_ITEM_ATTR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-ia IGNORE_ATTR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-if IGNORE_FIELD<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--match-images<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--all<span style="color:#ce5c00;font-weight:bold">]</span>
  first_target <span style="color:#ce5c00;font-weight:bold">[</span>second_target<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li>
<p><code>&lt;target&gt;</code> (string) - Target <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpaths</a></p>
</li>
<li>
<p><code>-m, --method</code> (string) - Comparison method.</p>
</li>
<li>
<p><code>-o, --output-dir</code> (string) - Output directory. By default, a new directory
is created in the current directory.</p>
</li>
<li>
<p><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is specified and is not empty.</p>
</li>
<li>
<p><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</p>
</li>
<li>
<p><code>-h, --help</code> - Print the help message and exit.</p>
</li>
<li>
<p>Distance comparison options:</p>
<ul>
<li><code>--iou-thresh</code> (number) - The IoU threshold for spatial annotations
(default is 0.5).</li>
<li><code>-f, --format</code> (string) - Output format, one of <code>simple</code>
(text files and images) and <code>tensorboard</code> (a TB log directory)</li>
</ul>
</li>
<li>
<p>Equality comparison options:</p>
<ul>
<li><code>-iia, --ignore-item-attr</code> (string) - Ignore an item attribute (repeatable)</li>
<li><code>-ia, --ignore-attr</code> (string) - Ignore an annotation attribute (repeatable)</li>
<li><code>-if, --ignore-field</code> (string) - Ignore an annotation field (repeatable)
Default is <code>id</code> and <code>group</code></li>
<li><code>--match-images</code> - Match dataset items by image pixels instead of ids</li>
<li><code>--all</code> - Include matches in the output. By default, only differences are
printed.</li>
</ul>
</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>Compare two projects by distance, match boxes if IoU &gt; 0.7,
save results to TensorBoard:
<code>datum diff other/project -o diff/ -f tensorboard --iou-thresh 0.7</code></p>
</li>
<li>
<p>Compare two projects for equality, exclude annotation groups
and the <code>is_crowd</code> attribute from comparison:
<code>datum diff other/project/ -if group -ia is_crowd</code></p>
</li>
<li>
<p>Compare two datasets, specify formats:
<code>datum diff path/to/dataset1:voc path/to/dataset2:coco</code></p>
</li>
<li>
<p>Compare the current working tree and a dataset:
<code>datum diff path/to/dataset2:coco</code></p>
</li>
<li>
<p>Compare a source from a previous revision and a dataset:
<code>datum diff HEAD~2:source-2 path/to/dataset2:yolo</code></p>
</li>
<li>
<p>Compare a dataset with model inference</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum transform &lt;...&gt; -o inference
datum diff inference -o diff
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-08529e9683af8c1a879605b62306ea7a">9 - Print dataset info</h1>
    
	<p>This command outputs high level dataset information such as sample count,
categories and subsets.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum info <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--all<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>revpath<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a>.
By default, prints info about the joined <code>project</code> dataset.</li>
<li><code>--all</code> - Print all the information: do not fold long lists of labels etc.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>Print info about a project dataset:
<code>datum info -p test_project/</code></p>
</li>
<li>
<p>Print info about a COCO-like dataset:
<code>datum info path/to/dataset:coco</code></p>
</li>
</ul>
<p>Sample output:</p>
<pre><code>length: 5000
categories: label
  label:
    count: 80
    labels: person, bicycle, car, motorcycle (and 76 more)
subsets: minival2014
  'minival2014':
    length: 5000
    categories: label
      label:
        count: 80
        labels: person, bicycle, car, motorcycle (and 76 more)
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-645d2da4c36696ec093ba5e3ce99c77c">10 - Get Project Statistics</h1>
    
	<p>This command computes various project statistics, such as:</p>
<ul>
<li>image mean and std. dev.</li>
<li>class and attribute balance</li>
<li>mask pixel balance</li>
<li>segment area distribution</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target
<a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">source revpath</a>.
By default, computes statistics of the merged dataset.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats -p test_project
</code></pre></div><p>Sample output:</p>
<details>
<pre><code>{
    &quot;annotations&quot;: {
        &quot;labels&quot;: {
            &quot;attributes&quot;: {
                &quot;gender&quot;: {
                    &quot;count&quot;: 358,
                    &quot;distribution&quot;: {
                        &quot;female&quot;: [
                            149,
                            0.41620111731843573
                        ],
                        &quot;male&quot;: [
                            209,
                            0.5837988826815642
                        ]
                    },
                    &quot;values count&quot;: 2,
                    &quot;values present&quot;: [
                        &quot;female&quot;,
                        &quot;male&quot;
                    ]
                },
                &quot;view&quot;: {
                    &quot;count&quot;: 340,
                    &quot;distribution&quot;: {
                        &quot;__undefined__&quot;: [
                            4,
                            0.011764705882352941
                        ],
                        &quot;front&quot;: [
                            54,
                            0.1588235294117647
                        ],
                        &quot;left&quot;: [
                            14,
                            0.041176470588235294
                        ],
                        &quot;rear&quot;: [
                            235,
                            0.6911764705882353
                        ],
                        &quot;right&quot;: [
                            33,
                            0.09705882352941177
                        ]
                    },
                    &quot;values count&quot;: 5,
                    &quot;values present&quot;: [
                        &quot;__undefined__&quot;,
                        &quot;front&quot;,
                        &quot;left&quot;,
                        &quot;rear&quot;,
                        &quot;right&quot;
                    ]
                }
            },
            &quot;count&quot;: 2038,
            &quot;distribution&quot;: {
                &quot;car&quot;: [
                    340,
                    0.16683022571148184
                ],
                &quot;cyclist&quot;: [
                    194,
                    0.09519136408243375
                ],
                &quot;head&quot;: [
                    354,
                    0.17369970559371933
                ],
                &quot;ignore&quot;: [
                    100,
                    0.04906771344455348
                ],
                &quot;left_hand&quot;: [
                    238,
                    0.11678115799803729
                ],
                &quot;person&quot;: [
                    358,
                    0.17566241413150147
                ],
                &quot;right_hand&quot;: [
                    77,
                    0.037782139352306184
                ],
                &quot;road_arrows&quot;: [
                    326,
                    0.15996074582924436
                ],
                &quot;traffic_sign&quot;: [
                    51,
                    0.025024533856722278
                ]
            }
        },
        &quot;segments&quot;: {
            &quot;area distribution&quot;: [
                {
                    &quot;count&quot;: 1318,
                    &quot;max&quot;: 11425.1,
                    &quot;min&quot;: 0.0,
                    &quot;percent&quot;: 0.9627465303140978
                },
                {
                    &quot;count&quot;: 1,
                    &quot;max&quot;: 22850.2,
                    &quot;min&quot;: 11425.1,
                    &quot;percent&quot;: 0.0007304601899196494
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 34275.3,
                    &quot;min&quot;: 22850.2,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 45700.4,
                    &quot;min&quot;: 34275.3,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 57125.5,
                    &quot;min&quot;: 45700.4,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 68550.6,
                    &quot;min&quot;: 57125.5,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 79975.7,
                    &quot;min&quot;: 68550.6,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 91400.8,
                    &quot;min&quot;: 79975.7,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 0,
                    &quot;max&quot;: 102825.90000000001,
                    &quot;min&quot;: 91400.8,
                    &quot;percent&quot;: 0.0
                },
                {
                    &quot;count&quot;: 50,
                    &quot;max&quot;: 114251.0,
                    &quot;min&quot;: 102825.90000000001,
                    &quot;percent&quot;: 0.036523009495982466
                }
            ],
            &quot;avg. area&quot;: 5411.624543462382,
            &quot;pixel distribution&quot;: {
                &quot;car&quot;: [
                    13655,
                    0.0018431496518735067
                ],
                &quot;cyclist&quot;: [
                    939005,
                    0.12674674030446592
                ],
                &quot;head&quot;: [
                    0,
                    0.0
                ],
                &quot;ignore&quot;: [
                    5501200,
                    0.7425510702956085
                ],
                &quot;left_hand&quot;: [
                    0,
                    0.0
                ],
                &quot;person&quot;: [
                    954654,
                    0.12885903974805205
                ],
                &quot;right_hand&quot;: [
                    0,
                    0.0
                ],
                &quot;road_arrows&quot;: [
                    0,
                    0.0
                ],
                &quot;traffic_sign&quot;: [
                    0,
                    0.0
                ]
            }
        }
    },
    &quot;annotations by type&quot;: {
        &quot;bbox&quot;: {
            &quot;count&quot;: 548
        },
        &quot;caption&quot;: {
            &quot;count&quot;: 0
        },
        &quot;label&quot;: {
            &quot;count&quot;: 0
        },
        &quot;mask&quot;: {
            &quot;count&quot;: 0
        },
        &quot;points&quot;: {
            &quot;count&quot;: 669
        },
        &quot;polygon&quot;: {
            &quot;count&quot;: 821
        },
        &quot;polyline&quot;: {
            &quot;count&quot;: 0
        }
    },
    &quot;annotations count&quot;: 2038,
    &quot;dataset&quot;: {
        &quot;image mean&quot;: [
            107.06903686941979,
            79.12831698580979,
            52.95829558185416
        ],
        &quot;image std&quot;: [
            49.40237673503467,
            43.29600731496902,
            35.47373007603151
        ],
        &quot;images count&quot;: 100
    },
    &quot;images count&quot;: 100,
    &quot;subsets&quot;: {},
    &quot;unannotated images&quot;: [
        &quot;img00051&quot;,
        &quot;img00052&quot;,
        &quot;img00053&quot;,
        &quot;img00054&quot;,
        &quot;img00055&quot;,
    ],
    &quot;unannotated images count&quot;: 5,
    &quot;unique images count&quot;: 97,
    &quot;repeating images count&quot;: 3,
    &quot;repeating images&quot;: [
        [(&quot;img00057&quot;, &quot;default&quot;), (&quot;img00058&quot;, &quot;default&quot;)],
        [(&quot;img00059&quot;, &quot;default&quot;), (&quot;img00060&quot;, &quot;default&quot;)],
        [(&quot;img00061&quot;, &quot;default&quot;), (&quot;img00062&quot;, &quot;default&quot;)],
    ],
}
</code></pre></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a6fd93528e84d29a5a0d58dbccb92724">11 - Validate Dataset</h1>
    
	<p>This command inspects annotations with respect to the task type
and stores the results in JSON file.</p>
<p>The task types supported are <code>classification</code>, <code>detection</code>, and
<code>segmentation</code> (the <code>-t/--task-type</code> parameter).</p>
<p>The validation result contains</p>
<ul>
<li><code>annotation statistics</code> based on the task type</li>
<li><code>validation reports</code>, such as
<ul>
<li>items not having annotations</li>
<li>items having undefined annotations</li>
<li>imbalanced distribution in class/attributes</li>
<li>too small or large values</li>
</ul>
</li>
<li><code>summary</code></li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -t TASK <span style="color:#ce5c00;font-weight:bold">[</span>-s SUBSET_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target
<a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a>.
By default, validates the current project.</li>
<li><code>-t, --task-type</code> (string) - Task type for validation</li>
<li><code>-s, --subset</code> (string) - Dataset subset to be validated</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>&lt;extra args&gt;</code> - The list of extra validation parameters. Should be passed
after the <code>--</code> separator after the main command arguments:
<ul>
<li><code>-fs, --few-samples-thr</code> (number) - The threshold for giving a warning
for minimum number of samples per class</li>
<li><code>-ir, --imbalance-ratio-thr</code> (number) - The threshold for giving
imbalance data warning</li>
<li><code>-m, --far-from-mean-thr</code> (number) - The threshold for giving
a warning that data is far from mean</li>
<li><code>-dr, --dominance-ratio-thr</code> (number) - The threshold for giving
a warning bounding box imbalance</li>
<li><code>-k, --topk-bins</code> (number) - The ratio of bins with the highest
number of data to total bins in the histogram</li>
</ul>
</li>
</ul>
<p>Example : give warning when imbalance ratio of data with classification task
over 40</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate -p prj/ -t classification -- -ir <span style="color:#0000cf;font-weight:bold">40</span>
</code></pre></div><p>Here is the list of validation items(a.k.a. anomaly types).</p>
<table>
<thead>
<tr>
<th>Anomaly Type</th>
<th>Description</th>
<th>Task Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>MissingLabelCategories</td>
<td>Metadata (ex. LabelCategories) should be defined</td>
<td>common</td>
</tr>
<tr>
<td>MissingAnnotation</td>
<td>No annotation found for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MissingAttribute</td>
<td>An attribute key is missing for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MultiLabelAnnotations</td>
<td>Item needs a single label</td>
<td>classification</td>
</tr>
<tr>
<td>UndefinedLabel</td>
<td>A label not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>UndefinedAttribute</td>
<td>An attribute not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>LabelDefinedButNotFound</td>
<td>A label is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>AttributeDefinedButNotFound</td>
<td>An attribute is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneLabel</td>
<td>The dataset consists of only label</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneAttributeValue</td>
<td>The dataset consists of only attribute value</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInLabel</td>
<td>The number of samples in a label might be too low</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInAttribute</td>
<td>The number of samples in an attribute might be too low</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedLabels</td>
<td>There is an imbalance in the label distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedAttribute</td>
<td>There is an imbalance in the attribute distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedDistInLabel</td>
<td>Values (ex. bbox width) are not evenly distributed for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>ImbalancedDistInAttribute</td>
<td>Values (ex. bbox width) are not evenly distributed for an attribute</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>NegativeLength</td>
<td>The width or height of bounding box is negative</td>
<td>detection</td>
</tr>
<tr>
<td>InvalidValue</td>
<td>There&rsquo;s invalid (ex. inf, nan) value for bounding box info.</td>
<td>detection</td>
</tr>
<tr>
<td>FarFromLabelMean</td>
<td>An annotation has an too small or large value than average for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>FarFromAttrMean</td>
<td>An annotation has an too small or large value than average for an attribute</td>
<td>detection, segmentation</td>
</tr>
</tbody>
</table>
<p>Validation Result Format:</p>
<details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;statistics&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">## common statistics</span>
        <span style="color:#4e9a06">&#39;label_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_labels&#39;</span>: &lt;dict&gt;,   <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;count:int&gt;</span>
            <span style="color:#4e9a06">&#39;undefined_labels&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;count&#39;: &lt;int&gt;,</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;items_with_undefined_label&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;attribute_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_attributes&#39;</span>: &lt;dict&gt;,
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_missing_attribute&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
            <span style="color:#4e9a06">&#39;undefined_attributes&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_with_undefined_attr&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;total_ann_count&#39;</span>: &lt;int&gt;,
        <span style="color:#4e9a06">&#39;items_missing_annotation&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for classification task</span>
        <span style="color:#4e9a06">&#39;items_with_multiple_labels&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for detection task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;x&#39;, &#39;y&#39;, &#39;width&#39;, &#39;height&#39;,</span>
        <span style="color:#8f5902;font-style:italic">#               &#39;area(wxh)&#39;, &#39;ratio(w/h)&#39;, &#39;short&#39;, &#39;long&#39;</span>
        <span style="color:#8f5902;font-style:italic"># - &#39;short&#39; is min(w,h) and &#39;long&#39; is max(w,h).</span>
        <span style="color:#4e9a06">&#39;items_with_negative_length&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: { &lt;ann_id:int&gt;: { &lt;&#39;width&#39;|&#39;height&#39;&gt;: &lt;value&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;bbox_template&gt;</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {&lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;bbox_template&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;bbox count:int&gt;</span>

        <span style="color:#8f5902;font-style:italic">## statistics for segmentation task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;area&#39;, &#39;width&#39;, &#39;height&#39;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;mask_template&gt;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
        <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;mask_template&gt;, }</span>
        <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;mask/polygon count: int&gt;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#39;validation_reports&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [ &lt;validation_error_format&gt;, ]</span>
    <span style="color:#8f5902;font-style:italic"># validation_error_format = {</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;anomaly_type&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;description&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;severity&#39;: &lt;str&gt;, # &#39;warning&#39; or &#39;error&#39;</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;item_id&#39;: &lt;str&gt;,  # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;subset&#39;: &lt;str&gt;,   # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic"># }</span>
    <span style="color:#4e9a06">&#39;summary&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;errors&#39;</span>: &lt;count: int&gt;,
        <span style="color:#4e9a06">&#39;warnings&#39;</span>: &lt;count: int&gt;
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>

</code></pre></div><p><code>item_key</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">item_key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><code>bbox_template</code> and <code>mask_template</code> are defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">bbox_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;area(wxh)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;ratio(w/h)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;short&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># short = min(w, h)</span>
    <span style="color:#4e9a06">&#39;long&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>   <span style="color:#8f5902;font-style:italic"># long = max(w, h)</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">mask_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;area&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><code>numerical_stat_template</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">numerical_stat_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;items_far_from_mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">dict</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#8f5902;font-style:italic"># {&#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: &lt;value:float&gt;, }, }</span>
    <span style="color:#4e9a06">&#39;mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;stddev&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;min&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;max&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;median&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;histogram&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;bins&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>   <span style="color:#8f5902;font-style:italic"># [&lt;float&gt;, ]</span>
        <span style="color:#4e9a06">&#39;counts&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># [&lt;int&gt;, ]</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6c14c8898a52d18d0040b216c7faf6a6">12 - Commit</h1>
    
	<p>This command allows to fix the current state of a project and
create a new revision from the working tree.</p>
<p>By default, this command checks sources in the working tree for
changes. If there are unknown changes found, an error will be raised,
unless <code>--allow-foreign</code> is used. If such changes are committed,
the source will only be available for reproduction from the project
cache, because Datumaro will not know how to repeat them.</p>
<p>The command will add the sources into the project cache. If you only
need to record revision metadata, you can use the <code>--no-cache</code> parameter.
This can be useful if you want to save disk space and/or have a backup copy
of datasets used in the project.</p>
<p>If there are no changes found, the command will stop. To allow empty
commits, use <code>--allow-empty</code>.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum commit <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -m MESSAGE <span style="color:#ce5c00;font-weight:bold">[</span>--allow-empty<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--allow-foreign<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>--no-cache<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>--allow-empty</code> - Allow commits with no changes</li>
<li><code>--allow-foreign</code> - Allow commits with changes made not by Datumaro</li>
<li><code>--no-cache</code> - Don&rsquo;t put committed datasets into cache, save only metadata</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum import -f coco &lt;path/to/coco/&gt;
datum commit -m <span style="color:#4e9a06">&#34;Added COCO&#34;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-86897105a5f038a99bfe0935866c69ce">13 - Transform Dataset</h1>
    
	<p>Often datasets need to be modified during preparation for model training and
experimenting. In trivial cases it can be done manually - e.g. image renaming
or label renaming. However, in more complex cases even simple modifications
can require too much efforts, distracting the user from the real work.
Datumaro provides the <code>datum transform</code> command to help in such cases.</p>
<p>This command allows to modify dataset images or annotations all at once.</p>
<blockquote>
<p>This command is designed for batch dataset processing, so if you only
need to modify few elements of a dataset, you might want to use
other approaches for better performance. A possible solution can be
a simple script, which uses <a href="../../../../docs/developer_manual/">Datumaro API</a>.</p>
</blockquote>
<p>The command can be applied to a dataset or a project build target,
a stage or the combined <code>project</code> target, in which case all the project
targets will be affected. A build tree stage will be recorded
if <code>--stage</code> is enabled, and the resulting dataset(-s) will be
saved if <code>--apply</code> is enabled.</p>
<p>By default, datasets are updated in-place. The <code>-o/--output-dir</code>
option can be used to specify another output directory. When
updating in-place, use the <code>--overwrite</code> parameter (in-place
updates fail by default to prevent data loss), unless a project
target is modified.</p>
<p>The current project (<code>-p/--project</code>) is also used as a context for
plugins, so it can be useful for dataset paths having custom formats.
When not specified, the current project&rsquo;s working tree is used.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -t TRANSFORM <span style="color:#ce5c00;font-weight:bold">[</span>-o DST_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--stage STAGE<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--apply APPLY<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - Target
<a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a>.
By default, transforms all targets of the current project.</li>
<li><code>-t, --transform</code> (string) - Transform method name</li>
<li><code>--stage</code> (bool) - Include this action as a project build step.
If true, this operation will be saved in the project
build tree, allowing to reproduce the resulting dataset later.
Applicable only to main project targets (i.e. data sources
and the <code>project</code> target, but not intermediate stages). Enabled by default.</li>
<li><code>--apply</code> (bool) - Run this command immediately. If disabled, only the
build tree stage will be written. Enabled by default.</li>
<li><code>-o, --output-dir</code> (string) - Output directory. Can be omitted for
main project targets (i.e. data sources and the <code>project</code> target, but not
intermediate stages) and dataset targets. If not specified, the results
will be saved inplace.</li>
<li><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is specified and is not empty.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>&lt;extra args&gt;</code> - The list of extra transformation parameters. Should be
passed after the <code>--</code> separator after the main command arguments. See
transform descriptions for info about extra parameters. Use the <code>--help</code>
option to print parameter info.</li>
</ul>
<p>Examples:</p>
<ul>
<li>Split a VOC-like dataset randomly:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t random_split --overwrite path/to/dataset:voc
</code></pre></div><ul>
<li>Rename images in a project data source by a regex from <code>frame_XXX</code> to <code>XXX</code>:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create &lt;...&gt;
datum import &lt;...&gt; -n source-1
datum transform -t rename source-1 -- -e <span style="color:#4e9a06">&#39;|frame_(\d+)|\\1|&#39;</span>
</code></pre></div><h4 id="built-in-transforms-a-idbuiltin-transformsa">Built-in transforms <a id="builtin-transforms"></a></h4>
<p>Basic dataset item manipulations:</p>
<ul>
<li><code>rename</code> - Renames dataset items by regular expression</li>
<li><code>id_from_image_name</code> - Renames dataset items to their image filenames</li>
<li><code>reindex</code> - Renames dataset items with numbers</li>
<li><code>ndr</code> - Removes duplicated images from dataset</li>
<li><code>sampler</code> - Runs inference and leaves only the most representative images</li>
<li><code>resize</code> - Resizes images and annotations in the dataset</li>
</ul>
<p>Subset manipulations:</p>
<ul>
<li><code>random_split</code> - Splits dataset into subsets randomly</li>
<li><code>split</code> - Splits dataset into subsets for classification, detection,
segmentation or re-identification</li>
<li><code>map_subsets</code> - Renames and removes subsets</li>
</ul>
<p>Annotation manipulations:</p>
<ul>
<li><code>remap_labels</code> - Renames, adds or removes labels in dataset</li>
<li><code>project_labels</code> - Sets dataset labels to the requested sequence</li>
<li><code>shapes_to_boxes</code> - Replaces spatial annotations with bounding boxes</li>
<li><code>boxes_to_masks</code> - Converts bounding boxes to instance masks</li>
<li><code>polygons_to_masks</code> - Converts polygons to instance masks</li>
<li><code>masks_to_polygons</code> - Converts instance masks to polygons</li>
<li><code>anns_to_labels</code> - Replaces annotations having labels with label annotations</li>
<li><code>merge_instance_segments</code> - Merges grouped spatial annotations into a mask</li>
<li><code>crop_covered_segments</code> - Removes occluded segments of covered masks</li>
<li><code>bbox_value_decrement</code> - Subtracts 1 from bbox coordinates</li>
</ul>
<p>Examples:</p>
<ul>
<li>Split a dataset randomly to <code>train</code> and <code>test</code> subsets, ratio is 2:1</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t random_split -- --subset train:.67 --subset test:.33
</code></pre></div><ul>
<li>Split a dataset for a specific task. The tasks supported are
classification, detection, segmentation and re-identification.</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t classification --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t detection --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t segmentation --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -t reid --subset train:.5 --subset val:.2 --subset test:.3 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --query .5
</code></pre></div><ul>
<li>Convert spatial annotations between each other</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t boxes_to_masks
datum transform -t masks_to_polygons
datum transform -t polygons_to_masks
datum transform -t shapes_to_boxes
</code></pre></div><ul>
<li>Set dataset labels to {<code>person</code>, <code>cat</code>, <code>dog</code>}, remove others, add missing.
Original labels (can be any): <code>cat</code>, <code>dog</code>, <code>elephant</code>, <code>human</code>
New labels: <code>person</code> (added), <code>cat</code> (kept), <code>dog</code> (kept)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t project_labels -- -l person -l cat -l dog
</code></pre></div><ul>
<li>Remap dataset labels, <code>person</code> to <code>car</code> and <code>cat</code> to <code>dog</code>,
keep <code>bus</code>, remove others</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t remap_labels -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -l person:car -l bus:bus -l cat:dog <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --default delete
</code></pre></div><ul>
<li>Rename dataset items by a regular expression
<ul>
<li>Replace <code>pattern</code> with <code>replacement</code></li>
<li>Remove <code>frame_</code> from item ids</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|pattern|replacement|&#39;</span>
datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|frame_(\d+)|\\1|&#39;</span>
</code></pre></div><ul>
<li>Create a dataset from K the most hard items for a model. The dataset will
be split into the <code>sampled</code> and <code>unsampled</code> subsets, based on the model
confidence, which is stored in the <code>scores</code> annotation attribute.</li>
</ul>
<p>There are five methods of sampling (the <code>-m/--method</code> option):</p>
<ul>
<li><code>topk</code> - Return the k with high uncertainty data</li>
<li><code>lowk</code> - Return the k with low uncertainty data</li>
<li><code>randk</code> - Return the random k data</li>
<li><code>mixk</code> - Return half to topk method and the rest to lowk method</li>
<li><code>randtopk</code> - First, select 3 times the number of k randomly, and return
the topk among them.</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t sampler -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -a entropy <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -i train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -o sampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -u unsampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m topk <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -k <span style="color:#0000cf;font-weight:bold">20</span>
</code></pre></div><ul>
<li>Remove duplicated images from a dataset. Keep at most N resulting images.
<ul>
<li>Available sampling options (the <code>-e</code> parameter):
<ul>
<li><code>random</code> - sample from removed data randomly</li>
<li><code>similarity</code> - sample from removed data with ascending</li>
</ul>
</li>
<li>Available sampling methods (the <code>-u</code> parameter):
<ul>
<li><code>uniform</code> - sample data with uniform distribution</li>
<li><code>inverse</code> - sample data with reciprocal of the number</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t ndr -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -w train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -a gradient <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -k <span style="color:#0000cf;font-weight:bold">100</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e random <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -u uniform
</code></pre></div><ul>
<li>Resize dataset images and annotations. Supports upscaling, downscaling
and mixed variants.</li>
</ul>
<pre><code>datum transform -t resize -- -dw 256 -dh 256
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-70c651cad336e515180a9b8eed13f292">14 - Checkout</h1>
    
	<p>This command allows to restore a specific project revision in the project
tree or to restore separate revisions of sources. A revision can be a commit
hash, branch, tag, or any <a href="https://git-scm.com/book/en/v2/Git-Tools-Revision-Selection">relative reference in the Git format</a>.</p>
<p>This command has multiple forms:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">1<span style="color:#ce5c00;font-weight:bold">)</span> datum checkout &lt;revision&gt;
2<span style="color:#ce5c00;font-weight:bold">)</span> datum checkout <span style="color:#ce5c00;font-weight:bold">[</span>--<span style="color:#ce5c00;font-weight:bold">]</span> &lt;source1&gt; ...
3<span style="color:#ce5c00;font-weight:bold">)</span> datum checkout &lt;revision&gt; <span style="color:#ce5c00;font-weight:bold">[</span>--<span style="color:#ce5c00;font-weight:bold">]</span> &lt;source1&gt; &lt;source2&gt; ...
</code></pre></div><p>1 - Restores a revision and all the corresponding sources in the
working directory. If there are conflicts between modified files in the
working directory and the target revision, an error is raised, unless
<code>--force</code> is used.</p>
<p>2, 3 - Restores only selected sources from the specified revision.
The current revision is used, when not set.</p>
<p>&ldquo;&ndash;&rdquo; can be used to separate source names and revisions:</p>
<ul>
<li><code>datum checkout name</code> - will look for revision &ldquo;name&rdquo;</li>
<li><code>datum checkout -- name</code> - will look for source &ldquo;name&rdquo; in the current
revision</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum checkout <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-f<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>rev<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>sources <span style="color:#ce5c00;font-weight:bold">[</span>sources ...<span style="color:#ce5c00;font-weight:bold">]]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>--force</code> - Allows to overwrite unsaved changes in case of conflicts</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>Restore the previous revision:
<code>datum checkout HEAD~1</code>
<br></p>
</li>
<li>
<p>Restore the saved version of a source in the working tree
<code>datum checkout -- source-1</code>
<br></p>
</li>
<li>
<p>Restore a previous version of a source
<code>datum checkout 33fbfbe my-source</code>
<br></p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a818e6c810d9d8ef27c2b0f440145895">15 - Status</h1>
    
	<p>This command prints the summary of the source changes between
the working tree of a project and its HEAD revision.</p>
<p>Prints lines in the following format:
<code>&lt;status&gt; &lt;source name&gt;</code></p>
<p>The list of possible <code>status</code> values:</p>
<ul>
<li><code>modified</code> - the source data exists and it is changed</li>
<li><code>foreign_modified</code> - the source data exists and it is changed,
but Datumaro does not know about the way the differences were made.
If changes are committed, they will only be available for reproduction
from the project cache.</li>
<li><code>added</code> - the source was added in the working tree</li>
<li><code>removed</code> - the source was removed from the working tree. This status won&rsquo;t
be reported if just the source <em>data</em> is removed in the working tree.
In such situation the status will be <code>missing</code>.</li>
<li><code>missing</code> - the source data is removed from the working directory.
The source still can be restored from the project cache or reproduced.</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum status <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">added source-1
modified source-2
foreign_modified source-3
removed source-4
missing source-5
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-209bf2b1793403ac2d9c18c87a7dab54">16 - Log</h1>
    
	<p>This command prints the history of the current project revision.</p>
<p>Prints lines in the following format:
<code>&lt;short commit hash&gt; &lt;commit message&gt;</code></p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum log <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-n MAX_COUNT<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-n, --max-count</code> (number, default: 10) - The maximum number of
previous revisions in the output</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example output:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">affbh33 Added COCO dataset
eeffa35 Added VOC dataset
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5a841ebe671810e701d94cfd348da645">17 - Run model inference explanation (explain)</h1>
    
	<p>Runs an explainable AI algorithm for a model.</p>
<p>This tool is supposed to help an AI developer to debug a model and a dataset.
Basically, it executes model inference and tries to find relation between
inputs and outputs of the trained model, i.e. determine decision boundaries
and belief intervals for the classifier.</p>
<p>Currently, the only available algorithm is RISE (<a href="https://arxiv.org/pdf/1806.07421.pdf">article</a>),
which runs model a single time and then re-runs a model multiple times on
each image to produce a heatmap of activations for each output of the
first inference. Each time a part of the input image is masked. As a result,
we obtain a number heatmaps, which show, how specific image pixels affected
the inference result. This algorithm doesn&rsquo;t require any special information
about the model, but it requires the model to return all the outputs and
confidences. The original algorithm supports only classification scenario,
but Datumaro extends it for detection models.</p>
<p>The following use cases available:</p>
<ul>
<li>RISE for classification</li>
<li>RISE for object detection</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum explain <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -m MODEL <span style="color:#ce5c00;font-weight:bold">[</span>-o SAVE_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>target<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">{</span>rise<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">[</span>RISE_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li>
<p><code>&lt;target&gt;</code> (string) - Target
<a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">dataset revpath</a>.By default,
uses the whole current project. An image path can be specified instead.
&lt;image path&gt; - a path to the file.
&lt;revpath&gt; - <a href="../../../../docs/user-manual/how_to_use_datumaro/#revpath">a dataset path or a revision path</a>.</p>
</li>
<li>
<p><code>&lt;method&gt;</code> (string) - The algorithm to use. Currently, only <code>rise</code>
is supported.</p>
</li>
<li>
<p><code>-m, --model</code> (string) - The model to use for inference</p>
</li>
<li>
<p><code>-o, --output-dir</code> (string) - Directory to save results to
(default: display only)</p>
</li>
<li>
<p><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</p>
</li>
<li>
<p><code>-h, --help</code> - Print the help message and exit.</p>
</li>
<li>
<p>RISE options:</p>
<ul>
<li><code>-s, --max-samples</code> (number) - Number of algorithm model runs per image
(default: mask size ^ 2).</li>
<li><code>--mw, --mask-width</code> (number) - Mask width in pixels (default: 7)</li>
<li><code>--mh, --mask-height</code> (number) - Mask height in pixels (default: 7)</li>
<li><code>--prob</code> (number) - Mask pixel inclusion probability, controls
mask density (default: 0.5)</li>
<li><code>--iou, --iou-thresh</code> (number) - IoU match threshold for detections
(default: 0.9)</li>
<li><code>--nms, --nms-iou-thresh</code> (number) - IoU match threshold for detections
for non-maxima suppression (default: no NMS)</li>
<li><code>--conf, --det-conf-thresh</code> (number) - Confidence threshold for
detections (default: include all)</li>
<li><code>-b, --batch-size</code> (number) - Batch size for inference (default: 1)</li>
<li><code>--display</code> - Visualize results during computations</li>
</ul>
</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>Run RISE on an image, display results:
<code>datum explain path/to/image.jpg -m mymodel rise --max-samples 50</code></p>
</li>
<li>
<p>Run RISE on a source revision:
<code>datum explain HEAD~1:source-1 -m model rise</code></p>
</li>
<li>
<p>Run inference explanation on a single image with online visualization</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum explain -t image.png -m mymodel <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    rise --max-samples <span style="color:#0000cf;font-weight:bold">1000</span> --display
</code></pre></div><blockquote>
<p>Note: this algorithm requires the model to return
<em>all</em> (or a <em>reasonable</em> amount) the outputs and confidences unfiltered,
i.e. all the <code>Label</code> annotations for classification models and
all the <code>Bbox</code>es for detection models.
You can find examples of the expected model outputs in <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_RISE.py"><code>tests/test_RISE.py</code></a></p>
</blockquote>
<p>For OpenVINO models the output processing script would look like this:</p>
<p>Classification scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.util.annotation_util</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">softmax</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, logits, shape = (N, n_classes)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">confs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">softmax</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">confs</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conf</span><span style="color:#000;font-weight:bold">)})</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div><p>Object Detection scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#8f5902;font-style:italic"># return a significant number of output boxes to make multiple runs</span>
<span style="color:#8f5902;font-style:italic"># statistically correct and meaningful</span>
<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1000</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-db2ab356420634e305b5ea0550f9b9c3">18 - Models</h1>
    
	<h3 id="register-model-a-idmodel-adda">Register model <a id="model-add"></a></h3>
<p>Datumaro can execute deep learning models in various frameworks. Check
<a href="../../../../docs/user-manual/extending/#builtin-plugins">the plugins section</a>
for more info.</p>
<p>Supported frameworks:</p>
<ul>
<li>OpenVINO</li>
<li>Custom models via custom <code>launchers</code></li>
</ul>
<p>Models need to be added to the Datumaro project first. It can be done with
the <code>datum model add</code> command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model add <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-n NAME<span style="color:#ce5c00;font-weight:bold">]</span> -l LAUNCHER <span style="color:#ce5c00;font-weight:bold">[</span>--copy<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--no-check<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-l, --launcher</code> (string) - Model launcher name</li>
<li><code>--copy</code> - Copy model data into project. By default, only the link is saved.</li>
<li><code>--no-check</code> - Don&rsquo;t check the model can be loaded</li>
<li><code>-n</code>, <code>--name</code> (string) - Name of the new model (default: generate
automatically)</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>&lt;extra args&gt;</code> - Additional arguments for the model launcher
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: register an OpenVINO model</p>
<p>A model consists of a graph description and weights. There is also a script
used to convert model outputs to internal data structures.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum model add <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n &lt;model_name&gt; -l openvino -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -d &lt;path_to_xml&gt; -w &lt;path_to_bin&gt; -i &lt;path_to_interpretation_script&gt;
</code></pre></div><p>Interpretation script for an OpenVINO detection model (<code>convert.py</code>):
You can find OpenVINO model interpreter samples in
<code>datumaro/plugins/openvino/samples</code> (<a href="../../../../docs/plugins/openvino_plugin">instruction</a>).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span>
<span style="color:#000">conf_thresh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.1</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">conf_thresh</span><span style="color:#000;font-weight:bold">:</span>
                <span style="color:#204a87;font-weight:bold">continue</span>

            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">get_categories</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#8f5902;font-style:italic"># Optionally, provide output categories - label map etc.</span>
    <span style="color:#8f5902;font-style:italic"># Example:</span>
    <span style="color:#000">label_categories</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LabelCategories</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;car&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">label_categories</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="remove-models-a-idmodel-removea">Remove Models <a id="model-remove"></a></h3>
<p>To remove a model from a project, use the <code>datum model remove</code> command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model remove <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> name
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;name&gt;</code> (string) - The name of the model to be removed</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum model add &lt;...&gt; -n model1
datum remove model1
</code></pre></div><h3 id="run-model-a-idmodel-runa">Run Model <a id="model-run"></a></h3>
<p>This command applies model to dataset images and produces a new dataset.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model run
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;target&gt;</code> (string) - A project build target to be used.
By default, uses the combined <code>project</code> target.</li>
<li><code>-m, --model</code> (string) - Model name</li>
<li><code>-o, --output-dir</code> (string) - Output directory. By default, results will
be stored in an auto-generated directory in the current directory.</li>
<li><code>--overwrite</code> - Allows to overwrite existing files in the output directory,
when it is specified and is not empty.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example: launch inference on a dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum model run -m mymodel -o inference
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dc182af461d71cbd7217b8679bde29bc">19 - Sources</h1>
    
	<p>These commands are specific for Data Sources. Read more about them <a href="../../../../docs/user-manual/how_to_use_datumaro#data-sources">here</a>.</p>
<h3 id="import-dataset-a-idsource-importa">Import Dataset <a id="source-import"></a></h3>
<p>Datasets can be added to a Datumaro project with the <code>import</code> command,
which adds a dataset link into the project and downloads (or copies)
the dataset. If you need to add a dataset already copied into the project,
use the <a href="#source-add"><code>add</code></a> command.</p>
<p>Dataset format readers can provide some additional import options. To pass
such options, use the <code>--</code> separator after the main command arguments.
The usage information can be printed with <code>datum import -f &lt;format&gt; -- --help</code>.</p>
<p>The list of currently available formats is listed in the command help output.</p>
<p>A dataset is imported by its URL. Currently, only local filesystem
paths are supported. The URL can be a file or a directory path
to a dataset. When the dataset is read, it is read as a whole.
However, many formats can have multiple subsets like <code>train</code>, <code>val</code>, <code>test</code>
etc. If you want to limit reading only to a specific subset, use
the <code>-r/--path</code> parameter. It can also be useful when subset files have
non-standard placement or names.</p>
<p>When a dataset is imported, the following things are done:</p>
<ul>
<li>URL is saved in the project config</li>
<li>data in copied into the project</li>
</ul>
<p>Each data source has a name assigned, which can be used in other commands. To
set a specific name, use the <code>-n/--name</code> parameter.</p>
<p>The dataset is added into the working tree of the project. A new commit
is <em>not</em> done automatically.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-n NAME<span style="color:#ce5c00;font-weight:bold">]</span> -f FORMAT <span style="color:#ce5c00;font-weight:bold">[</span>-r PATH<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--no-check<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> url <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_FORMAT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;url&gt;</code> (string) - A file of directory path to the dataset.</li>
<li><code>-f, --format</code> (string) - Dataset format</li>
<li><code>-r, --path</code> (string) - A path relative to the source URL the data source.
Useful to specify a path to a subset, subtask, or a specific file in URL.</li>
<li><code>--no-check</code> - Don&rsquo;t try to read the source after importing</li>
<li><code>-n</code>, <code>--name</code> (string) - Name of the new source (default: generate
automatically)</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;extra format args&gt;</code> - Additional arguments for the format reader
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: create a project from images and annotations in different formats,
export as TFrecord for TF Detection API for model training</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># &#39;default&#39; is the name of the subset below</span>
datum create
datum import -f coco_instances -r annotations/instances_default.json path/to/coco
datum import -f cvat &lt;path/to/cvat/default.xml&gt;
datum import -f voc_detection -r custom_subset_dir/default.txt &lt;path/to/voc&gt;
datum import -f datumaro &lt;path/to/datumaro/default.json&gt;
datum import -f image_dir &lt;path/to/images/dir&gt;
datum <span style="color:#204a87">export</span> -f tf_detection_api -- --save-images
</code></pre></div><h3 id="add-dataset-a-idsource-adda">Add Dataset <a id="source-add"></a></h3>
<p>Existing datasets can be added to a Datumaro project with the <code>add</code> command.
The command adds a project-local directory as a data source in the project.
Unlike the <a href="#source-import"><code>import</code></a>
command, it does not copy datasets and only works with local directories.
The source name is defined by the directory name.</p>
<p>Dataset format readers can provide some additional import options. To pass
such options, use the <code>--</code> separator after the main command arguments.
The usage information can be printed with <code>datum add -f &lt;format&gt; -- --help</code>.</p>
<p>The list of currently available formats is listed in the command help output.</p>
<p>A dataset is imported as a directory. When the dataset is read, it is read
as a whole. However, many formats can have multiple subsets like <code>train</code>,
<code>val</code>, <code>test</code> etc. If you want to limit reading only to a specific subset,
use the <code>-r/--path</code> parameter. It can also be useful when subset files have
non-standard placement or names.</p>
<p>The dataset is added into the working tree of the project. A new commit
is <em>not</em> done automatically.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum add <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -f FORMAT <span style="color:#ce5c00;font-weight:bold">[</span>-r PATH<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--no-check<span style="color:#ce5c00;font-weight:bold">]</span>
  <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> path <span style="color:#ce5c00;font-weight:bold">[</span>-- EXTRA_FORMAT_ARGS<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;url&gt;</code> (string) - A file of directory path to the dataset.</li>
<li><code>-f, --format</code> (string) - Dataset format</li>
<li><code>-r, --path</code> (string) - A path relative to the source URL the data source.
Useful to specify a path to a subset, subtask, or a specific file in URL.</li>
<li><code>--no-check</code> - Don&rsquo;t try to read the source after importing</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
<li><code>-- &lt;extra format args&gt;</code> - Additional arguments for the format reader
(use <code>-- -h</code> for help). Must be specified after the main command arguments.</li>
</ul>
<p>Example: create a project from images and annotations in different formats,
export in YOLO for model training</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum add -f coco -r annotations/instances_train.json dataset1/
datum add -f cvat dataset2/train.xml
datum <span style="color:#204a87">export</span> -f yolo -- --save-images
</code></pre></div><p>Example: add an existing dataset into a project, avoid data copying</p>
<p>To add a dataset, we need to have it inside the project directory:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">proj/
├─ .datumaro/
├─ .dvc/
├─ my_coco/
│  └─ images/
│     ├─ image1.jpg
│     └─ ...
│  └─ annotations/
│     └─ coco_annotation.json
├─ .dvcignore
└─ .gitignore
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o proj/
mv ~/my_coco/ proj/my_coco/ <span style="color:#8f5902;font-style:italic"># move the dataset into the project directory</span>
datum add -p proj/ -f coco proj/my_coco/
</code></pre></div><h3 id="remove-datasets-a-idsource-removea">Remove Datasets <a id="source-remove"></a></h3>
<p>To remove a data source from a project, use the <code>remove</code> command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum remove <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--force<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--keep-data<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> name <span style="color:#ce5c00;font-weight:bold">[</span>name ...<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;name&gt;</code> (string) - The name of the source to be removed (repeatable)</li>
<li><code>-f, --force</code> - Do not fail and stop on errors during removal</li>
<li><code>--keep-data</code> - Do not remove source data from the working directory, remove
only project metainfo.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum import -f voc -n src1 &lt;path/to/dataset/&gt;
datum remove src1
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-49c04c4e75f0995ee1c9c4c121d042c7">20 - Projects</h1>
    
	<h3 id="migrate-project-a-idproject-migratea">Migrate project <a id="project-migrate"></a></h3>
<p>Updates the project from an old version to the current one and saves the
resulting project in the output directory. Projects cannot be updated
inplace.</p>
<p>The command tries to map the old source configuration to the new one.
This can fail in some cases, so the command will exit with an error,
unless <code>-f/--force</code> is specified. With this flag, the command will
skip these errors an continue its work.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project migrate <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> -o DST_DIR <span style="color:#ce5c00;font-weight:bold">[</span>-f<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>--overwrite<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>-o, --output-dir</code> (string) - Output directory for the updated project</li>
<li><code>-f, --force</code> - Ignore source import errors (default: False)</li>
<li><code>--overwrite</code> - Overwrite existing files in the save directory.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Examples:</p>
<ul>
<li>Migrate a project from v1 to v2, save the new project in other dir:
<code>datum project migrate -o &lt;output/dir&gt;</code></li>
</ul>
<h3 id="print-project-info-a-idproject-infoa">Print project info <a id="project-info"></a></h3>
<p>Prints project configuration info such as available plugins, registered models,
imported sources and build tree.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project info <span style="color:#ce5c00;font-weight:bold">[</span>-h<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>-p PROJECT_DIR<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span>revision<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Parameters:</p>
<ul>
<li><code>&lt;revision&gt;</code> (string) - Target project revision. By default,
uses the working tree.</li>
<li><code>-p, --project</code> (string) - Directory of the project to operate on
(default: current directory).</li>
<li><code>-h, --help</code> - Print the help message and exit.</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>Print project info for the current working tree:
<code>datum project info</code></p>
</li>
<li>
<p>Print project info for the previous revision:
<code>datum project info HEAD~1</code></p>
</li>
</ul>
<p>Sample output:</p>
<details>
<pre><code>Project:
  location: /test_proj

Plugins:
  extractors: ade20k2017, ade20k2020, camvid, cifar, cityscapes, coco, coco_captions, coco_image_info, coco_instances, coco_labels, coco_panoptic, coco_person_keypoints, coco_stuff, cvat, datumaro, icdar_text_localization, icdar_text_segmentation, icdar_word_recognition, image_dir, image_zip, imagenet, imagenet_txt, kitti, kitti_detection, kitti_raw, kitti_segmentation, label_me, lfw, market1501, mnist, mnist_csv, mot_seq, mots, mots_png, open_images, sly_pointcloud, tf_detection_api, vgg_face2, voc, voc_action, voc_classification, voc_detection, voc_layout, voc_segmentation, wider_face, yolo

  converters: camvid, mot_seq_gt, coco_captions, coco, coco_image_info, coco_instances, coco_labels, coco_panoptic, coco_person_keypoints, coco_stuff, kitti, kitti_detection, kitti_segmentation, icdar_text_localization, icdar_text_segmentation, icdar_word_recognition, lfw, datumaro, open_images, image_zip, cifar, yolo, voc_action, voc_classification, voc, voc_detection, voc_layout, voc_segmentation, tf_detection_api, label_me, mnist, cityscapes, mnist_csv, kitti_raw, wider_face, vgg_face2, sly_pointcloud, mots_png, image_dir, imagenet_txt, market1501, imagenet, cvat

  launchers:

Models:

Sources:
  'source-2':
    format: voc
    url: /datasets/pascal/VOC2012
    location: /test_proj/source-2/
    options: {}
    hash: 3eb282cdd7339d05b75bd932a1fd3201
    stages:
      'root':
        type: source
        hash: 3eb282cdd7339d05b75bd932a1fd3201
  'source-3':
    format: imagenet
    url: /datasets/imagenet/ILSVRC2012_img_val/train
    location: /test_proj/source-3/
    options: {}
    hash: e47804a3ec1a54c9b145e5f1007ec72f
    stages:
      'root':
        type: source
        hash: e47804a3ec1a54c9b145e5f1007ec72f
</code></pre></details>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="">
    <a class="text-white" rel="noopener noreferrer" href="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" rel="noopener noreferrer" href="https://github.com/openvinotoolkit/datumaro">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center order-sm-2">
        <small class="mr-1"><a href="https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html">Privacy Policy</a></small>
        |
        <small class="mx-1"><a href="https://www.intel.com/content/www/us/en/legal/terms-of-use.html">Terms of Use</a></small>
        <br/>
        <div class="footer-disclaimer text-white ">
          <small>Intel technologies may require enabled hardware, software or service activation. // No product or component can be absolutely secure. // Your costs and results may vary. // Performance varies by use, configuration and other factors. // See our complete legal <u><a href="https://edc.intel.com/content/www/us/en/products/performance/benchmarks/overview/?r=219444055">Notices and Disclaimers</a></u>. // Intel is committed to respecting human rights and avoiding complicity in human rights abuses. See Intel’s <a href="https://www.intel.com/content/www/us/en/policy/policy-human-rights.html"><u>Global Human Rights Principles</u></a>. Intel’s products and software are intended only to be used in applications that do not cause or contribute to a violation of an internationally recognized human right.</small>
        </div>
        
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" integrity="sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK" crossorigin="anonymous"></script>





 













<script src="../../../../js/main.min.ee00f42d1b949caa55ccf416202998d65afac8f58091e2719c89d4fc3518550e.js" integrity="sha256-7gD0LRuUnKpVzPQWICmY1lr6yPWAkeJxnInU/DUYVQ4=" crossorigin="anonymous"></script>



<script src='../../../../js/prism.js'></script>



  </body>
</html>
