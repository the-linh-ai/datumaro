<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.1" /><link rel="canonical" type="text/html" href="../../docs/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../favicons/android-192x192.png" sizes="192x192">

<title>Dataset Management Framework Documentation | Dataset Management Framework</title>
<meta name="description" content=""><meta property="og:title" content="Dataset Management Framework Documentation" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/" /><meta property="og:site_name" content="Dataset Management Framework" />

<meta itemprop="name" content="Dataset Management Framework Documentation">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dataset Management Framework Documentation"/>
<meta name="twitter:description" content=""/>




<link rel="preload" href="../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" as="style">
<link href="../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" rel="stylesheet" integrity="">


<script
  src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>






<link rel="stylesheet" href="../../css/prism.css"/>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="../../docs">
    <span class="navbar-logo"></span><span class="font-weight-bold">Dataset Management Framework</span>
  </a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      
      
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          
          
          
          
          
          
          <a class="nav-link" href="https://github.com/openvinotoolkit/datumaro"  ><i class='fab fa-github'></i><span>GitHub</span></a>
        </li>
      
        <li class="nav-item mr-4 mb-2 mb-lg-0" id="api">
          <a class="nav-link" href="../../api">API documentation</a>
        </li>
      
        <li class="nav-item dropdown mr-4 d-lg-block">
          

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  v0.1.11
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
  
    
      <a class="dropdown-item" href="../../../docs/">develop</a>
  
    
      <a class="dropdown-item" href="../../../v0.1.11/docs/">v0.1.11</a>
  
    
      <a class="dropdown-item" href="../../../v0.2/docs/">v0.2</a>
  
    
      <a class="dropdown-item" href="../../../v0.2.1/docs/">v0.2.1</a>
  
    
      <a class="dropdown-item" href="../../../v0.2.2/docs/">v0.2.2</a>
  
    
      <a class="dropdown-item" href="../../../v0.2.3/docs/">v0.2.3</a>
  
</div>

        </li>
      
      
    </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../offline-search-index.34baac9cd79acf0e17f6bc8829702639.json"
  data-offline-search-base-href="../../"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Dataset Management Framework Documentation</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-a2e0f2893b70992c6087c2b17584ff57">Getting started</a></li>


    
  
    
    
	
<li>2: <a href="#pg-d26475bf8fc8b8ed51bb729174e4f140">Datumaro Design</a></li>


    
  
    
    
	
<li>3: <a href="#pg-50e921a7f98d7d8805f5b0dd1d77c3ff">User Manual</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-51ffc3be218678301748b0c7780c5c11">Installation</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-0bbbd7eeb0dc6e04f2e3fa3323ea7a3e">Interfaces</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-78ba7c94e85d98f21ac3206bb6824c8c">Supported dataset formats and annotations</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-3af4c138dac143865f65be36c630e095">Supported data formats</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-4e3ecb3183c9be665d345e47328246d2">Command line workflow</a></li>


    
  
    
    
	
<li>3.6: <a href="#pg-13498051bfc5d3b0beef06b7439a50a6">Command reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.6.1: <a href="#pg-a9290d217d55a8c42ce091cd380bf6d5">Convert datasets</a></li>


    
  
    
    
	
<li>3.6.2: <a href="#pg-173caf62a686687455f33853a96dbde0">Create project</a></li>


    
  
    
    
	
<li>3.6.3: <a href="#pg-5affd4a9f8d308e6d52cbac1d44c036d">Add and remove data</a></li>


    
  
    
    
	
<li>3.6.4: <a href="#pg-64028402ed2d50dec6e5481c49c890d7">Filter project</a></li>


    
  
    
    
	
<li>3.6.5: <a href="#pg-0d8ee2f09185bc2bd6a509f73215ff1b">Update project (merge)</a></li>


    
  
    
    
	
<li>3.6.6: <a href="#pg-7dbf48bb790ca34047b0c2c48fb7516c">Import project</a></li>


    
  
    
    
	
<li>3.6.7: <a href="#pg-92f13d53dbb65289b79bc4e4409decf0">Export project</a></li>


    
  
    
    
	
<li>3.6.8: <a href="#pg-a0d844d533cc20134007e1f5332a7320">Merge projects</a></li>


    
  
    
    
	
<li>3.6.9: <a href="#pg-0c02cb7f94ecdc879c944a0ec2ca01e1">Compare projects</a></li>


    
  
    
    
	
<li>3.6.10: <a href="#pg-9931fd883b9b1613bee97be12a614e7c">Obtaining project info</a></li>


    
  
    
    
	
<li>3.6.11: <a href="#pg-c2fe9ce334f91ae473c2ef7ca38d0953">Obtaining project statistics</a></li>


    
  
    
    
	
<li>3.6.12: <a href="#pg-18bbac5473774df0fffd18c506ff0423">Validate project annotations</a></li>


    
  
    
    
	
<li>3.6.13: <a href="#pg-270c588ff5ee4373633c3de0d7aca5fc">Register model</a></li>


    
  
    
    
	
<li>3.6.14: <a href="#pg-32084b6dd7a72d6f57f59963221f62cf">Run inference</a></li>


    
  
    
    
	
<li>3.6.15: <a href="#pg-70576ec909ab77bc58e96d7af0f685a7">Run inference explanation</a></li>


    
  
    
    
	
<li>3.6.16: <a href="#pg-20d9a8bc914df04488a2ff09c22fb1c2">Transform Project</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.7: <a href="#pg-5425ff20f66ad27cecd1cec97424d239">Extending</a></li>


    
  
    
    
	
<li>3.8: <a href="#pg-769eb55c675e353516911aa676486a8c">Links</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-fc8158f50663b4904c0929825f746cef">Dataset Management Framework (Datumaro) API and developer manual</a></li>


    
  
    
    
	
<li>5: <a href="#pg-c4f3b7b6687248fa052de696ab2cf167">Formats</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-1646a51944fb0a27e86b592702a3eda8">ADE20k (v2017)</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-22c9ec5acd736f4b76466752445697c5">ADE20k (v2020)</a></li>


    
  
    
    
	
<li>5.3: <a href="#pg-ddb50cccf6304e9bb85b1b9fb0369c48">CIFAR</a></li>


    
  
    
    
	
<li>5.4: <a href="#pg-b4837f6e880fb91ac1bc5f75998df382">Cityscapes</a></li>


    
  
    
    
	
<li>5.5: <a href="#pg-f3691abbbae7eae85ce83b256e5aec64">COCO</a></li>


    
  
    
    
	
<li>5.6: <a href="#pg-69397e43070456769c1b4fdb55f75baf">Image zip</a></li>


    
  
    
    
	
<li>5.7: <a href="#pg-bc1c599a20f4d5c48cfd2ed514e3f166">Velodyne Points / KITTI Raw 3D</a></li>


    
  
    
    
	
<li>5.8: <a href="#pg-342fda6e82df12e35a4cf02ae46d4bab">KITTI</a></li>


    
  
    
    
	
<li>5.9: <a href="#pg-a2db7ecd3bd406d8822366b9b33229dd">MNIST</a></li>


    
  
    
    
	
<li>5.10: <a href="#pg-f97053c70a29d6713d3412af07bcdcca">Open Images</a></li>


    
  
    
    
	
<li>5.11: <a href="#pg-db1d30fa5536c19aa2aa75b33dbf92ea">Pascal VOC</a></li>


    
  
    
    
	
<li>5.12: <a href="#pg-0c9b196a180c68b9b42be11ddc52c8bb">Supervisely Point Cloud</a></li>


    
  
    
    
	
<li>5.13: <a href="#pg-f638f1a110145e49bc81ee72961dd7ef">YOLO</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-bb346cf0596c62e042775b393e7fd9b8">Plugins</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-900c5314d5f38425d40d967abd17bea1">OpenVINO™ Inference Interpreter</a></li>


    
  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-05b7a8e562e0a482b29460c121776963">Contribution Guide</a></li>


    
  
    
    
	
<li>8: <a href="#pg-bf73365d45cbeba80db44f1ed292b48e">Release notes</a></li>


    
  

    </ul>


<div class="content">
      <p>Welcome to the documentation for the Dataset Management Framework (Datumaro).</p>
<p>The Datumaro is a free framework and CLI tool for building, transforming,
and analyzing datasets.
It is developed and used by Intel to build, transform, and analyze annotations
and datasets in a large number of <a href="../../docs/user-manual/supported-formats/">supported formats</a>.</p>
<p>Our documentation provides information for AI researchers, developers,
and teams, who are working with datasets and annotations.</p>
<div class="text-center">
<pre><code class="language-mermaid" data-lang="mermaid">flowchart LR
    datasets[(VOC dataset&lt;br/&gt;+&lt;br/&gt;COCO datset&lt;br/&gt;+&lt;br/&gt;CVAT annotation)]
    datumaro{Datumaro}
    dataset[dataset]
    annotation[Annotation tool]
    training[Model training]
    publication[Publication, statistics etc]
    datasets--&gt;datumaro
    datumaro--&gt;dataset
    dataset--&gt;annotation &amp; training &amp; publication
</code></pre></div>
<!--lint disable maximum-line-length-->
<section id="docs">



 
<a id="td-block-0" class="td-offset-anchor"></a>
<section class="row td-box td-box--docs td-box--gradient td-box--height-auto">
	<div class="col">
		<div class="row ">
			
				<div class="col-lg-4 mb-5 mb-lg-0 text-center ">
  <div class="mb-4 h1">
    <i class="fas fa-sign-in-alt"></i>
  </div>
  <h4 class="h3"><a href="../../docs/getting_started/">Getting started</a></h4>
  <p class="mb-0"><p>Basic information and sections needed for a quick start.</p>
</p>
</div>
<div class="col-lg-4 mb-5 mb-lg-0 text-center ">
  <div class="mb-4 h1">
    <i class="fas fa-book"></i>
  </div>
  <h4 class="h3"><a href="../../docs/user-manual/">User Manual</a></h4>
  <p class="mb-0"><p>This section contains documents for Datumaro users.</p>
</p>
</div>
<div class="col-lg-4 mb-5 mb-lg-0 text-center ">
  <div class="mb-4 h1">
    <i class="fas fa-code"></i>
  </div>
  <h4 class="h3"><a href="../../docs/developer_manual/">Developer Manual</a></h4>
  <p class="mb-0"><p>Documentation for Datumaro developers.</p>
</p>
</div>

			
		</div>
	</div>
</section>

</section>
<!--lint enable maximum-line-length-->

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a2e0f2893b70992c6087c2b17584ff57">1 - Getting started</h1>
    
	<p>To read about the design concept and features of Datumaro, go to the <a href="../../docs/design/">design section</a>.</p>
<h2 id="installation">Installation</h2>
<h3 id="dependencies">Dependencies</h3>
<ul>
<li>Python (3.6+)</li>
<li>Optional: OpenVINO, TensorFlow, PyTorch, MxNet, Caffe, Accuracy Checker</li>
</ul>
<p>Optionally, create a virtual environment:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m pip install virtualenv
python -m virtualenv venv
. venv/bin/activate
</code></pre></div><p>Install Datumaro package:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install datumaro
</code></pre></div><h2 id="usage">Usage</h2>
<p>There are several options available:</p>
<ul>
<li><a href="#standalone-tool">A standalone command-line tool</a></li>
<li><a href="#python-module">A python module</a></li>
</ul>
<h3 id="standalone-tool">Standalone tool</h3>
<p>Datuaro as a standalone tool allows to do various dataset operations from
the command line interface:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum --help
python -m datumaro --help
</code></pre></div><h3 id="python-module">Python module</h3>
<p>Datumaro can be used in custom scripts as a Python module. Used this way, it
allows to use its features from an existing codebase, enabling dataset
reading, exporting and iteration capabilities, simplifying integration of custom
formats and providing high performance operations:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.project</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Project</span>

<span style="color:#8f5902;font-style:italic"># load a Datumaro project</span>
<span style="color:#000">project</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;directory&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># create a dataset</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_dataset</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># keep only annotated images</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">item</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># change dataset labels</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;remap_labels&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># rename cat to dog</span>
    <span style="color:#4e9a06">&#39;truck&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;car&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># rename truck to car</span>
    <span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># remove this label</span>
  <span style="color:#000;font-weight:bold">},</span> <span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;delete&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#8f5902;font-style:italic"># remove everything else</span>

<span style="color:#8f5902;font-style:italic"># iterate over dataset elements</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">:</span>
  <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># export the resulting dataset in COCO format</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;dst/dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;coco&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><blockquote>
<p>Check our <a href="../../docs/developer_manual/">developer manual</a> for additional
information.</p>
</blockquote>
<h2 id="examples">Examples</h2>
<!--lint disable list-item-indent-->
<!--lint disable list-item-bullet-indent-->
<ul>
<li>
<p>Convert PASCAL VOC dataset to COCO format, keep only images with <code>cat</code> class
presented:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Download VOC dataset:</span>
<span style="color:#8f5902;font-style:italic"># http://host.robots.ox.ac.uk/pascal/VOC/voc2012/VOCtrainval_11-May-2012.tar</span>
datum convert --input-format voc --input-path &lt;path/to/voc&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format coco <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --filter <span style="color:#4e9a06">&#39;/item[annotation/label=&#34;cat&#34;]&#39;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              -- --reindex <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#8f5902;font-style:italic"># avoid annotation id conflicts</span>
</code></pre></div></li>
<li>
<p>Convert only non-<code>occluded</code> annotations from a
<a href="https://github.com/openvinotoolkit/cvat">CVAT</a> project to TFrecord:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export Datumaro dataset in CVAT UI, extract somewhere, go to the project dir</span>
datum filter -e <span style="color:#4e9a06">&#39;/item/annotation[occluded=&#34;False&#34;]&#39;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --mode items+anno --output-dir not_occluded
datum <span style="color:#204a87">export</span> --project not_occluded <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --format tf_detection_api -- --save-images
</code></pre></div></li>
<li>
<p>Annotate MS COCO dataset, extract image subset, re-annotate it in
<a href="https://github.com/openvinotoolkit/cvat">CVAT</a>, update old dataset:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Download COCO dataset http://cocodataset.org/#download</span>
<span style="color:#8f5902;font-style:italic"># Put images to coco/images/ and annotations to coco/annotations/</span>
datum import --format coco --input-path &lt;path/to/coco&gt;
datum <span style="color:#204a87">export</span> --filter <span style="color:#4e9a06">&#39;/image[images_I_dont_like]&#39;</span> --format cvat <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --output-dir reannotation
<span style="color:#8f5902;font-style:italic"># import dataset and images to CVAT, re-annotate</span>
<span style="color:#8f5902;font-style:italic"># export Datumaro project, extract to &#39;reannotation-upd&#39;</span>
datum merge reannotation-upd
datum <span style="color:#204a87">export</span> --format coco
</code></pre></div></li>
<li>
<p>Annotate instance polygons in
<a href="https://github.com/openvinotoolkit/cvat">CVAT</a>, export as masks in COCO:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --input-format cvat --input-path &lt;path/to/cvat.xml&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format coco -- --segmentation-mode masks
</code></pre></div></li>
<li>
<p>Apply an OpenVINO detection model to some COCO-like dataset,
then compare annotations with ground truth and visualize in TensorBoard:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format coco --input-path &lt;path/to/coco&gt;
<span style="color:#8f5902;font-style:italic"># create model results interpretation script</span>
datum model add mymodel openvino <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --weights model.bin --description model.xml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --interpretation-script parse_results.py
datum model run --model mymodel --output-dir mymodel_inference/
datum diff mymodel_inference/ --format tensorboard --output-dir diff
</code></pre></div></li>
<li>
<p>Change colors in PASCAL VOC-like <code>.png</code> masks:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format voc --input-path &lt;path/to/voc/dataset&gt;

<span style="color:#8f5902;font-style:italic"># Create a color map file with desired colors:</span>
<span style="color:#8f5902;font-style:italic">#</span>
<span style="color:#8f5902;font-style:italic"># label : color_rgb : parts : actions</span>
<span style="color:#8f5902;font-style:italic"># cat:0,0,255::</span>
<span style="color:#8f5902;font-style:italic"># dog:255,0,0::</span>
<span style="color:#8f5902;font-style:italic">#</span>
<span style="color:#8f5902;font-style:italic"># Save as mycolormap.txt</span>

datum <span style="color:#204a87">export</span> --format voc_segmentation -- --label-map mycolormap.txt
<span style="color:#8f5902;font-style:italic"># add &#34;--apply-colormap=0&#34; to save grayscale (indexed) masks</span>
<span style="color:#8f5902;font-style:italic"># check &#34;--help&#34; option for more info</span>
<span style="color:#8f5902;font-style:italic"># use &#34;datum --loglevel debug&#34; for extra conversion info</span>
</code></pre></div></li>
<li>
<p>Create a custom COCO-like dataset:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">LabelCategories</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">AnnotationType</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">LabelCategories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000;font-weight:bold">})</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
  <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">]))</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;test_dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;coco&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div></li>
</ul>
<!--lint enable list-item-bullet-indent-->
<!--lint enable list-item-indent-->

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d26475bf8fc8b8ed51bb729174e4f140">2 - Datumaro Design</h1>
    
	<!--lint disable list-item-indent-->
<h2 id="concept">Concept</h2>
<p>Datumaro is:</p>
<ul>
<li>a tool to build composite datasets and iterate over them</li>
<li>a tool to create and maintain datasets
<ul>
<li>Version control of annotations and images</li>
<li>Publication (with removal of sensitive information)</li>
<li>Editing</li>
<li>Joining and splitting</li>
<li>Exporting, format changing</li>
<li>Image preprocessing</li>
</ul>
</li>
<li>a dataset storage</li>
<li>a tool to debug datasets
<ul>
<li>A network can be used to generate
informative data subsets (e.g. with false-positives)
to be analyzed further</li>
</ul>
</li>
</ul>
<h3 id="requirements">Requirements</h3>
<ul>
<li>User interfaces
<ul>
<li>a library</li>
<li>a console tool with visualization means</li>
</ul>
</li>
<li>Targets: single datasets, composite datasets, single images / videos</li>
<li>Built-in support for well-known annotation formats and datasets:
CVAT, COCO, PASCAL VOC, Cityscapes, ImageNet</li>
<li>Extensibility with user-provided components</li>
<li>Lightweightness - it should be easy to start working with Datumaro
<ul>
<li>Minimal dependency on environment and configuration</li>
<li>It should be easier to use Datumaro than writing own code
for computation of statistics or dataset manipulations</li>
</ul>
</li>
</ul>
<h3 id="functionality-and-ideas">Functionality and ideas</h3>
<ul>
<li>Blur sensitive areas on dataset images</li>
<li>Dataset annotation filters, relabelling etc.</li>
<li>Dataset augmentation</li>
<li>Calculation of statistics:
<ul>
<li>Mean &amp; std, custom stats</li>
</ul>
</li>
<li>&ldquo;Edit&rdquo; command to modify annotations</li>
<li>Versioning (for images, annotations, subsets, sources etc., comparison)</li>
<li>Documentation generation</li>
<li>Provision of iterators for user code</li>
<li>Dataset downloading</li>
<li>Dataset generation</li>
<li>Dataset building (export in a specific format, indexation, statistics,
documentation)</li>
<li>Dataset exporting to other formats</li>
<li>Dataset debugging (run inference, generate dataset slices, compute statistics)</li>
<li>&ldquo;Explainable AI&rdquo; - highlight network attention areas (<a href="https://arxiv.org/abs/1901.04592">paper</a>)
<ul>
<li>Black-box approach
<ul>
<li>Classification, Detection, Segmentation, Captioning</li>
<li>White-box approach</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="research-topics">Research topics</h3>
<ul>
<li>exploration of network prediction uncertainty (aka Bayessian approach)
Use case: explanation of network &ldquo;quality&rdquo;, &ldquo;stability&rdquo;, &ldquo;certainty&rdquo;</li>
<li>adversarial attacks on networks</li>
<li>dataset minification / reduction
Use case: removal of redundant information to reach the same network quality
with lesser training time</li>
<li>dataset expansion and filtration of additions
Use case: add only important data</li>
<li>guidance for key frame selection for tracking (<a href="https://arxiv.org/abs/1903.11779">paper</a>)
Use case: more effective annotation, better predictions</li>
</ul>
<h2 id="rc-1-vision">RC 1 vision</h2>
<h3 id="cvat-integration">CVAT integration</h3>
<p>Datumaro needs to be integrated with <a href="https://github.com/openvinotoolkit/cvat">CVAT</a>,
extending CVAT UI capabilities regarding task and project operations.
It should be capable of downloading and processing data from CVAT.</p>
<!--lint disable fenced-code-flag-->
<pre><code class="language-lang-none" data-lang="lang-none">        User
          |
          v
 +------------------+
 |       CVAT       |
 +--------v---------+       +------------------+       +--------------+
 | Datumaro module  | ----&gt; | Datumaro project | &lt;---&gt; | Datumaro CLI | &lt;--- User
 +------------------+       +------------------+       +--------------+
</code></pre><!--lint enable fenced-code-flag-->
<h3 id="interfaces">Interfaces</h3>
<ul>
<li><input checked="" disabled="" type="checkbox"> Python API for user code
<ul>
<li><input checked="" disabled="" type="checkbox"> Installation as a package</li>
<li><input checked="" disabled="" type="checkbox"> Installation with <code>pip</code> by name</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> A command-line tool for dataset manipulations</li>
</ul>
<h3 id="features">Features</h3>
<ul>
<li>
<p>Dataset format support (reading, writing)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Own format</li>
<li><input checked="" disabled="" type="checkbox"> CVAT</li>
<li><input checked="" disabled="" type="checkbox"> COCO</li>
<li><input checked="" disabled="" type="checkbox"> PASCAL VOC</li>
<li><input checked="" disabled="" type="checkbox"> YOLO</li>
<li><input checked="" disabled="" type="checkbox"> TF Detection API</li>
<li><input checked="" disabled="" type="checkbox"> Cityscapes</li>
<li><input checked="" disabled="" type="checkbox"> ImageNet</li>
</ul>
</li>
<li>
<p>Dataset visualization (<code>show</code>)</p>
<ul>
<li><input disabled="" type="checkbox"> Ability to visualize a dataset
<ul>
<li><input disabled="" type="checkbox"> with TensorBoard</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Calculation of statistics for datasets</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Pixel mean, std</li>
<li><input checked="" disabled="" type="checkbox"> Object counts (detection scenario)</li>
<li><input checked="" disabled="" type="checkbox"> Image-Class distribution (classification scenario)</li>
<li><input checked="" disabled="" type="checkbox"> Pixel-Class distribution (segmentation scenario)</li>
<li><input checked="" disabled="" type="checkbox"> Image similarity clusters</li>
<li><input disabled="" type="checkbox"> Custom statistics</li>
</ul>
</li>
<li>
<p>Dataset building</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Composite dataset building</li>
<li><input checked="" disabled="" type="checkbox"> Class remapping</li>
<li><input checked="" disabled="" type="checkbox"> Subset splitting</li>
<li><input checked="" disabled="" type="checkbox"> Dataset filtering (<code>extract</code>)</li>
<li><input checked="" disabled="" type="checkbox"> Dataset merging (<code>merge</code>)</li>
<li><input disabled="" type="checkbox"> Dataset item editing (<code>edit</code>)</li>
</ul>
</li>
<li>
<p>Dataset comparison (<code>diff</code>)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Annotation-annotation comparison</li>
<li><input checked="" disabled="" type="checkbox"> Annotation-inference comparison</li>
<li><input checked="" disabled="" type="checkbox"> Annotation quality estimation (for CVAT)
<ul>
<li>Provide a simple method to check
annotation quality with a model and generate summary</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Dataset and model debugging</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Inference explanation (<code>explain</code>)</li>
<li><input checked="" disabled="" type="checkbox"> Black-box approach (<a href="https://arxiv.org/abs/1806.07421">RISE paper</a>)</li>
<li><input checked="" disabled="" type="checkbox"> Ability to run a model on a dataset and read the results</li>
</ul>
</li>
<li>
<p>CVAT-integration features</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Task export
<ul>
<li><input checked="" disabled="" type="checkbox"> Datumaro project export</li>
<li><input checked="" disabled="" type="checkbox"> Dataset export</li>
<li><input checked="" disabled="" type="checkbox"> Original raw data (images, a video file) can be downloaded (exported)
together with annotations or just have links
on CVAT server (in future, support S3, etc)
<ul>
<li><input checked="" disabled="" type="checkbox"> Be able to use local files instead of remote links
<ul>
<li><input disabled="" type="checkbox"> Specify cache directory</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> Use case &ldquo;annotate for model training&rdquo;
<ul>
<li>create a task</li>
<li>annotate</li>
<li>export the task</li>
<li>convert to a training format</li>
<li>train a DL model</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> Use case &ldquo;annotate - reannotate problematic images - merge&rdquo;</li>
<li><input checked="" disabled="" type="checkbox"> Use case &ldquo;annotate and estimate quality&rdquo;
<ul>
<li>create a task</li>
<li>annotate</li>
<li>estimate quality of annotations</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="optional-features">Optional features</h3>
<ul>
<li>
<p>Dataset publishing</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Versioning (for annotations, subsets, sources, etc.)</li>
<li><input disabled="" type="checkbox"> Blur sensitive areas on images</li>
<li><input disabled="" type="checkbox"> Tracking of legal information</li>
<li><input disabled="" type="checkbox"> Documentation generation</li>
</ul>
</li>
<li>
<p>Dataset building</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Dataset minification / Extraction of the most representative subset
<ul>
<li>Use case: generate low-precision calibration dataset</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Dataset and model debugging</p>
<ul>
<li><input disabled="" type="checkbox"> Training visualization</li>
<li><input checked="" disabled="" type="checkbox"> Inference explanation (<code>explain</code>)
<ul>
<li><input disabled="" type="checkbox"> White-box approach</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="properties">Properties</h3>
<ul>
<li>Lightweightness</li>
<li>Modularity</li>
<li>Extensibility</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-50e921a7f98d7d8805f5b0dd1d77c3ff">3 - User Manual</h1>
    
	<h2 id="contents">Contents</h2>
<ul>
<li><a href="./installation/">Installation</a></li>
<li><a href="./interfaces/">Interfaces</a></li>
<li><a href="./supported-formats/">Supported dataset formats and annotations</a></li>
<li><a href="./data-formats/">Supported data formats</a></li>
<li><a href="./command-line-workflow/">Command line workflow</a>
<ul>
<li><a href="./command-line-workflow/#project-structure/">Project structure</a></li>
</ul>
</li>
<li><a href="./command-reference/">Command reference</a>
<ul>
<li><a href="./command-reference/convert-datasets/">Convert datasets</a></li>
<li><a href="./command-reference/import-project/">Import project</a></li>
<li><a href="./command-reference/create-project/">Create project</a></li>
<li><a href="./command-reference/add-and-remove-data/">Add and remove data</a></li>
<li><a href="./command-reference/filter-project/">Filter project</a></li>
<li><a href="./command-reference/update-project/">Update project (merge)</a></li>
<li><a href="./command-reference/merge-projects/">Merge projects</a></li>
<li><a href="./command-reference/export-project/">Export project</a></li>
<li><a href="./command-reference/compare-projects/">Compare projects</a></li>
<li><a href="./command-reference/get-project-info/">Obtaining project info</a></li>
<li><a href="./command-reference/get-project-statistics/">Obtaining project statistics</a></li>
<li><a href="./command-reference/validate-project-annotations/">Validate project annotations</a></li>
<li><a href="./command-reference/register-model/">Register model</a></li>
<li><a href="./command-reference/run-model/">Run inference</a></li>
<li><a href="./command-reference/explain-inference/">Run inference explanation</a></li>
<li><a href="./command-reference/transform-project/">Transform project</a></li>
</ul>
</li>
<li><a href="./extending/">Extending</a>
<ul>
<li><a href="./extending/#builtin-plugins">Builtin plugins</a></li>
<li><a href="./extending/#dataset-formats">Dataset Formats</a></li>
<li><a href="./extending/#dataset-conversions">Dataset Conversions (&ldquo;Transforms&rdquo;)</a></li>
<li><a href="./extending/#model-launchers">Model launchers</a></li>
</ul>
</li>
<li><a href="./links">Links</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-51ffc3be218678301748b0c7780c5c11">3.1 - Installation</h1>
    
	<h3 id="dependencies">Dependencies</h3>
<ul>
<li>Python (3.6+)</li>
<li>Optional: OpenVINO, TensorFlow, PyTorch, MxNet, Caffe, Accuracy Checker</li>
</ul>
<h3 id="installation-steps">Installation steps</h3>
<p>Optionally, set up a virtual environment:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m pip install virtualenv
python -m virtualenv venv
. venv/bin/activate
</code></pre></div><p>Install:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># From PyPI:</span>
pip install datumaro

<span style="color:#8f5902;font-style:italic"># From the GitHub repository:</span>
pip install <span style="color:#4e9a06">&#39;git+https://github.com/openvinotoolkit/datumaro&#39;</span>
</code></pre></div><blockquote>
<p>You can change the installation branch with <code>...@&lt;branch_name&gt;</code>
Also use <code>--force-reinstall</code> parameter in this case.</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0bbbd7eeb0dc6e04f2e3fa3323ea7a3e">3.2 - Interfaces</h1>
    
	<p>As a standalone tool:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum --help
</code></pre></div><p>As a python module:</p>
<blockquote>
<p>The directory containing Datumaro should be in the <code>PYTHONPATH</code>
environment variable or <code>cvat/datumaro/</code> should be the current directory.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m datumaro --help
python datumaro/ --help
python datum.py --help
</code></pre></div><p>As a python library:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datumaro</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-78ba7c94e85d98f21ac3206bb6824c8c">3.3 - Supported dataset formats and annotations</h1>
    
	<p>List of supported formats:</p>
<ul>
<li>MS COCO
(<code>image_info</code>, <code>instances</code>, <code>person_keypoints</code>, <code>captions</code>, <code>labels</code>,<code>panoptic</code>, <code>stuff</code>)
<ul>
<li><a href="http://cocodataset.org/#format-data">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/coco_dataset">Dataset example</a></li>
<li><code>labels</code> are our extension - like <code>instances</code> with only <code>category_id</code></li>
<li><a href="../../docs/formats/coco">Format documentation</a></li>
</ul>
</li>
<li>PASCAL VOC (<code>classification</code>, <code>detection</code>, <code>segmentation</code> (class, instances),
<code>action_classification</code>, <code>person_layout</code>)
<ul>
<li><a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/htmldoc/index.html">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/voc_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/pascal_voc">Format documentation</a></li>
</ul>
</li>
<li>YOLO (<code>bboxes</code>)
<ul>
<li><a href="https://github.com/AlexeyAB/darknet#how-to-train-pascal-voc-data">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/yolo_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/yolo">Format documentation</a></li>
</ul>
</li>
<li>TF Detection API (<code>bboxes</code>, <code>masks</code>)
<ul>
<li>Format specifications: <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/using_your_own_dataset.md">bboxes</a>,
<a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/instance_segmentation.md">masks</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/tf_detection_api_dataset">Dataset example</a></li>
</ul>
</li>
<li>WIDER Face (<code>bboxes</code>)
<ul>
<li><a href="http://shuoyang1213.me/WIDERFACE/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/widerface_dataset">Dataset example</a></li>
</ul>
</li>
<li>VGGFace2 (<code>landmarks</code>, <code>bboxes</code>)
<ul>
<li><a href="https://github.com/ox-vgg/vgg_face2">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/vgg_face2_dataset">Dataset example</a></li>
</ul>
</li>
<li>MOT sequences
<ul>
<li><a href="https://arxiv.org/pdf/1906.04567.pdf">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/mot_dataset">Dataset example</a></li>
</ul>
</li>
<li>MOTS (png)
<ul>
<li><a href="https://www.vision.rwth-aachen.de/page/mots">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/mots_dataset">Dataset example</a></li>
</ul>
</li>
<li>ImageNet (<code>classification</code>, <code>detection</code>)
<ul>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/imagenet_dataset">Dataset example</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/imagenet_txt_dataset">Dataset example (txt for classification)</a></li>
<li>Detection format is the same as in PASCAL VOC</li>
</ul>
</li>
<li>CIFAR-10/100 (<code>classification</code> (python version))
<ul>
<li><a href="https://www.cs.toronto.edu/~kriz/cifar.html">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/cifar10_dataset">Dataset example CIFAR-10</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/cifar100_dataset">Dataset example CIFAR-100</a></li>
<li><a href="../../docs/formats/cifar">Format documentation</a></li>
</ul>
</li>
<li>MNIST (<code>classification</code>)
<ul>
<li><a href="http://yann.lecun.com/exdb/mnist/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/mnist_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/mnist">Format documentation</a></li>
</ul>
</li>
<li>MNIST in CSV (<code>classification</code>)
<ul>
<li><a href="https://pjreddie.com/projects/mnist-in-csv/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/mnist_csv_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/mnist">Format documentation</a></li>
</ul>
</li>
<li>CamVid (<code>segmentation</code>)
<ul>
<li><a href="http://mi.eng.cam.ac.uk/research/projects/VideoRec/CamVid/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/camvid_dataset">Dataset example</a></li>
</ul>
</li>
<li>Cityscapes (<code>segmentation</code>)
<ul>
<li><a href="https://www.cityscapes-dataset.com/dataset-overview/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/cityscapes_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/cityscapes">Format documentation</a></li>
</ul>
</li>
<li>KITTI (<code>segmentation</code>, <code>detection</code>)
<ul>
<li><a href="http://www.cvlibs.net/datasets/kitti/index.php">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/kitti_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/kitti">Format documentation</a></li>
</ul>
</li>
<li>KITTI 3D (<code>raw</code>/<code>tracklets</code>/<code>velodyne points</code>)
<ul>
<li><a href="http://www.cvlibs.net/datasets/kitti/raw_data.php">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/kitti_dataset/kitti_raw">Dataset example</a></li>
<li><a href="../../docs/formats/kitti_raw">Format documentation</a></li>
</ul>
</li>
<li>Supervisely (<code>pointcloud</code>)
<ul>
<li><a href="https://docs.supervise.ly/data-organization/00_ann_format_navi">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/sly_pointcloud_dataset">Dataset example</a></li>
<li><a href="../../docs/formats/sly_pointcloud">Format documentation</a></li>
</ul>
</li>
<li>CVAT
<ul>
<li><a href="https://openvinotoolkit.github.io/cvat/docs/manual/advanced/xml_format/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/cvat_dataset">Dataset example</a></li>
</ul>
</li>
<li>LabelMe
<ul>
<li><a href="http://labelme.csail.mit.edu/Release3.0">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/labelme_dataset">Dataset example</a></li>
</ul>
</li>
<li>ICDAR13/15 (<code>word_recognition</code>, <code>text_localization</code>, <code>text_segmentation</code>)
<ul>
<li><a href="https://rrc.cvc.uab.es/?ch=2">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/icdar_dataset">Dataset example</a></li>
</ul>
</li>
<li>Market-1501 (<code>person re-identification</code>)
<ul>
<li><a href="https://www.aitribune.com/dataset/2018051063">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/market1501_dataset">Dataset example</a></li>
</ul>
</li>
<li>LFW (<code>classification</code>, <code>person re-identification</code>, <code>landmarks</code>)
<ul>
<li><a href="http://vis-www.cs.umass.edu/lfw/">Format specification</a></li>
<li><a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/lfw_dataset">Dataset example</a></li>
</ul>
</li>
</ul>
<p>List of supported annotation types:</p>
<ul>
<li>Labels</li>
<li>Bounding boxes</li>
<li>Polygons</li>
<li>Polylines</li>
<li>(Segmentation) Masks</li>
<li>(Key-)Points</li>
<li>Captions</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3af4c138dac143865f65be36c630e095">3.4 - Supported data formats</h1>
    
	<p>Datumaro only works with 2d RGB(A) images.</p>
<p>To create an unlabelled dataset from an arbitrary directory with images use
<code>ImageDir</code> format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o &lt;project/dir&gt;
datum add path -p &lt;project/dir&gt; -f image_dir &lt;directory/path/&gt;
</code></pre></div><p>or if you work with Datumaro API:</p>
<p>For using with a project:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.project</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Project</span>

<span style="color:#000">project</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Project</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_source</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;source1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#39;format&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;image_dir&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#4e9a06">&#39;url&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;directory/path/&#39;</span>
<span style="color:#000;font-weight:bold">})</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_dataset</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><p>And for using as a dataset:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;directory/path/&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;image_dir&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>This will search for images in the directory recursively and add
them as dataset entries with names like <code>&lt;subdir1&gt;/&lt;subsubdir1&gt;/&lt;image_name1&gt;</code>.
The list of formats matches the list of supported image formats in OpenCV.</p>
<pre><code>.jpg, .jpeg, .jpe, .jp2, .png, .bmp, .dib, .tif, .tiff, .tga, .webp, .pfm,
.sr, .ras, .exr, .hdr, .pic, .pbm, .pgm, .ppm, .pxm, .pnm
</code></pre><p>After addition into a project, images can be split into subsets and renamed
with transformations, filtered, joined with existing annotations etc.</p>
<p>To use a video as an input, one should either <a href="../../docs/developer_manual/#plugins">create an Extractor plugin</a>,
which splits a video into frames, or split the video manually and import images.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4e3ecb3183c9be665d345e47328246d2">3.5 - Command line workflow</h1>
    
	<p>The key object is a project, so most CLI commands operate on projects.
However, there are few commands operating on datasets directly.
A project is a combination of a project&rsquo;s own dataset, a number of
external data sources and an environment.
An empty Project can be created by <code>project create</code> command,
an existing dataset can be imported with <code>project import</code> command.
A typical way to obtain projects is to export tasks in CVAT UI.</p>
<p>If you want to interact with models, you need to add them to project first.</p>
<h2 id="project-structure">Project structure</h2>
<!--lint disable fenced-code-flag-->
<pre><code>└── project/
    ├── .datumaro/
    |   ├── config.yml
    │   ├── .git/
    │   ├── models/
    │   └── plugins/
    │       ├── plugin1/
    │       |   ├── file1.py
    │       |   └── file2.py
    │       ├── plugin2.py
    │       ├── custom_extractor1.py
    │       └── ...
    ├── dataset/
    └── sources/
        ├── source1
        └── ...
</code></pre><!--lint enable fenced-code-flag-->

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-13498051bfc5d3b0beef06b7439a50a6">3.6 - Command reference</h1>
    
	<blockquote>
<p><strong>Note</strong>: command invocation syntax is subject to change,
<strong>always refer to command &ndash;help output</strong></p>
</blockquote>
<p>Available CLI commands:</p>
<div class="text-center large-scheme">
<pre><code class="language-mermaid" data-lang="mermaid">flowchart LR
    d{datum}
    p((project))
    s((source))
    m((model))
    d==&gt;p
    p==create===&gt;str1([Creates a Datumaro project])
    p==import===&gt;str2([Generates a project from other project or dataset in specific format])
    p==export===&gt;str3([Saves dataset in a specific format])
    p==extract===&gt;str4([Extracts subproject by filter])
    p==merge===&gt;str5([Adds new items to project])
    p==diff===&gt;str6([Compares two projects])
    p==transform===&gt;str7([Applies specific transformation to the dataset])
    p==info===&gt;str8([Outputs valuable info])
    d==&gt;s
    s==add===&gt;str9([Adds data source by its URL])
    s==remove===&gt;str10([Remove source dataset])
    d==&gt;m
    m==add===&gt;str11([Registers model for inference])
    m==remove===&gt;str12([Removes model from project])
    m==run===&gt;str13([Executes network for inference])
    d==&gt;c(create)===&gt;str14([Calls project create])
    d==&gt;a(add)===&gt;str15([Calls source add])
    d==&gt;r(remove)===&gt;str16([Calls source remove])
    d==&gt;e(export)===&gt;str17([Calls project export])
    d==&gt;exp(explain)===&gt;str18([Runs inference explanation])
</code></pre></div>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a9290d217d55a8c42ce091cd380bf6d5">3.6.1 - Convert datasets</h1>
    
	<p>This command allows to convert a dataset from one format into another.
In fact, this command is a combination of <code>project import</code> and <code>project export</code>
and just provides a simpler way to obtain the same result when no extra options
is needed. A list of supported formats can be found in the <code>--help</code> output of
this command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --help

datum convert <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i &lt;input path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -if &lt;input format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;output format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>extra parameters <span style="color:#204a87;font-weight:bold">for</span> output format<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: convert a VOC-like dataset to a COCO-like one:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --input-format voc --input-path &lt;path/to/voc/&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format coco
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-173caf62a686687455f33853a96dbde0">3.6.2 - Create project</h1>
    
	<p>The command creates an empty project. Once a Project is created, there are
a few options to interact with it.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create --help

datum create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;project_dir&gt;
</code></pre></div><p>Example: create an empty project <code>my_dataset</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o my_dataset/
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5affd4a9f8d308e6d52cbac1d44c036d">3.6.3 - Add and remove data</h1>
    
	<p>A Project can contain a number of external Data Sources. Each Data Source
describes a way to produce dataset items. A Project combines dataset items from
all the sources and its own dataset into one composite dataset. You can manage
project sources by commands in the <code>source</code> command line context.</p>
<p>Datasets come in a wide variety of formats. Each dataset
format defines its own data structure and rules on how to
interpret the data. For example, the following data structure
is used in COCO format:</p>
<!--lint disable fenced-code-flag-->
<pre><code>/dataset/
- /images/&lt;id&gt;.jpg
- /annotations/
</code></pre><!--lint enable fenced-code-flag-->
<p>Supported formats are listed in the command help. Check <a href="../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum add --help
datum remove --help

datum add <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    path &lt;path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;name&gt;

datum remove <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;name&gt;
</code></pre></div><p>Example: create a project from a bunch of different annotations and images,
and generate TFrecord for TF Detection API for model training</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
<span style="color:#8f5902;font-style:italic"># &#39;default&#39; is the name of the subset below</span>
datum add path &lt;path/to/coco/instances_default.json&gt; -f coco_instances
datum add path &lt;path/to/cvat/default.xml&gt; -f cvat
datum add path &lt;path/to/voc&gt; -f voc_detection
datum add path &lt;path/to/datumaro/default.json&gt; -f datumaro
datum add path &lt;path/to/images/dir&gt; -f image_dir
datum <span style="color:#204a87">export</span> -f tf_detection_api
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-64028402ed2d50dec6e5481c49c890d7">3.6.4 - Filter project</h1>
    
	<p>This command allows to create a sub-Project from a Project. The new project
includes only items satisfying some condition. <a href="https://devhints.io/xpath">XPath</a>
is used as a query format.</p>
<p>There are several filtering modes available (<code>-m/--mode</code> parameter).
Supported modes:</p>
<ul>
<li><code>i</code>, <code>items</code></li>
<li><code>a</code>, <code>annotations</code></li>
<li><code>i+a</code>, <code>a+i</code>, <code>items+annotations</code>, <code>annotations+items</code></li>
</ul>
<p>When filtering annotations, use the <code>items+annotations</code>
mode to point that annotation-less dataset items should be
removed. To select an annotation, write an XPath that
returns <code>annotation</code> elements (see examples).</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter --help

datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;&lt;xpath filter expression&gt;&#39;</span>
</code></pre></div><p>Example: extract a dataset with only images which <code>width</code> &lt; <code>height</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;/item[image/width &lt; image/height]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only images of subset <code>train</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;/item[subset=&#34;train&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only large annotations of class <code>cat</code> and any
non-<code>persons</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --mode annotations -e <span style="color:#4e9a06">&#39;/item/annotation[(label=&#34;cat&#34; and area &gt; 99.5) or label!=&#34;person&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only occluded annotations, remove empty images</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m i+a -e <span style="color:#4e9a06">&#39;/item/annotation[occluded=&#34;True&#34;]&#39;</span>
</code></pre></div><p>Item representations are available with <code>--dry-run</code> parameter:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#204a87;font-weight:bold">&lt;item&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>290768<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;subset&gt;</span>minival2014<span style="color:#204a87;font-weight:bold">&lt;/subset&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;image&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;width&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/width&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;height&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/height&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;depth&gt;</span>3<span style="color:#204a87;font-weight:bold">&lt;/depth&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/image&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>80154<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>39<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>264.59<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>150.25<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>11.199999999999989<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>42.31<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>473.87199999999956<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>669839<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>41<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>163.58<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>191.75<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>76.98999999999998<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>73.63<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>5668.773699999998<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  ...
<span style="color:#204a87;font-weight:bold">&lt;/item&gt;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d8ee2f09185bc2bd6a509f73215ff1b">3.6.5 - Update project (merge)</h1>
    
	<p>This command updates items in a project from another one
(check <a href="../../docs/user-manual/command-reference/merge-projects/">Merge Projects</a>
for complex merging).</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge --help

datum merge <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;other project dir&gt;
</code></pre></div><p>Example: update annotations in the <code>first_project</code> with annotations
from the <code>second_project</code> and save the result as <code>merged_project</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p first_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o merged_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    second_project
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7dbf48bb790ca34047b0c2c48fb7516c">3.6.6 - Import project</h1>
    
	<p>This command creates a Project from an existing dataset.</p>
<p>Supported formats are listed in the command help. Check <a href="../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --help

datum import <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i &lt;dataset_path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;project_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt;
</code></pre></div><p>Example: create a project from COCO-like dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i /home/coco_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o /home/project_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f coco
</code></pre></div><p>An <em>MS COCO</em>-like dataset should have the following directory structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>COCO/
├── annotations/
│   ├── instances_val2017.json
│   ├── instances_train2017.json
├── images/
│   ├── val2017
│   ├── train2017
</code></pre><!--lint enable fenced-code-flag-->
<p>Everything after the last <code>_</code> is considered a subset name in the COCO format.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92f13d53dbb65289b79bc4e4409decf0">3.6.7 - Export project</h1>
    
	<p>This command exports a Project as a dataset in some format.</p>
<p>Supported formats are listed in the command help. Check <a href="../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> --help

datum <span style="color:#204a87">export</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>additional format parameters<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: save project as VOC-like dataset, include images, convert images to <code>PNG</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o test_project-export <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f voc <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images --image-ext<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.png&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a0d844d533cc20134007e1f5332a7320">3.6.8 - Merge projects</h1>
    
	<p>This command merges items from 2 or more projects and checks annotations for
errors.</p>
<p>Spatial annotations are compared by distance and intersected, labels and
attributes are selected by voting.
Merge conflicts, missing items and annotations, other errors are saved into a <code>.json</code> file.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge --help

datum merge &lt;project dirs&gt;
</code></pre></div><p>Example: merge 4 (partially-)intersecting projects,</p>
<ul>
<li>consider voting succeeded when there are 3+ same votes</li>
<li>consider shapes intersecting when IoU &gt;= 0.6</li>
<li>check annotation groups to have <code>person</code>, <code>hand</code>, <code>head</code> and <code>foot</code>
(<code>?</code> for optional)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge project1/ project2/ project3/ project4/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quorum <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -iou 0.6 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --groups <span style="color:#4e9a06">&#39;person,hand?,head,foot?&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0c02cb7f94ecdc879c944a0ec2ca01e1">3.6.9 - Compare projects</h1>
    
	<p>The command compares two datasets and saves the results in the
specified directory. The current project is considered to be
&ldquo;ground truth&rdquo;.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum diff --help

datum diff &lt;other_project_dir&gt; -o &lt;save_dir&gt;
</code></pre></div><p>Example: compare a dataset with model inference</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum transform &lt;...&gt; -o inference
datum diff inference -o diff
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9931fd883b9b1613bee97be12a614e7c">3.6.10 - Obtaining project info</h1>
    
	<p>This command outputs project status information.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum info --help

datum info <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt;
</code></pre></div><p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum info -p /test_project

Project:
  name: test_project
  location: /test_project
Sources:
  <span style="color:#204a87">source</span> <span style="color:#4e9a06">&#39;instances_minival2014&#39;</span>:
    format: coco_instances
    url: /coco_like/annotations/instances_minival2014.json
Dataset:
  length: <span style="color:#0000cf;font-weight:bold">5000</span>
  categories: label
    label:
      count: <span style="color:#0000cf;font-weight:bold">80</span>
      labels: person, bicycle, car, motorcycle <span style="color:#ce5c00;font-weight:bold">(</span>and <span style="color:#0000cf;font-weight:bold">76</span> more<span style="color:#ce5c00;font-weight:bold">)</span>
  subsets: minival2014
    subset <span style="color:#4e9a06">&#39;minival2014&#39;</span>:
      length: <span style="color:#0000cf;font-weight:bold">5000</span>
      categories: label
        label:
          count: <span style="color:#0000cf;font-weight:bold">80</span>
          labels: person, bicycle, car, motorcycle <span style="color:#ce5c00;font-weight:bold">(</span>and <span style="color:#0000cf;font-weight:bold">76</span> more<span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c2fe9ce334f91ae473c2ef7ca38d0953">3.6.11 - Obtaining project statistics</h1>
    
	<p>This command computes various project statistics, such as:</p>
<ul>
<li>image mean and std. dev.</li>
<li>class and attribute balance</li>
<li>mask pixel balance</li>
<li>segment area distribution</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats --help

datum stats <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt;
</code></pre></div><p>Example:</p>
<details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats -p test_project

<span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;annotations&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;labels&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;attributes&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;gender&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 358,
                    <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                        <span style="color:#4e9a06">&#34;female&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            149,
                            0.41620111731843573
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;male&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            209,
                            0.5837988826815642
                        <span style="color:#ce5c00;font-weight:bold">]</span>
                    <span style="color:#ce5c00;font-weight:bold">}</span>,
                    <span style="color:#4e9a06">&#34;values count&#34;</span>: 2,
                    <span style="color:#4e9a06">&#34;values present&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                        <span style="color:#4e9a06">&#34;female&#34;</span>,
                        <span style="color:#4e9a06">&#34;male&#34;</span>
                    <span style="color:#ce5c00;font-weight:bold">]</span>
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#4e9a06">&#34;view&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 340,
                    <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                        <span style="color:#4e9a06">&#34;__undefined__&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            4,
                            0.011764705882352941
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;front&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            54,
                            0.1588235294117647
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;left&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            14,
                            0.041176470588235294
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;rear&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            235,
                            0.6911764705882353
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;right&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            33,
                            0.09705882352941177
                        <span style="color:#ce5c00;font-weight:bold">]</span>
                    <span style="color:#ce5c00;font-weight:bold">}</span>,
                    <span style="color:#4e9a06">&#34;values count&#34;</span>: 5,
                    <span style="color:#4e9a06">&#34;values present&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                        <span style="color:#4e9a06">&#34;__undefined__&#34;</span>,
                        <span style="color:#4e9a06">&#34;front&#34;</span>,
                        <span style="color:#4e9a06">&#34;left&#34;</span>,
                        <span style="color:#4e9a06">&#34;rear&#34;</span>,
                        <span style="color:#4e9a06">&#34;right&#34;</span>
                    <span style="color:#ce5c00;font-weight:bold">]</span>
                <span style="color:#ce5c00;font-weight:bold">}</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>,
            <span style="color:#4e9a06">&#34;count&#34;</span>: 2038,
            <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;car&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    340,
                    0.16683022571148184
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;cyclist&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    194,
                    0.09519136408243375
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;head&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    354,
                    0.17369970559371933
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;ignore&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    100,
                    0.04906771344455348
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;left_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    238,
                    0.11678115799803729
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;person&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    358,
                    0.17566241413150147
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;right_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    77,
                    0.037782139352306184
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;road_arrows&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    326,
                    0.15996074582924436
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;traffic_sign&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    51,
                    0.025024533856722278
                <span style="color:#ce5c00;font-weight:bold">]</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;segments&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;area distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 1318,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 11425.1,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 0.0,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.9627465303140978
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 1,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 22850.2,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 11425.1,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0007304601899196494
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 34275.3,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 22850.2,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 45700.4,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 34275.3,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 57125.5,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 45700.4,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 68550.6,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 57125.5,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 79975.7,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 68550.6,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 91400.8,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 79975.7,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 102825.90000000001,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 91400.8,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 50,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 114251.0,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 102825.90000000001,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.036523009495982466
                <span style="color:#ce5c00;font-weight:bold">}</span>
            <span style="color:#ce5c00;font-weight:bold">]</span>,
            <span style="color:#4e9a06">&#34;avg. area&#34;</span>: 5411.624543462382,
            <span style="color:#4e9a06">&#34;pixel distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;car&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    13655,
                    0.0018431496518735067
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;cyclist&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    939005,
                    0.12674674030446592
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;head&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;ignore&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    5501200,
                    0.7425510702956085
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;left_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;person&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    954654,
                    0.12885903974805205
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;right_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;road_arrows&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;traffic_sign&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;annotations by type&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;bbox&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">548</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;caption&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;label&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;mask&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;points&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">669</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;polygon&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">821</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;polyline&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;annotations count&#34;</span>: 2038,
    <span style="color:#4e9a06">&#34;dataset&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;image mean&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
            107.06903686941979,
            79.12831698580979,
            52.95829558185416
        <span style="color:#ce5c00;font-weight:bold">]</span>,
        <span style="color:#4e9a06">&#34;image std&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
            49.40237673503467,
            43.29600731496902,
            35.47373007603151
        <span style="color:#ce5c00;font-weight:bold">]</span>,
        <span style="color:#4e9a06">&#34;images count&#34;</span>: <span style="color:#0000cf;font-weight:bold">100</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;images count&#34;</span>: 100,
    <span style="color:#4e9a06">&#34;subsets&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{}</span>,
    <span style="color:#4e9a06">&#34;unannotated images&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;img00051&#34;</span>,
        <span style="color:#4e9a06">&#34;img00052&#34;</span>,
        <span style="color:#4e9a06">&#34;img00053&#34;</span>,
        <span style="color:#4e9a06">&#34;img00054&#34;</span>,
        <span style="color:#4e9a06">&#34;img00055&#34;</span>,
    <span style="color:#ce5c00;font-weight:bold">]</span>,
    <span style="color:#4e9a06">&#34;unannotated images count&#34;</span>: 5,
    <span style="color:#4e9a06">&#34;unique images count&#34;</span>: 97,
    <span style="color:#4e9a06">&#34;repeating images count&#34;</span>: 3,
    <span style="color:#4e9a06">&#34;repeating images&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00057&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00058&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00059&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00060&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00061&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00062&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
    <span style="color:#ce5c00;font-weight:bold">]</span>,
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-18bbac5473774df0fffd18c506ff0423">3.6.12 - Validate project annotations</h1>
    
	<p>This command inspects annotations with respect to the task type
and stores the result in JSON file.</p>
<p>The task types supported are <code>classification</code>, <code>detection</code>, and <code>segmentation</code>.</p>
<p>The validation result contains</p>
<ul>
<li><code>annotation statistics</code> based on the task type</li>
<li><code>validation reports</code>, such as
<ul>
<li>items not having annotations</li>
<li>items having undefined annotations</li>
<li>imbalanced distribution in class/attributes</li>
<li>too small or large values</li>
</ul>
</li>
<li><code>summary</code></li>
</ul>
<p>Usage:</p>
<ul>
<li>There are five configurable parameters for validation
<ul>
<li><code>few_samples_thr</code> : threshold for giving a warning for minimum number of
samples per class</li>
<li><code>imbalance_ratio_thr</code> : threshold for giving imbalance data warning</li>
<li><code>far_from_mean_thr</code> : threshold for giving a warning that data is far
from mean</li>
<li><code>dominance_ratio_thr</code> : threshold for giving a warning bounding box
imbalance</li>
<li><code>topk_bins</code> : ratio of bins with the highest number of data to total bins
in the histogram</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate --help

datum validate -p &lt;project dir&gt; -t &lt;task_type&gt; -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -fs &lt;few_samples_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -ir &lt;imbalance_ratio_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;far_from_mean_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -dr &lt;dominance_ratio_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k &lt;topk_bins&gt;
</code></pre></div><p>Example : give warning when imbalance ratio of data with classification task
over 40</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate -p prj-cls -t classification -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -ir <span style="color:#0000cf;font-weight:bold">40</span>
</code></pre></div><p>Here is the list of validation items(a.k.a. anomaly types).</p>
<table>
<thead>
<tr>
<th>Anomaly Type</th>
<th>Description</th>
<th>Task Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>MissingLabelCategories</td>
<td>Metadata (ex. LabelCategories) should be defined</td>
<td>common</td>
</tr>
<tr>
<td>MissingAnnotation</td>
<td>No annotation found for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MissingAttribute</td>
<td>An attribute key is missing for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MultiLabelAnnotations</td>
<td>Item needs a single label</td>
<td>classification</td>
</tr>
<tr>
<td>UndefinedLabel</td>
<td>A label not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>UndefinedAttribute</td>
<td>An attribute not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>LabelDefinedButNotFound</td>
<td>A label is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>AttributeDefinedButNotFound</td>
<td>An attribute is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneLabel</td>
<td>The dataset consists of only label</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneAttributeValue</td>
<td>The dataset consists of only attribute value</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInLabel</td>
<td>The number of samples in a label might be too low</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInAttribute</td>
<td>The number of samples in an attribute might be too low</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedLabels</td>
<td>There is an imbalance in the label distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedAttribute</td>
<td>There is an imbalance in the attribute distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedDistInLabel</td>
<td>Values (ex. bbox width) are not evenly distributed for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>ImbalancedDistInAttribute</td>
<td>Values (ex. bbox width) are not evenly distributed for an attribute</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>NegativeLength</td>
<td>The width or height of bounding box is negative</td>
<td>detection</td>
</tr>
<tr>
<td>InvalidValue</td>
<td>There&rsquo;s invalid (ex. inf, nan) value for bounding box info.</td>
<td>detection</td>
</tr>
<tr>
<td>FarFromLabelMean</td>
<td>An annotation has an too small or large value than average for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>FarFromAttrMean</td>
<td>An annotation has an too small or large value than average for an attribute</td>
<td>detection, segmentation</td>
</tr>
</tbody>
</table>
<p>Validation Result Format:</p>
<details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;statistics&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">## common statistics</span>
        <span style="color:#4e9a06">&#39;label_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_labels&#39;</span>: &lt;dict&gt;,   <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;count:int&gt;</span>
            <span style="color:#4e9a06">&#39;undefined_labels&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;count&#39;: &lt;int&gt;,</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;items_with_undefined_label&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;attribute_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_attributes&#39;</span>: &lt;dict&gt;,
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_missing_attribute&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
            <span style="color:#4e9a06">&#39;undefined_attributes&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_with_undefined_attr&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;total_ann_count&#39;</span>: &lt;int&gt;,
        <span style="color:#4e9a06">&#39;items_missing_annotation&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for classification task</span>
        <span style="color:#4e9a06">&#39;items_with_multiple_labels&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for detection task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;x&#39;, &#39;y&#39;, &#39;width&#39;, &#39;height&#39;,</span>
        <span style="color:#8f5902;font-style:italic">#               &#39;area(wxh)&#39;, &#39;ratio(w/h)&#39;, &#39;short&#39;, &#39;long&#39;</span>
        <span style="color:#8f5902;font-style:italic"># - &#39;short&#39; is min(w,h) and &#39;long&#39; is max(w,h).</span>
        <span style="color:#4e9a06">&#39;items_with_negative_length&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: { &lt;ann_id:int&gt;: { &lt;&#39;width&#39;|&#39;height&#39;&gt;: &lt;value&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;bbox_template&gt;</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {&lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;bbox_template&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;bbox count:int&gt;</span>

        <span style="color:#8f5902;font-style:italic">## statistics for segmentation task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;area&#39;, &#39;width&#39;, &#39;height&#39;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;mask_template&gt;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
        <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;mask_template&gt;, }</span>
        <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;mask/polygon count: int&gt;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#39;validation_reports&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [ &lt;validation_error_format&gt;, ]</span>
    <span style="color:#8f5902;font-style:italic"># validation_error_format = {</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;anomaly_type&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;description&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;severity&#39;: &lt;str&gt;, # &#39;warning&#39; or &#39;error&#39;</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;item_id&#39;: &lt;str&gt;,  # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;subset&#39;: &lt;str&gt;,   # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic"># }</span>
    <span style="color:#4e9a06">&#39;summary&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;errors&#39;</span>: &lt;count: int&gt;,
        <span style="color:#4e9a06">&#39;warnings&#39;</span>: &lt;count: int&gt;
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>

</code></pre></div><p><code>item_key</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">item_key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><code>bbox_template</code> and <code>mask_template</code> are defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">bbox_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;area(wxh)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;ratio(w/h)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;short&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># short = min(w, h)</span>
    <span style="color:#4e9a06">&#39;long&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>   <span style="color:#8f5902;font-style:italic"># long = max(w, h)</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">mask_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;area&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><code>numerical_stat_template</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">numerical_stat_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;items_far_from_mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">dict</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#8f5902;font-style:italic"># {&#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: &lt;value:float&gt;, }, }</span>
    <span style="color:#4e9a06">&#39;mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;stdev&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;min&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;max&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;median&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;histogram&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;bins&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>   <span style="color:#8f5902;font-style:italic"># [&lt;float&gt;, ]</span>
        <span style="color:#4e9a06">&#39;counts&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># [&lt;int&gt;, ]</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-270c588ff5ee4373633c3de0d7aca5fc">3.6.13 - Register model</h1>
    
	<p>Supported models:</p>
<ul>
<li>OpenVINO</li>
<li>Custom models via custom <code>launchers</code></li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model add --help
</code></pre></div><p>Example: register an OpenVINO model</p>
<p>A model consists of a graph description and weights. There is also a script
used to convert model outputs to internal data structures.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum model add <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;model_name&gt; -l open_vino -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d &lt;path_to_xml&gt; -w &lt;path_to_bin&gt; -i &lt;path_to_interpretation_script&gt;
</code></pre></div><p>Interpretation script for an OpenVINO detection model (<code>convert.py</code>):
You can find OpenVINO model interpreter samples in
<code>datumaro/plugins/openvino/samples</code> (<a href="../../docs/plugins/openvino_plugin/">instruction</a>).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span>
<span style="color:#000">conf_thresh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.1</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">conf_thresh</span><span style="color:#000;font-weight:bold">:</span>
                <span style="color:#204a87;font-weight:bold">continue</span>

            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">get_categories</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#8f5902;font-style:italic"># Optionally, provide output categories - label map etc.</span>
    <span style="color:#8f5902;font-style:italic"># Example:</span>
    <span style="color:#000">label_categories</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LabelCategories</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;car&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">label_categories</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-32084b6dd7a72d6f57f59963221f62cf">3.6.14 - Run inference</h1>
    
	<p>This command applies model to dataset images and produces a new project.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model run --help

datum model run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;model_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;save_dir&gt;
</code></pre></div><p>Example: launch inference on a dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum model run -m mymodel -o inference
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-70576ec909ab77bc58e96d7af0f685a7">3.6.15 - Run inference explanation</h1>
    
	<p>Runs an explainable AI algorithm for a model.</p>
<p>This tool is supposed to help an AI developer to debug a model and a dataset.
Basically, it executes inference and tries to find problems in the trained
model - determine decision boundaries and belief intervals for the classifier.</p>
<p>Currently, the only available algorithm is RISE (<a href="https://arxiv.org/pdf/1806.07421.pdf">article</a>),
which runs inference and then re-runs a model multiple times on each
image to produce a heatmap of activations for each output of the
first inference. As a result, we obtain few heatmaps, which
shows, how image pixels affected the inference result. This algorithm doesn&rsquo;t
require any special information about the model, but it requires the model to
return all the outputs and confidences. The algorithm only supports
classification and detection models.</p>
<p>The following use cases available:</p>
<ul>
<li>RISE for classification</li>
<li>RISE for object detection</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum explain --help

datum explain <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;model_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;save_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t &lt;target&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;method&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;method_params&gt;
</code></pre></div><p>Example: run inference explanation on a single image with visualization</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum explain -t image.png -m mymodel <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    rise --max-samples <span style="color:#0000cf;font-weight:bold">1000</span> --progressive
</code></pre></div><blockquote>
<p>Note: this algorithm requires the model to return
<em>all</em> (or a <em>reasonable</em> amount) the outputs and confidences unfiltered,
i.e. all the <code>Label</code> annotations for classification models and
all the <code>Bbox</code>es for detection models.
You can find examples of the expected model outputs in <a href="https://github.com/openvinotoolkit/datumaro/blob/develop/tests/test_RISE.py"><code>tests/test_RISE.py</code></a></p>
</blockquote>
<p>For OpenVINO models the output processing script would look like this:</p>
<p>Classification scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.util.annotation_util</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">softmax</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, logits, shape = (N, n_classes)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">confs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">softmax</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">confs</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conf</span><span style="color:#000;font-weight:bold">)})</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div><p>Object Detection scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#8f5902;font-style:italic"># return a significant number of output boxes to make multiple runs</span>
<span style="color:#8f5902;font-style:italic"># statistically correct and meaningful</span>
<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1000</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20d9a8bc914df04488a2ff09c22fb1c2">3.6.16 - Transform Project</h1>
    
	<p>This command allows to modify images or annotations in a project all at once.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform --help

datum transform <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t &lt;transform_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>extra transform options<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: split a dataset randomly to <code>train</code> and <code>test</code> subsets, ratio is 2:1</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t random_split -- --subset train:.67 --subset test:.33
</code></pre></div><p>Example: split a dataset in task-specific manner. The tasks supported are
classification, detection, segmentation and re-identification.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t classification --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t detection --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t segmentation --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t reid --subset train:.5 --subset val:.2 --subset test:.3 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --query .5
</code></pre></div><p>Example: convert polygons to masks, masks to boxes etc.:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t boxes_to_masks
datum transform -t masks_to_polygons
datum transform -t polygons_to_masks
datum transform -t shapes_to_boxes
</code></pre></div><p>Example: remap dataset labels, <code>person</code> to <code>car</code> and <code>cat</code> to <code>dog</code>,
keep <code>bus</code>, remove others</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t remap_labels -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -l person:car -l bus:bus -l cat:dog <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --default delete
</code></pre></div><p>Example: rename dataset items by a regular expression</p>
<ul>
<li>Replace <code>pattern</code> with <code>replacement</code></li>
<li>Remove <code>frame_</code> from item ids</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|pattern|replacement|&#39;</span>
datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|frame_(\d+)|\\1|&#39;</span>
</code></pre></div><p>Example: sampling dataset items as many as the number of target samples with
sampling method entered by the user, divide into <code>sampled</code> and <code>unsampled</code>
subsets</p>
<ul>
<li>There are five methods of sampling the m option.
<ul>
<li><code>topk</code>: Return the k with high uncertainty data</li>
<li><code>lowk</code>: Return the k with low uncertainty data</li>
<li><code>randk</code>: Return the random k data</li>
<li><code>mixk</code>: Return half to topk method and the rest to lowk method</li>
<li><code>randtopk</code>: First, select 3 times the number of k randomly, and return
the topk among them.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t sampler -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -a entropy <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o sampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -u unsampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m topk <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k <span style="color:#0000cf;font-weight:bold">20</span>
</code></pre></div><p>Example : control number of outputs to 100 after NDR</p>
<ul>
<li>There are two methods in NDR e option
<ul>
<li><code>random</code>: sample from removed data randomly</li>
<li><code>similarity</code>: sample from removed data with ascending</li>
</ul>
</li>
<li>There are two methods in NDR u option
<ul>
<li><code>uniform</code>: sample data with uniform distribution</li>
<li><code>inverse</code>: sample data with reciprocal of the number</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t ndr -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -w train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -a gradient <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k <span style="color:#0000cf;font-weight:bold">100</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e random <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -u uniform
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5425ff20f66ad27cecd1cec97424d239">3.7 - Extending</h1>
    
	<p>There are few ways to extend and customize Datumaro behavior, which is
supported by plugins. Check <a href="../../docs/contributing">our contribution guide</a> for
details on plugin implementation. In general, a plugin is a Python code file.
It must be put into a plugin directory:</p>
<ul>
<li><code>&lt;project_dir&gt;/.datumaro/plugins</code> for project-specific plugins</li>
<li><code>&lt;datumaro_dir&gt;/plugins</code> for global plugins</li>
</ul>
<h3 id="built-in-plugins">Built-in plugins</h3>
<p>Datumaro provides several builtin plugins. Plugins can have dependencies,
which need to be installed separately.</p>
<h4 id="tensorflow">TensorFlow</h4>
<p>The plugin provides support of TensorFlow Detection API format, which includes
boxes and masks. It depends on TensorFlow, which can be installed with <code>pip</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install tensorflow
<span style="color:#8f5902;font-style:italic"># or</span>
pip install tensorflow-gpu
<span style="color:#8f5902;font-style:italic"># or</span>
pip install datumaro<span style="color:#ce5c00;font-weight:bold">[</span>tf<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#8f5902;font-style:italic"># or</span>
pip install datumaro<span style="color:#ce5c00;font-weight:bold">[</span>tf-gpu<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><h4 id="accuracy-checker">Accuracy Checker</h4>
<p>This plugin allows to use <a href="https://github.com/openvinotoolkit/open_model_zoo/tree/master/tools/accuracy_checker">Accuracy Checker</a>
to launch deep learning models from various frameworks
(Caffe, MxNet, PyTorch, OpenVINO, &hellip;) through Accuracy Checker&rsquo;s API.
The plugin depends on Accuracy Checker, which can be installed with <code>pip</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install <span style="color:#4e9a06">&#39;git+https://github.com/openvinotoolkit/open_model_zoo.git#subdirectory=tools/accuracy_checker&#39;</span>
</code></pre></div><h4 id="openvino">OpenVINO™</h4>
<p>This plugin provides support for model inference with <a href="https://01.org/openvinotoolkit">OpenVINO™</a>.
The plugin depends on the OpenVINO™ Toolkit, which can be installed by
following <a href="https://docs.openvinotoolkit.org/latest/index.html#packaging_and_deployment">these instructions</a></p>
<h3 id="dataset-formats">Dataset Formats</h3>
<p>Dataset reading is supported by Extractors and Importers.
An Extractor produces a list of dataset items corresponding
to the dataset. An Importer creates a project from the data source location.
It is possible to add custom Extractors and Importers. To do this, you need
to put an Extractor and Importer implementation scripts to a plugin directory.</p>
<p>Dataset writing is supported by Converters.
A Converter produces a dataset of a specific format from dataset items.
It is possible to add custom Converters. To do this, you need to put a Converter
implementation script to a plugin directory.</p>
<h3 id="dataset-conversions-transforms">Dataset Conversions (&ldquo;Transforms&rdquo;)</h3>
<p>A Transform is a function for altering a dataset and producing a new one.
It can update dataset items, annotations, classes, and other properties.
A list of available transforms for dataset conversions can be extended by
adding a Transform implementation script into a plugin directory.</p>
<h3 id="model-launchers">Model launchers</h3>
<p>A list of available launchers for model execution can be extended by adding
a Launcher implementation script into a plugin directory.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-769eb55c675e353516911aa676486a8c">3.8 - Links</h1>
    
	<ul>
<li><a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md">TensorFlow detection model zoo</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/_docs_MO_DG_prepare_model_convert_model_tf_specific_Convert_Object_Detection_API_Models.html">How to convert model to OpenVINO™ format</a></li>
<li><a href="https://github.com/openvinotoolkit/cvat/blob/3e09503ba6c6daa6469a6c4d275a5a8b168dfa2c/components/tf_annotation/install.sh#L23">Model conversion script example</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc8158f50663b4904c0929825f746cef">4 - Dataset Management Framework (Datumaro) API and developer manual</h1>
    
	<h2 id="basics">Basics</h2>
<p>The center part of the library is the <code>Dataset</code> class, which represents
a dataset and allows to iterate over its elements.
<code>DatasetItem</code>, an element of a dataset, represents a single
dataset entry with annotations - an image, video sequence, audio track etc.
It can contain only annotated data or meta information, only annotations, or
all of this.</p>
<p>Basic library usage and data flow:</p>
<pre><code class="language-lang-none" data-lang="lang-none">Extractors -&gt; Dataset -&gt; Converter
                 |
             Filtration
          Transformations
             Statistics
              Merging
             Inference
          Quality Checking
             Comparison
                ...
</code></pre><ol>
<li>Data is read (or produced) by one or many <code>Extractor</code>s and merged
into a <code>Dataset</code></li>
<li>The dataset is processed in some way</li>
<li>The dataset is saved with a <code>Converter</code></li>
</ol>
<p>Datumaro has a number of dataset and annotation features:</p>
<ul>
<li>iteration over dataset elements</li>
<li>filtering of datasets and annotations by a custom criteria</li>
<li>working with subsets (e.g. <code>train</code>, <code>val</code>, <code>test</code>)</li>
<li>computing of dataset statistics</li>
<li>comparison and merging of datasets</li>
<li>various annotation operations</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#8f5902;font-style:italic"># Import and export a dataset</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;src/dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;dst/dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;coco&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Create a dataset, convert polygons to masks, save in PASCAL VOC format</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
  <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">}),</span>
  <span style="color:#000;font-weight:bold">]),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;polygons_to_masks&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;dst/dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="the-dataset-class">The Dataset class</h3>
<p>The <code>Dataset</code> class from the <code>datumaro.components.dataset</code> module represents
a dataset, consisting of multiple <code>DatasetItem</code>s. Annotations are
represented by members of the <code>datumaro.components.extractor</code> module,
such as <code>Label</code>, <code>Mask</code> or <code>Polygon</code>. A dataset can contain items from one or
multiple subsets (e.g. <code>train</code>, <code>test</code>, <code>val</code> etc.), the list of dataset subsets
is available at <code>dataset.subsets</code>.</p>
<p>Datasets typically have annotations, and these annotations can
require additional information to be interpreted correctly. For instance, it
can include class names, class hierarchy, keypoint connections,
class colors for masks, class attributes.
This information is stored in <code>dataset.categories</code>, which is a mapping from
<code>AnnotationType</code> to a corresponding <code>...Categories</code> class. Each annotation type
can have its <code>Categories</code>. Typically, there will be a <code>LabelCategories</code> object.
Annotations and other categories address dataset labels
by their indices in this object.</p>
<p>The main operation for a dataset is iteration over its elements.
An item corresponds to a single image, a video sequence, etc. There are also
few other operations available, such as filtration (<code>dataset.select</code>) and
transformations (<code>dataset.transform</code>). A dataset can be created from extractors
or other datasets with <code>Dataset.from_extractors()</code> and directly from items with
<code>Dataset.from_iterable()</code>. A dataset is an extractor itself. If it is created
from multiple extractors, their categories must match, and their contents
will be merged.</p>
<p>A dataset item is an element of a dataset. Its <code>id</code> is a name of a
corresponding image. There can be some image <code>attributes</code>,
an <code>image</code> and <code>annotations</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#8f5902;font-style:italic"># create a dataset from other datasets</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_extractors</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataset1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dataset2</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># or directly from items</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
  <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000;font-weight:bold">]),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#8f5902;font-style:italic"># keep only annotated images</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">lambda</span> <span style="color:#000">item</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># change dataset labels</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;remap_labels&#39;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># rename cat to dog</span>
    <span style="color:#4e9a06">&#39;truck&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;car&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># rename truck to car</span>
    <span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># remove this label</span>
  <span style="color:#000;font-weight:bold">},</span> <span style="color:#000">default</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;delete&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># iterate over elements</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">:</span>
  <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># iterate over subsets as Datasets</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">subset_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subset</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subsets</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">items</span><span style="color:#000;font-weight:bold">():</span>
  <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">subset</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="projects">Projects</h3>
<p>Projects are intended for complex use of Datumaro. They provide means of
persistence, of extending, and CLI operation for Datasets. A project can
be converted to a Dataset with <code>project.make_dataset</code>. Project datasets
can have multiple data sources, which are merged on dataset creation. They
can have a hierarchy. Project configuration is available in <code>project.config</code>.
A dataset can be saved in <code>datumaro_project</code> format.</p>
<p>The <code>Environment</code> class is responsible for accessing built-in and
project-specific plugins. For a project, there is an instance of
related <code>Environment</code> in <code>project.env</code>.</p>
<h2 id="library-contents">Library contents</h2>
<h3 id="dataset-formats">Dataset Formats</h3>
<p>The framework provides functions to read and write datasets in specific formats.
It is supported by <code>Extractor</code>s, <code>Importer</code>s, and <code>Converter</code>s.</p>
<p>Dataset reading is supported by <code>Extractor</code>s and <code>Importer</code>s:</p>
<ul>
<li>An <code>Extractor</code> produces a list of <code>DatasetItem</code>s corresponding to the
dataset. Annotations are available in the <code>DatasetItem.annotations</code> list</li>
<li>An <code>Importer</code> creates a project from a data source location</li>
</ul>
<p>It is possible to add custom <code>Extractor</code>s and <code>Importer</code>s. To do this, you need
to put an <code>Extractor</code> and <code>Importer</code> implementations to a plugin directory.</p>
<p>Dataset writing is supported by <code>Converter</code>s.
A <code>Converter</code> produces a dataset of a specific format from dataset items.
It is possible to add custom <code>Converter</code>s. To do this, you need to put a
<code>Converter</code> implementation script to a plugin directory.</p>
<h3 id="dataset-conversions-transforms">Dataset Conversions (&ldquo;Transforms&rdquo;)</h3>
<p>A <code>Transform</code> is a function for altering a dataset and producing a new one.
It can update dataset items, annotations, classes, and other properties.
A list of available transforms for dataset conversions can be extended by
adding a <code>Transform</code> implementation script into a plugin directory.</p>
<h3 id="model-launchers">Model launchers</h3>
<p>A list of available launchers for model execution can be extended by
adding a <code>Launcher</code> implementation script into a plugin directory.</p>
<h2 id="plugins">Plugins</h2>
<p>Datumaro comes with a number of built-in formats and other tools,
but it also can be extended by plugins. Plugins are optional components,
which dependencies are not installed by default.
In Datumaro there are several types of plugins, which include:</p>
<ul>
<li><code>extractor</code> - produces dataset items from data source</li>
<li><code>importer</code> - recognizes dataset type and creates project</li>
<li><code>converter</code> - exports dataset to a specific format</li>
<li><code>transformation</code> - modifies dataset items or other properties</li>
<li><code>launcher</code> - executes models</li>
</ul>
<p>A plugin is a regular Python module. It must be present in a plugin directory:</p>
<ul>
<li><code>&lt;project_dir&gt;/.datumaro/plugins</code> for project-specific plugins</li>
<li><code>&lt;datumaro_dir&gt;/plugins</code> for global plugins</li>
</ul>
<p>A plugin can be used either via the <code>Environment</code> class instance,
or by regular module importing:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.project</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Environment</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Project</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.plugins.yolo_format.converter</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">YoloConverter</span>

<span style="color:#8f5902;font-style:italic"># Import a dataset</span>
<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Environment</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_importer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)(</span><span style="color:#000">src_dir</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_dataset</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># Load an existing project, save the dataset in some project-specific format</span>
<span style="color:#000">project</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;project/dir&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">converters</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;custom_format&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">convert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">dst_dir</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Save the dataset in some built-in format</span>
<span style="color:#000">Environment</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">converters</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;yolo&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">convert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">dst_dir</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">YoloConverter</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">convert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">dst_dir</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="writing-a-plugin">Writing a plugin</h3>
<p>A plugin is a Python module with any name, which exports some symbols. Symbols,
starting with <code>_</code> are not exported by default. To export a symbol,
inherit it from one of the special classes:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Importer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Extractor</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Transform</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.launcher</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Launcher</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.converter</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Converter</span>
</code></pre></div><p>The <code>exports</code> list of the module can be used to override default behaviour:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyComponent1</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyComponent2</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#000">exports</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">MyComponent2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#8f5902;font-style:italic"># exports only MyComponent2</span>
</code></pre></div><p>There is also an additional class to modify plugin appearance in command line:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.cli_plugin</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">CliPlugin</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyPlugin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Converter</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CliPlugin</span><span style="color:#000;font-weight:bold">):</span>
  <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Optional documentation text, which will appear in command-line help
</span><span style="color:#4e9a06">  &#34;&#34;&#34;</span>

  <span style="color:#000">NAME</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;optional_custom_plugin_name&#39;</span>

  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">build_cmdline_parser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kwargs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">parser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build_cmdline_parser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kwargs</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#8f5902;font-style:italic"># set up argparse.ArgumentParser instance</span>
    <span style="color:#8f5902;font-style:italic"># the parsed args are supposed to be used as invocation options</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">parser</span>
</code></pre></div><h4 id="plugin-example">Plugin example</h4>
<!--lint disable fenced-code-flag-->
<pre><code>datumaro/plugins/
- my_plugin1/file1.py
- my_plugin1/file2.py
- my_plugin2.py
</code></pre><!--lint enable fenced-code-flag-->
<p><code>my_plugin1/file2.py</code> contents:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Transform</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CliPlugin</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.file1</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">something</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">useful</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyTransform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Transform</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">CliPlugin</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#000">NAME</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;custom_name&#34;</span> <span style="color:#8f5902;font-style:italic"># could be generated automatically</span>

    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Some description. The text will be displayed in the command line output.
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>

    <span style="color:#5c35cc;font-weight:bold">@classmethod</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">build_cmdline_parser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">cls</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kwargs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">parser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">build_cmdline_parser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000">kwargs</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add_argument</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;-q&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">help</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Very useful parameter&#34;</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">parser</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">extractor</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">q</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87">super</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">__init__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">extractor</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#3465a4">self</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">q</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">q</span>

    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">transform_item</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">item</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">item</span>
</code></pre></div><p><code>my_plugin2.py</code> contents:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Extractor</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyFormat</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">_MyFormatConverter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Converter</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#ce5c00;font-weight:bold">...</span>
<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyFormatExtractor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Extractor</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#ce5c00;font-weight:bold">...</span>

<span style="color:#000">exports</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">MyFormat</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#8f5902;font-style:italic"># explicit exports declaration</span>
<span style="color:#8f5902;font-style:italic"># MyFormatExtractor and _MyFormatConverter won&#39;t be exported</span>
</code></pre></div><h2 id="command-line">Command-line</h2>
<p>Basically, the interface is divided on contexts and single commands.
Contexts are semantically grouped commands, related to a single topic or target.
Single commands are handy shorter alternatives for the most used commands
and also special commands, which are hard to be put into any specific context.
<a href="https://www.docker.com/">Docker</a> is an example of similar approach.</p>
<div class="text-center large-scheme">
<pre><code class="language-mermaid" data-lang="mermaid">flowchart LR
    d{datum}
    p((project))
    s((source))
    m((model))
    d==&gt;p
    p==create===&gt;str1([Creates a Datumaro project])
    p==import===&gt;str2([Generates a project from other project or dataset in specific format])
    p==export===&gt;str3([Saves dataset in a specific format])
    p==extract===&gt;str4([Extracts subproject by filter])
    p==merge===&gt;str5([Adds new items to project])
    p==diff===&gt;str6([Compares two projects])
    p==transform===&gt;str7([Applies specific transformation to the dataset])
    p==info===&gt;str8([Outputs valuable info])
    d==&gt;s
    s==add===&gt;str9([Adds data source by its URL])
    s==remove===&gt;str10([Remove source dataset])
    d==&gt;m
    m==add===&gt;str11([Registers model for inference])
    m==remove===&gt;str12([Removes model from project])
    m==run===&gt;str13([Executes network for inference])
    d==&gt;c(create)===&gt;str14([Calls project create])
    d==&gt;a(add)===&gt;str15([Calls source add])
    d==&gt;r(remove)===&gt;str16([Calls source remove])
    d==&gt;e(export)===&gt;str17([Calls project export])
    d==&gt;exp(explain)===&gt;str18([Runs inference explanation])
</code></pre></div>
<p>Model-View-ViewModel (MVVM) UI pattern is used.</p>
<div class="text-center">
<pre><code class="language-mermaid" data-lang="mermaid">flowchart LR
    c((CLI))&lt;--CliModel---&gt;d((Domain))
    g((GUI))&lt;--GuiModel---&gt;d
    a((API))&lt;---&gt;d
    t((Tests))&lt;---&gt;d
</code></pre></div>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c4f3b7b6687248fa052de696ab2cf167">5 - Formats</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-1646a51944fb0a27e86b592702a3eda8">5.1 - ADE20k (v2017)</h1>
    
	<h2 id="format-specification">Format specification</h2>
<ul>
<li>
<p>The original ADE20K 2017 dataset is available
<a href="https://www.kaggle.com/soumikrakshit/ade20k">here</a>.</p>
</li>
<li>
<p>Also the consistency set (for checking the annotation consistency)
is available <a href="https://groups.csail.mit.edu/vision/datasets/ADE20K/ADE20K_2017_05_30_consistency.zip">here</a>.</p>
</li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>Masks</code></li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>occluded</code> (boolean): whether the object is occluded by another object</li>
<li>other arbitrary boolean attributes, which can be specified
in the annotation file <code>&lt;image_name&gt;_atr.txt</code></li>
</ul>
<h2 id="load-ade20k-2017-dataset">Load ADE20K 2017 dataset</h2>
<p>There are two ways to create Datumaro project and add ADE20K to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format ade20k2017 --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f ade20k2017 &lt;path/to/dataset&gt;
</code></pre></div><p>Also it is possible to load dataset using Python API:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">ade20k_dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&lt;path/to/dataset&gt;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ade20k2017&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>ADE20K dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>dataset/
├── subset1/
│   └── super_label_1/
│       ├── img1.jpg
│       ├── img1_atr.txt
│       ├── img1_parts_1.png
│       ├── img1_seg.png
│       ├── img2.jpg
│       ├── img2_atr.txt
│       └── ...
└── subset2/
    ├── img3.jpg
    ├── img3_atr.txt
    ├── img3_parts_1.png
    ├── img3_parts_2.png
    ├── img4.jpg
    ├── img4_atr.txt
    ├── img4_seg.png
    └── ...
</code></pre><p>The mask images <code>&lt;image_name&gt;_seg.png</code> contain information about the object
class segmentation masks and also separates each class into instances.
The channels R and G encode the objects class masks.
The channel B encodes the instance object masks.</p>
<p>The mask images <code>&lt;image_name&gt;_parts_N.png</code> contain segmentation mask for parts
of objects, where N is a number indicating the level in the part hierarchy.</p>
<p>The annotation files <code>&lt;image_name&gt;_atr.txt</code> describing the content of each
image. Each line in the text file contains:</p>
<ul>
<li>column 1: instance number,</li>
<li>column 2: part level (0 for objects),</li>
<li>column 3: occluded (1 for true),</li>
<li>column 4: original raw name (might provide a more detailed categorization),</li>
<li>column 5: class name (parsed using wordnet),</li>
<li>column 6: double-quoted list of attributes, separated by commas.
Each column is separated by a <code>#</code>. See example of dataset
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/ade20k2017_dataset">here</a>.</li>
</ul>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert ADE20K into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
To get the expected result, convert the dataset to a format
that supports segmentation masks.</p>
<p>There are a few ways to convert ADE20k 2017 to other dataset format using CLI:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -f ade20k2017 -i &lt;path/to/dataset&gt;
datum <span style="color:#204a87">export</span> -f coco -o ./save_dir -- --save-images
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if ade20k2017 -i &lt;path/to/dataset&gt; -f coco -o ./save_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --save-images
</code></pre></div><p>Or using Python API</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&lt;path/to/dataset&gt;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ade202017&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;save_dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;coco&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="examples">Examples</h2>
<p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/blob/develop/tests/test_ade20k2017_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-22c9ec5acd736f4b76466752445697c5">5.2 - ADE20k (v2020)</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>The original ADE20K 2020 dataset is available
<a href="https://groups.csail.mit.edu/vision/datasets/ADE20K/">here</a>.</p>
<p>Also the consistency set (for checking the annotation consistency)
is available <a href="https://groups.csail.mit.edu/vision/datasets/ADE20K/ADE20K_2017_05_30_consistency.zip">here</a>.</p>
<p>Supported annotation types:</p>
<ul>
<li><code>Masks</code></li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>occluded</code> (boolean): whether the object is occluded by another object</li>
<li>other arbitrary boolean attributes, which can be specified
in the annotation file <code>&lt;image_name&gt;.json</code></li>
</ul>
<h2 id="load-ade20k-dataset">Load ADE20K dataset</h2>
<p>There are two ways to create Datumaro project and add ADE20K to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format ade20k2020 --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f ade20k2020 &lt;path/to/dataset&gt;
</code></pre></div><p>Also it is possible to load dataset using Python API:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">ade20k_dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&lt;path/to/dataset&gt;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ade20k2020&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>ADE20K dataset directory should has the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>dataset/
├── subset1/
│   ├── img1/  # directory with instance masks for img1
│   |    ├── instance_001_img1.png
│   |    ├── instance_002_img1.png
│   |    └── ...
│   ├── img1.jpg
│   ├── img1.json
│   ├── img1_seg.png
│   ├── img1_parts_1.png
│   |
│   ├── img2/  # directory with instance masks for img2
│   |    ├── instance_001_img2.png
│   |    ├── instance_002_img2.png
│   |    └── ...
│   ├── img2.jpg
│   ├── img2.json
│   └── ...
│
└── subset2/
    ├── super_label_1/
    |   ├── img3/  # directory with instance masks for img3
    |   |    ├── instance_001_img3.png
    |   |    ├── instance_002_img3.png
    |   |    └── ...
    |   ├── img3.jpg
    |   ├── img3.json
    |   ├── img3_seg.png
    |   ├── img3_parts_1.png
    |   └── ...
    |
    ├── img4/  # directory with instance masks for img4
    |   ├── instance_001_img4.png
    |   ├── instance_002_img4.png
    |   └── ...
    ├── img4.jpg
    ├── img4.json
    ├── img4_seg.png
    └── ...
</code></pre><p>The mask images <code>&lt;image_name&gt;_seg.png</code> contain information about the object
class segmentation masks and also separates each class into instances.
The channels R and G encode the objects class masks.
The channel B encodes the instance object masks.</p>
<p>The mask images <code>&lt;image_name&gt;_parts_N.png</code> contain segmentation mask for
parts of objects, where N is a number indicating the level in the part
hierarchy.</p>
<p>The <code>&lt;image_name&gt;</code> directory contains instance masks for each
object in the image, these masks represent one-channel images,
each pixel of which indicates an affinity to a specific object.</p>
<p>The annotation files <code>&lt;image_name&gt;.json</code> describing the content of each image.
See our <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/assets/ade20k2020_dataset">tests asset</a>
for example of this file,
or check <a href="https://github.com/CSAILVision/ADE20K">ADE20K toolkit</a> for it.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert ADE20K into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
To get the expected result, convert the dataset to a format
that supports segmentation masks.</p>
<p>There are a few ways to convert ADE20k to other dataset format using CLI:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -f ade20k2020 -i &lt;path/to/dataset&gt;
datum <span style="color:#204a87">export</span> -f coco -o ./save_dir -- --save-images
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if ade20k2020 -i &lt;path/to/dataset&gt; -f coco -o ./save_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --save-images
</code></pre></div><p>Or using Python API</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;&lt;path/to/dataset&gt;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ade20k2020&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;save_dir&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="examples">Examples</h2>
<p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/blob/develop/tests/test_ade20k2020_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ddb50cccf6304e9bb85b1b9fb0369c48">5.3 - CIFAR</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>CIFAR format specification is available <a href="https://www.cs.toronto.edu/~kriz/cifar.html">here</a>.</p>
<p>Supported annotation types:</p>
<ul>
<li><code>Label</code></li>
</ul>
<p>Datumaro supports Python version CIFAR-10/100.
The difference between CIFAR-10 and CIFAR-100 is how labels are stored
in the meta files (<code>batches.meta</code> or <code>meta</code>) and in the annotation files.
The 100 classes in the CIFAR-100 are grouped into 20 superclasses. Each image
comes with a &ldquo;fine&rdquo; label (the class to which it belongs) and a &ldquo;coarse&rdquo; label
(the superclass to which it belongs). In CIFAR-10 there are no superclasses.</p>
<p>CIFAR formats contains 32 x 32 images. As an extension, Datumaro supports
reading and writing of arbitrary-sized images.</p>
<h2 id="load-cifar-dataset">Load CIFAR dataset</h2>
<p>The CIFAR dataset is available for free download:</p>
<ul>
<li><a href="https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz">cifar-10-python.tar.gz</a>:
CIFAR-10 python version</li>
<li><a href="https://www.cs.toronto.edu/~kriz/cifar-100-python.tar.gz">cifar-100-python.tar.gz</a>:
CIFAR-100 python version</li>
</ul>
<p>There are two ways to create Datumaro project and add CIFAR dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format cifar --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f cifar &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory run
<code>datum create --help</code> for more information.</p>
<p>CIFAR-10 dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── batches.meta
    ├── &lt;subset_name1&gt;
    ├── &lt;subset_name2&gt;
    └── ...
</code></pre><p>CIFAR-100 dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── meta
    ├── &lt;subset_name1&gt;
    ├── &lt;subset_name2&gt;
    └── ...
</code></pre><p>Dataset files use <a href="https://docs.python.org/3/library/pickle.html">Pickle</a>
data format.</p>
<p>Meta files:</p>
<!--lint disable fenced-code-flag-->
<pre><code>CIFAR-10:
    num_cases_per_batch: 1000
    label_names: list of strings (['airplane', 'automobile', 'bird', ...])
    num_vis: 3072

CIFAR-100:
    fine_label_names: list of strings (['apple', 'aquarium_fish', ...])
    coarse_label_names: list of strings (['aquatic_mammals', 'fish', ...])
</code></pre><p>Annotation files:</p>
<!--lint disable fenced-code-flag-->
<pre><code>Common:
    'batch_label': 'training batch 1 of &lt;N&gt;'
    'data': numpy.ndarray of uint8, layout N x C x H x W
    'filenames': list of strings

    If images have non-default size (32x32) (Datumaro extension):
        'image_sizes': list of (H, W) tuples

CIFAR-10:
    'labels': list of strings

CIFAR-100:
    'fine_labels': list of integers
    'coarse_labels': list of integers
</code></pre><h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert CIFAR dataset into any other format <a href="../../docs/user-manual/supported-formats">Datumaro supports</a>.
To get the expected result, convert the dataset to formats
that support the classification task (e.g. MNIST, ImageNet, PascalVOC,
etc.) There are few ways to convert CIFAR dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f cifar -i &lt;path/to/cifar&gt;
datum <span style="color:#204a87">export</span> -f imagenet -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if cifar -i &lt;path/to/cifar&gt; -f imagenet -o &lt;path/to/output/dir&gt;
</code></pre></div><h2 id="export-to-cifar">Export to CIFAR</h2>
<p>There are few ways to convert dataset to CIFAR format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into CIFAR format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f cifar -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to CIFAR format from other format</span>
datum convert -if imagenet -i &lt;path/to/imagenet/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f cifar -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for export to CIFAR format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(by default <code>False</code>);</li>
<li><code>--image-ext &lt;IMAGE_EXT&gt;</code> allow to specify image extension
for exporting dataset (by default <code>.png</code>).</li>
</ul>
<p>The format (CIFAR-10 or CIFAR-100) in which the dataset will be
exported depends on the presence of superclasses in the <code>LabelCategories</code>.</p>
<h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the CIFAR format in particular. Follow <a href="../../docs/user-manual">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with CIFAR dataset:</p>
<h3 id="example-1-how-to-create-custom-cifar-like-dataset">Example 1. How to create custom CIFAR-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)]</span>
    <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">)]</span>
    <span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;airplane&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;automobile&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;bird&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;deer&#39;</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;frog&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;horse&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;ship&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;truck&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cifar&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="example-2-how-to-filter-and-convert-cifar-dataset-to-imagenet">Example 2. How to filter and convert CIFAR dataset to ImageNet</h3>
<p>Convert CIFAR dataset to ImageNet format, keep only images with <code>dog</code> class
presented:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Download CIFAR-10 dataset:</span>
<span style="color:#8f5902;font-style:italic"># https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz</span>
datum convert --input-format cifar --input-path &lt;path/to/cifar&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format imagenet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --filter <span style="color:#4e9a06">&#39;/item[annotation/label=&#34;dog&#34;]&#39;</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/blob/develop/tests/test_cifar_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b4837f6e880fb91ac1bc5f75998df382">5.4 - Cityscapes</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>Cityscapes format overview is available <a href="https://www.cityscapes-dataset.com/dataset-overview/">here</a>.
Cityscapes format specification is available <a href="https://github.com/mcordts/cityscapesScripts#the-cityscapes-dataset">here</a>.</p>
<p>Supported annotation types:</p>
<ul>
<li><code>Masks</code></li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>is_crowd</code> (boolean). Specifies if the annotation label can
distinguish between different instances.
If <code>False</code>, the annotation <code>id</code> field encodes the instance id.</li>
</ul>
<h2 id="load-cityscapes-dataset">Load Cityscapes dataset</h2>
<p>The Cityscapes dataset is available for free <a href="https://www.cityscapes-dataset.com/downloads/">download</a>.</p>
<p>There are two ways to create Datumaro project and add Cityscapes dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format cityscapes --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f cityscapes &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory run
<code>datum create --help</code> for more information.</p>
<p>Cityscapes dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── imgsFine/
    │   ├── leftImg8bit
    │   │   ├── &lt;split: train,val, ...&gt;
    │   │   |   ├── {city1}
    │   │   │   |   ├── {city1}_{seq:[0...6]}_{frame:[0...6]}_leftImg8bit.png
    │   │   │   │   └── ...
    │   │   |   ├── {city2}
    │   │   │   └── ...
    │   │   └── ...
    └── gtFine/
        ├── &lt;split: train,val, ...&gt;
        │   ├── {city1}
        │   |   ├── {city1}_{seq:[0...6]}_{frame:[0...6]}_gtFine_color.png
        │   |   ├── {city1}_{seq:[0...6]}_{frame:[0...6]}_gtFine_instanceIds.png
        │   |   ├── {city1}_{seq:[0...6]}_{frame:[0...6]}_gtFine_labelIds.png
        │   │   └── ...
        │   ├── {city2}
        │   └── ...
        └── ...
</code></pre><p>Annotated files description:</p>
<ol>
<li><code>*_leftImg8bit.png</code> - left images in 8-bit LDR format</li>
<li><code>*_color.png</code> - class labels encoded by its color</li>
<li><code>*_labelIds.png</code> - class labels are encoded by its index</li>
<li><code>*_instanceIds.png</code> - class and instance labels encoded by an instance ID.
The pixel values encode class and the individual instance: the integer part
of a division by 1000 of each ID provides class ID, the remainder
is the instance ID. If a certain annotation describes multiple instances,
then the pixels have the regular ID of that class</li>
</ol>
<p>To make sure that the selected dataset has been added to the project, you can
run <code>datum info</code>, which will display the project and dataset information.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert Cityscapes dataset into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
To get the expected result, convert the dataset to formats
that support the segmentation task (e.g. PascalVOC, CamVID, etc.)
There are few ways to convert Cityscapes dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f cityscapes -i &lt;path/to/cityscapes&gt;
datum <span style="color:#204a87">export</span> -f voc -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if cityscapes -i &lt;path/to/cityscapes&gt; -f voc -o &lt;path/to/output/dir&gt;
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-cityscapes">Export to Cityscapes</h2>
<p>There are few ways to convert dataset to Cityscapes format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into Cityscapes format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f cityscapes -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to Cityscapes format from other format</span>
datum convert -if voc -i &lt;path/to/voc/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f cityscapes -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for export to cityscapes format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(by default <code>False</code>);</li>
<li><code>--image-ext IMAGE_EXT</code> allow to specify image extension
for exporting dataset (by default - keep original or use <code>.png</code>, if none).</li>
<li><code>--label_map</code> allow to define a custom colormap. Example</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># mycolormap.txt :</span>
<span style="color:#8f5902;font-style:italic"># 0 0 255 sky</span>
<span style="color:#8f5902;font-style:italic"># 255 0 0 person</span>
<span style="color:#8f5902;font-style:italic">#...</span>
datum <span style="color:#204a87">export</span> -f cityscapes -- --label-map mycolormap.txt

<span style="color:#8f5902;font-style:italic"># or you can use original cityscapes colomap:</span>
datum <span style="color:#204a87">export</span> -f cityscapes -- --label-map cityscapes
</code></pre></div><h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the Cityscapes format in particular. Follow
<a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with Cityscapes dataset:</p>
<h3 id="example-1-load-the-original-cityscapes-dataset-and-convert-to-pascal-voc">Example 1. Load the original Cityscapes dataset and convert to Pascal VOC</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f cityscapes ./Cityscapes/
datum stats -p project
datum <span style="color:#204a87">export</span> -p final_project -o dataset -f voc -- --save-images
</code></pre></div><h3 id="example-2-create-a-custom-cityscapes-like-dataset">Example 2. Create a custom Cityscapes-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datumaro.plugins.cityscapes_format</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">Cityscapes</span>

<span style="color:#000">label_map</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">OrderedDict</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;background&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;label_1&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;label_2&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">categories</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Cityscapes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_cityscapes_categories</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
            <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;is_crowd&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">}),</span>
        <span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">categories</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;cityscapes&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_cityscapes_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f3691abbbae7eae85ce83b256e5aec64">5.5 - COCO</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>COCO format specification available <a href="https://cocodataset.org/#format-data">here</a>.</p>
<p>The dataset has annotations for multiple tasks. Each task has its own format
in Datumaro, and there is also a combined <code>coco</code> format, which includes all
the available tasks. The sub-formats have the same options as the &ldquo;main&rdquo;
format and only limit the set of annotation files they work with. To work with
multiple formats, use the corresponding option of the <code>coco</code> format.</p>
<p>Supported tasks / formats:</p>
<ul>
<li>The combined format - <code>coco</code></li>
<li><a href="https://cocodataset.org/#captions-2015">Image Captioning</a> - <code>coco_caption</code></li>
<li><a href="https://cocodataset.org/#detection-2020">Object Detection</a> - <code>coco_instances</code></li>
<li><a href="https://cocodataset.org/#panoptic-2020">Panoptic Segmentation</a> - <code>coco_panoptic</code></li>
<li><a href="https://cocodataset.org/#keypoints-2020">Keypoint Detection</a> - <code>coco_person_keypoints</code></li>
<li><a href="https://cocodataset.org/#stuff-2019">Stuff Segmentation</a> - <code>coco_stuff</code></li>
<li>Image Info - <code>coco_image_info</code></li>
<li>Image classification (Datumaro extension) - <code>coco_labels</code>. The format is like
Object Detection, but uses only <code>category_id</code> and <code>score</code> annotation fields.</li>
</ul>
<p>Supported annotation types (depending on the task):</p>
<ul>
<li><code>Caption</code> (captions)</li>
<li><code>Label</code> (label, Datumaro extension)</li>
<li><code>Bbox</code> (instances, person keypoints)</li>
<li><code>Polygon</code> (instances, person keypoints)</li>
<li><code>Mask</code> (instances, person keypoints, panoptic, stuff)</li>
<li><code>Points</code> (person keypoints)</li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>is_crowd</code> (boolean; on <code>bbox</code>, <code>polygon</code> and <code>mask</code> annotations) - Indicates
that the annotation covers multiple instances of the same class.</li>
<li><code>score</code> (number; range [0; 1]) - Indicates the confidence in this
annotation. Ground truth annotations always have 1.</li>
<li>arbitrary attributes (string/number) - A Datumaro extension. Stored
in the <code>attributes</code> section of the annotation descriptor.</li>
</ul>
<h2 id="load-coco-dataset">Load COCO dataset</h2>
<p>The COCO dataset is available for free download:</p>
<p>Images:</p>
<ul>
<li><a href="http://images.cocodataset.org/zips/train2017.zip">train images</a></li>
<li><a href="http://images.cocodataset.org/zips/val2017.zip">val images</a></li>
<li><a href="http://images.cocodataset.org/zips/test2017.zip">test images</a></li>
<li><a href="http://images.cocodataset.org/zips/unlabeled2017.zip">unlabeled images</a></li>
</ul>
<p>Annotations:</p>
<ul>
<li><a href="http://images.cocodataset.org/annotations/annotations_trainval2017.zip">captions</a></li>
<li><a href="http://images.cocodataset.org/annotations/image_info_test2017.zip">image_info</a></li>
<li><a href="http://images.cocodataset.org/annotations/annotations_trainval2017.zip">instances</a></li>
<li><a href="http://images.cocodataset.org/annotations/panoptic_annotations_trainval2017.zip">panoptic</a></li>
<li><a href="http://images.cocodataset.org/annotations/annotations_trainval2017.zip">person_keypoints</a></li>
<li><a href="http://images.cocodataset.org/annotations/stuff_annotations_trainval2017.zip">stuff</a></li>
</ul>
<p>There are two ways to create Datumaro project and add COCO dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format coco --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f coco &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory, run
<code>datum create --help</code> for more information.</p>
<p>A COCO dataset directory should have the following layout:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── images/
    │   ├── train&lt;year&gt;/
    │   │   ├── &lt;image_name1.ext&gt;
    │   │   ├── &lt;image_name2.ext&gt;
    │   │   └── ...
    │   └── val&lt;year&gt;/
    │       ├── &lt;image_name1.ext&gt;
    │       ├── &lt;image_name2.ext&gt;
    │       └── ...
    └── annotations/
        ├── &lt;task&gt;_&lt;subset_name&gt;&lt;year&gt;.json
        └── ...
</code></pre><p>For the panoptic task, a dataset directory should have the following layout:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── images/
    │   ├── train&lt;year&gt;
    │   │   ├── &lt;image_name1.ext&gt;
    │   │   ├── &lt;image_name2.ext&gt;
    │   │   └── ...
    │   ├── val&lt;year&gt;
    │   │   ├── &lt;image_name1.ext&gt;
    │   │   ├── &lt;image_name2.ext&gt;
    │   │   └── ...
    └── annotations/
        ├── panoptic_train&lt;year&gt;/
        │   ├── &lt;image_name1.ext&gt;
        │   ├── &lt;image_name2.ext&gt;
        │   └── ...
        ├── panoptic_train&lt;year&gt;.json
        ├── panoptic_val&lt;year&gt;/
        │   ├── &lt;image_name1.ext&gt;
        │   ├── &lt;image_name2.ext&gt;
        │   └── ...
        └── panoptic_val&lt;year&gt;.json
</code></pre><p>Annotation files must have the names like <code>&lt;task&gt;_&lt;subset_name&gt;&lt;year&gt;.json</code>.</p>
<p>You can import dataset for one or few tasks
instead of the whole dataset. This option also allows to import annotation
files with non-default names. For example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format coco_stuff --input-path &lt;path/to/stuff.json&gt;
</code></pre></div><p>To make sure that the selected dataset has been added to the project, you can
run <code>datum info</code>, which will display the project and dataset information.</p>
<p>Notes:</p>
<ul>
<li>COCO categories can have any integer ids, however, Datumaro will count
annotation category id 0 as &ldquo;not specified&rdquo;. This does not contradict
the original annotations, because they have category indices starting from 1.</li>
</ul>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert COCO dataset into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
To get the expected result, convert the dataset to formats
that support the specified task (e.g. for panoptic segmentation - VOC, CamVID)
There are few ways to convert COCO dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f coco -i &lt;path/to/coco&gt;
datum <span style="color:#204a87">export</span> -f voc -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if coco -i &lt;path/to/coco&gt; -f voc -o &lt;path/to/output/dir&gt;
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-coco">Export to COCO</h2>
<p>There are few ways to convert dataset to COCO format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into COCO format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f coco -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to COCO format from other format</span>
datum convert -if voc -i &lt;path/to/voc/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f coco -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for export to COCO format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(by default <code>False</code>);</li>
<li><code>--image-ext IMAGE_EXT</code> allow to specify image extension
for exporting dataset (by default - keep original or use <code>.jpg</code>, if none);</li>
<li><code>--segmentation-mode MODE</code> allow to specify save mode for instance
segmentation:
<ul>
<li>&lsquo;guess&rsquo;: guess the mode for each instance
(using &lsquo;is_crowd&rsquo; attribute as hint)</li>
<li>&lsquo;polygons&rsquo;: save polygons( merge and convert masks, prefer polygons)</li>
<li>&lsquo;mask&rsquo;: save masks (merge and convert polygons, prefer masks)
(by default <code>guess</code>);</li>
</ul>
</li>
<li><code>--crop-covered</code> allow to crop covered segments so that background objects
segmentation was more accurate (by default <code>False</code>);</li>
<li><code>--allow-attributes ALLOW_ATTRIBUTES</code> allow export of attributes
(by default <code>True</code>);</li>
<li><code>--reindex REINDEX</code> allow to assign new indices to images and annotations,
useful to avoid merge conflicts (by default <code>False</code>);</li>
<li><code>--merge-images</code> allow to save all images into a single directory
(by default <code>False</code>);</li>
<li><code>--tasks TASKS</code> allow to specify tasks for export dataset,
by default Datumaro uses all tasks. Example:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f coco -i &lt;dataset&gt;
datum <span style="color:#204a87">export</span> -p project -f coco -- --tasks instances,stuff
</code></pre></div><h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the COCO format in particular. Follow
<a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with COCO dataset:</p>
<h3 id="example-1-how-to-load-an-original-panoptic-coco-dataset-and-convert-to-pascal-voc">Example 1. How to load an original panoptic COCO dataset and convert to Pascal VOC</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f coco_panoptic ./COCO/annotations/panoptic_val2017.json
datum stats -p project
datum <span style="color:#204a87">export</span> -p final_project -o dataset -f voc  --overwrite  -- --save-images
</code></pre></div><h3 id="example-2-how-to-create-custom-coco-like-dataset">Example 2. How to create custom COCO-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;000000000001&#39;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
                <span style="color:#000">subset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;val&#39;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">40</span><span style="color:#000;font-weight:bold">},</span>
                <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;is_crowd&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">}),</span>
                    <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;is_crowd&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">}),</span>
                <span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;a&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;b&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;c&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;d&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;coco_panoptic&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_coco_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-69397e43070456769c1b4fdb55f75baf">5.6 - Image zip</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>The image zip format allow to export/import unannotated datasets
with images to/from zip archive. The format doesn&rsquo;t support any
annotations or attributes.</p>
<h2 id="load-image-zip-dataset">Load Image zip dataset</h2>
<p>Few ways to load unannotated datasets to your Datumaro project:</p>
<ul>
<li>From existing archive:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f image_zip -i ./images.zip
</code></pre></div><ul>
<li>From directory with zip archives. Datumaro will loaded images from
all zip files in the directory:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f image_zip -i ./foo
</code></pre></div><p>The directory with zip archives should have the following structure:</p>
<pre><code>└── foo/
    ├── archive1.zip/
    |   ├── image_1.jpg
    |   ├── image_2.png
    |   ├── subdir/
    |   |   ├── image_3.jpg
    |   |   └── ...
    |   └── ...
    ├── archive2.zip/
    |   ├── image_101.jpg
    |   ├── image_102.jpg
    |   └── ...
    ...
</code></pre><p>Images in a archives should have supported extension,
follow the <a href="../../docs/user-manual/data-formats/">user manual</a> to see the supported
extensions.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can load dataset images from a zip archive and convert it to
<a href="../../docs/user-manual/supported-formats">another supported dataset format</a>,
for example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f image_zip -i ./images.zip
datum <span style="color:#204a87">export</span> -f coco -o ./new_dir -- --save-images
</code></pre></div><h2 id="export-unannotated-dataset-to-zip-archive">Export unannotated dataset to zip archive</h2>
<p>Example: exporting images from VOC dataset to zip archives:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f voc -i ./VOC2012
datum <span style="color:#204a87">export</span> -f image_zip -o ./ --overwrite -- --name voc_images.zip <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --compression ZIP_DEFLATED
</code></pre></div><p>Extra options for export to image_zip format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(default: <code>False</code>);</li>
<li><code>--image-ext &lt;IMAGE_EXT&gt;</code> allow to specify image extension
for exporting dataset (default: use original or <code>.jpg</code>, if none);</li>
<li><code>--name</code> name of output zipfile (default: <code>default.zip</code>);</li>
<li><code>--compression</code> allow to specify archive compression method.
Available methods:
<code>ZIP_STORED</code>, <code>ZIP_DEFLATED</code>, <code>ZIP_BZIP2</code>, <code>ZIP_LZMA</code> (default: <code>ZIP_STORED</code>).
Follow <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">zip documentation</a>
for more information.</li>
</ul>
<h2 id="examples">Examples</h2>
<p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_image_zip_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bc1c599a20f4d5c48cfd2ed514e3f166">5.7 - Velodyne Points / KITTI Raw 3D</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>Velodyne Points / KITTI Raw 3D data format:</p>
<ul>
<li><a href="http://www.cvlibs.net/datasets/kitti/raw_data.php">home page</a>.</li>
<li><a href="https://s3.eu-central-1.amazonaws.com/avg-kitti/devkit_raw_data.zip">specification</a></li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>Cuboid3d</code> (represent tracks)</li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>truncation</code> (write, string), possible values: <code>truncation_unset</code>,
<code>in_image</code>, <code>truncated</code>, <code>out_image</code>, <code>behind_image</code> (case-independent).</li>
<li><code>occlusion</code> (write, string), possible values: <code>occlusion_unset</code>, <code>visible</code>,
<code>partly</code>, <code>fully</code> (case-independent). This attribute has priority
over <code>occluded</code>.</li>
<li><code>occluded</code> (read/write, boolean)</li>
<li><code>keyframe</code> (read/write, boolean). Responsible for <code>occlusion_kf</code> field.</li>
<li><code>track_id</code> (read/write, integer). Indicates the group over frames for
annotations, represent tracks.</li>
</ul>
<p>Supported image attributes:</p>
<ul>
<li><code>frame</code> (read/write, integer). Indicates frame number of the image.</li>
</ul>
<h2 id="import-kitti-raw-dataset">Import KITTI Raw dataset</h2>
<p>The velodyne points/KITTI Raw dataset is available for downloading
<a href="http://www.cvlibs.net/datasets/kitti/raw_data.php">here</a> and
<a href="https://cloud.enterprise.deepsystems.io/s/YcyfIf5zrS7NZcI/download">here</a>.</p>
<p>KITTI Raw dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── image_00/ # optional, aligned images from different cameras
    │   └── data/
    │       ├── &lt;name1.ext&gt;
    │       └── &lt;name2.ext&gt;
    ├── image_01/
    │   └── data/
    │       ├── &lt;name1.ext&gt;
    │       └── &lt;name2.ext&gt;
    ...
    │
    ├── velodyne_points/ # optional, 3d point clouds
    │   └── data/
    │       ├── &lt;name1.pcd&gt;
    │       └── &lt;name2.pcd&gt;
    ├── tracklet_labels.xml
    └── frame_list.txt # optional, required for custom image names

</code></pre><p>The format does not support arbitrary image names and paths, but Datumaro
provides an option to use a special index file to allow this.</p>
<p><code>frame_list.txt</code> contents:</p>
<pre><code>12345 relative/path/to/name1/from/data
46 relative/path/to/name2/from/data
...
</code></pre><p>There are two ways to create Datumaro project and add KITTI dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format kitti_raw --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f kitti_raw &lt;path/to/dataset&gt;
</code></pre></div><p>To make sure that the selected dataset has been added to the project,
you can run <code>datum info</code>, which will display the project and dataset
information.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert KITTI Raw dataset into any other
format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.</p>
<p>Such conversion will only be successful if the output
format can represent the type of dataset you want to convert,
e.g. 3D point clouds can be saved in Supervisely Point Clouds format,
but not in COCO keypoints.</p>
<p>There are few ways to convert KITTI Raw dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -f kitti_raw -i &lt;path/to/kitti_raw&gt; -o proj/
datum <span style="color:#204a87">export</span> -f sly_pointcloud -o &lt;path/to/output/dir&gt; -p proj/
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if kitti_raw -i &lt;path/to/kitti_raw&gt; -f sly_pointcloud
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-kitti-raw">Export to KITTI Raw</h2>
<p>There are few ways to convert dataset to KITTI Raw format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into KITTI Raw format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f kitti_raw -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to KITTI Raw format from other format</span>
datum convert -if sly_pointcloud -i &lt;path/to/sly_pcd/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f kitti_raw -o &lt;path/to/export/dir&gt; -- --save-images --reindex
</code></pre></div><p>Extra options for exporting in KITTI Raw format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images. This will
include point clouds and related images (by default <code>False</code>)</li>
<li><code>--image-ext IMAGE_EXT</code> allow to specify image extension
for exporting dataset (by default - keep original or use <code>.png</code>, if none)</li>
<li><code>--reindex</code> assigns new indices to frames and tracks. Allows annotations
without <code>track_id</code> attribute (they will be exported as single-frame tracks).</li>
<li><code>--allow-attrs</code> allows writing arbitrary annotation attributes. They will
be written in <code>&lt;annotations&gt;</code> section of <code>&lt;poses&gt;&lt;item&gt;</code>
(disabled by default)</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="example-1-import-dataset-compute-statistics">Example 1. Import dataset, compute statistics</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f kitti_raw ../../kitti_raw/
datum stats -p project
</code></pre></div><h3 id="example-2-convert-supervisely-pointclouds-to-kitti-raw">Example 2. Convert Supervisely Pointclouds to KITTI Raw</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert -if sly_pointcloud -i ../sly_pcd/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f kitti_raw -o my_kitti/ -- --save-images --allow-attrs
</code></pre></div><h3 id="example-3-create-a-custom-dataset">Example 3. Create a custom dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;some/name/qq&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">13.54</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">9.41</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.24</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;track_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">}),</span>

            <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3.4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2.11</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4.4</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;track_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">})</span>
        <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000">pcd</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;path/to/pcd1.pcd&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">related_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#4e9a06">&#39;path/to/image2.png&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;image3.jpg&#39;</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;frame&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;my_dataset/&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;kitti_raw&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_kitti_raw_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-342fda6e82df12e35a4cf02ae46d4bab">5.8 - KITTI</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>The KITTI dataset has many annotations for different tasks. Datumaro supports
only few of them.</p>
<p>Supported tasks / formats:</p>
<ul>
<li><a href="http://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark">Object Detection</a> - <code>kitti_detection</code>
The format specification is available in <code>README.md</code> <a href="https://s3.eu-central-1.amazonaws.com/avg-kitti/devkit_object.zip">here</a>.</li>
<li><a href="http://www.cvlibs.net/datasets/kitti/eval_semseg.php?benchmark=semantics2015">Segmentation</a> - <code>kitti_segmentation</code>
The format specification is available in <code>README.md</code> <a href="https://s3.eu-central-1.amazonaws.com/avg-kitti/devkit_semantics.zip">here</a>.</li>
<li>Raw 3D / Velodyne Points - described <a href="../../kitti_raw.md">here</a></li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>Bbox</code> (object detection)</li>
<li><code>Mask</code> (segmentation)</li>
</ul>
<p>Supported attributes:</p>
<ul>
<li><code>truncated</code> (boolean) - indicates that the bounding box specified for
the object does not correspond to the full extent of the object</li>
<li><code>occluded</code> (boolean) - indicates that a significant portion of the object
within the bounding box is occluded by another object</li>
</ul>
<h2 id="load-kitti-dataset">Load KITTI dataset</h2>
<p>The KITTI left color images for object detection are available <a href="http://www.cvlibs.net/download.php?file=data_object_image_2.zip">here</a>.
The KITTI object detection labels are available <a href="http://www.cvlibs.net/download.php?file=data_object_label_2.zip">here</a>.
The KITTI segmentation dataset is available <a href="http://www.cvlibs.net/download.php?file=data_semantics.zip">here</a>.</p>
<p>There are two ways to create Datumaro project and add KITTI dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format kitti --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f kitti &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory run
<code>datum create --help</code> for more information.</p>
<p>KITTI segmentation dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── testing/
    │   └── image_2/
    │       ├── &lt;name_1&gt;.&lt;img_ext&gt;
    │       ├── &lt;name_2&gt;.&lt;img_ext&gt;
    │       └── ...
    └── training/
        ├── image_2/ # left color camera images
        │   ├── &lt;name_1&gt;.&lt;img_ext&gt;
        │   ├── &lt;name_2&gt;.&lt;img_ext&gt;
        │   └── ...
        ├── label_2/ # left color camera label files
        │   ├── &lt;name_1&gt;.txt
        │   ├── &lt;name_2&gt;.txt
        │   └── ...
        ├── instance/ # instance segmentation masks
        │   ├── &lt;name_1&gt;.png
        │   ├── &lt;name_2&gt;.png
        │   └── ...
        ├── semantic/ # semantic segmentation masks (labels are encoded by its id)
        │   ├── &lt;name_1&gt;.png
        │   ├── &lt;name_2&gt;.png
        │   └── ...
        └── semantic_rgb/ # semantic segmentation masks (labels are encoded by its color)
            ├── &lt;name_1&gt;.png
            ├── &lt;name_2&gt;.png
            └── ...
</code></pre><p>You can import dataset for specific tasks
of KITTI dataset instead of the whole dataset,
for example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum add path -f kitti_detection &lt;path/to/dataset&gt;
</code></pre></div><p>To make sure that the selected dataset has been added to the project, you can
run <code>datum info</code>, which will display the project and dataset information.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert KITTI dataset into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.</p>
<p>Such conversion will only be successful if the output
format can represent the type of dataset you want to convert,
e.g. segmentation annotations can be
saved in <code>Cityscapes</code> format, but no as <code>COCO keypoints</code>.</p>
<p>There are few ways to convert KITTI dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f kitti -i &lt;path/to/kitti&gt;
datum <span style="color:#204a87">export</span> -f cityscapes -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if kitti -i &lt;path/to/kitti&gt; -f cityscapes -o &lt;path/to/output/dir&gt;
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-kitti">Export to KITTI</h2>
<p>There are few ways to convert dataset to KITTI format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into KITTI format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f kitti -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to KITTI format from other format</span>
datum convert -if cityscapes -i &lt;path/to/cityscapes/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f kitti -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for export to KITTI format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(by default <code>False</code>);</li>
<li><code>--image-ext IMAGE_EXT</code> allow to specify image extension
for exporting dataset (by default - keep original or use <code>.png</code>, if none).</li>
<li><code>--apply-colormap APPLY_COLORMAP</code> allow to use colormap for class masks
(in folder <code>semantic_rgb</code>, by default <code>True</code>);</li>
<li><code>--label_map</code> allow to define a custom colormap. Example</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># mycolormap.txt :</span>
<span style="color:#8f5902;font-style:italic"># 0 0 255 sky</span>
<span style="color:#8f5902;font-style:italic"># 255 0 0 person</span>
<span style="color:#8f5902;font-style:italic">#...</span>
datum <span style="color:#204a87">export</span> -f kitti -- --label-map mycolormap.txt

<span style="color:#8f5902;font-style:italic"># or you can use original kitti colomap:</span>
datum <span style="color:#204a87">export</span> -f kitti -- --label-map kitti
</code></pre></div><ul>
<li><code>--tasks TASKS</code> allow to specify tasks for export dataset,
by default Datumaro uses all tasks. Example:</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f kitti -i &lt;dataset&gt;
datum <span style="color:#204a87">export</span> -p project -f kitti -- --tasks detection
</code></pre></div><ul>
<li><code>--allow-attributes ALLOW_ATTRIBUTES</code> allow export of attributes
(by default <code>True</code>).</li>
</ul>
<h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the KITTI format in particular. Follow
<a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with KITTI dataset:</p>
<h3 id="example-1-how-to-load-an-original-kitti-dataset-and-convert-to-cityscapes">Example 1. How to load an original KITTI dataset and convert to Cityscapes</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f kitti ./KITTI/
datum stats -p project
datum <span style="color:#204a87">export</span> -p final_project -o dataset -f cityscapes -- --save-images
</code></pre></div><h3 id="example-2-how-to-create-custom-kitti-like-dataset">Example 2. How to create custom KITTI-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datumaro.plugins.kitti_format</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">KITTI</span>

<span style="color:#000">label_map</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{}</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;background&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;label_1&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;label_2&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">categories</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">KITTI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">make_kitti_categories</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label_map</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
                <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;is_crowd&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">}),</span>
                    <span style="color:#000">Mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]]),</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;is_crowd&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">}),</span>
                <span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">categories</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;kitti&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_kitti_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a2db7ecd3bd406d8822366b9b33229dd">5.9 - MNIST</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>MNIST format specification is available <a href="http://yann.lecun.com/exdb/mnist/">here</a>.
Fashion MNIST format specification is available <a href="https://github.com/zalandoresearch/fashion-mnist">here</a>.
MNIST in CSV  format specification is available <a href="https://pjreddie.com/projects/mnist-in-csv/">here</a>.</p>
<p>The dataset has few data formats available. Datumaro supports the
binary (Python pickle) format and the CSV variant. Each data format is covered
by a separate Datumaro format.</p>
<p>Supported formats:</p>
<ul>
<li>Binary (Python pickle) - <code>mnist</code></li>
<li>CSV - <code>mnist_csv</code></li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>Label</code></li>
</ul>
<p>The format only supports single channel 28 x 28 images.</p>
<h2 id="load-mnist-dataset">Load MNIST dataset</h2>
<p>The MNIST dataset is available for free download:</p>
<ul>
<li><a href="https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz">train-images-idx3-ubyte.gz</a>:
training set images</li>
<li><a href="https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz">train-labels-idx1-ubyte.gz</a>:
training set labels</li>
<li><a href="https://ossci-datasets.s3.amazonaws.com/mnist/t10k-images-idx3-ubyte.gz">t10k-images-idx3-ubyte.gz</a>:
test set images</li>
<li><a href="https://ossci-datasets.s3.amazonaws.com/mnist/t10k-labels-idx1-ubyte.gz">t10k-labels-idx1-ubyte.gz</a>:
test set labels</li>
</ul>
<p>The Fashion MNIST dataset is available for free download:</p>
<ul>
<li><a href="http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-images-idx3-ubyte.gz">train-images-idx3-ubyte.gz</a>:
training set images</li>
<li><a href="http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/train-labels-idx1-ubyte.gz">train-labels-idx1-ubyte.gz</a>:
training set labels</li>
<li><a href="http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-images-idx3-ubyte.gz">t10k-images-idx3-ubyte.gz</a>:
test set images</li>
<li><a href="http://fashion-mnist.s3-website.eu-central-1.amazonaws.com/t10k-labels-idx1-ubyte.gz">t10k-labels-idx1-ubyte.gz</a>:
test set labels</li>
</ul>
<p>The MNIST in CSV dataset is available for free download:</p>
<ul>
<li><a href="https://pjreddie.com/media/files/mnist_train.csv">mnist_train.csv</a></li>
<li><a href="https://pjreddie.com/media/files/mnist_test.csv">mnist_test.csv</a></li>
</ul>
<p>There are two ways to create Datumaro project and add MNIST dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format mnist --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f mnist &lt;path/to/dataset&gt;
</code></pre></div><p>There are two ways to create Datumaro project and add MNIST in CSV dataset
to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format mnist_csv --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f mnist_csv &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory run
<code>datum create --help</code> for more information.</p>
<p>MNIST dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── labels.txt # list of non-digit labels (optional)
    ├── t10k-images-idx3-ubyte.gz
    ├── t10k-labels-idx1-ubyte.gz
    ├── train-images-idx3-ubyte.gz
    └── train-labels-idx1-ubyte.gz
</code></pre><p>MNIST in CSV dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── labels.txt # list of non-digit labels (optional)
    ├── mnist_test.csv
    └── mnist_train.csv
</code></pre><p>If the dataset needs non-digit labels, you need to add the <code>labels.txt</code>
to the dataset folder. For example, <code>labels.txt</code> for Fashion MNIST the
following contents:</p>
<!--lint disable fenced-code-flag-->
<pre><code>T-shirt/top
Trouser
Pullover
Dress
Coat
Sandal
Shirt
Sneaker
Bag
Ankle boot
</code></pre><h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert MNIST dataset into any other format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
To get the expected result, convert the dataset to formats
that support the classification task (e.g. CIFAR-10/100, ImageNet, PascalVOC,
etc.) There are few ways to convert MNIST dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f mnist -i &lt;path/to/mnist&gt;
datum <span style="color:#204a87">export</span> -f imagenet -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if mnist -i &lt;path/to/mnist&gt; -f imagenet -o &lt;path/to/output/dir&gt;
</code></pre></div><p>These commands also work for MNIST in CSV if you use <code>mnist_csv</code> instead of <code>mnist</code>.</p>
<h2 id="export-to-mnist">Export to MNIST</h2>
<p>There are few ways to convert dataset to MNIST format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into MNIST format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f mnist -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to MNIST format from other format</span>
datum convert -if imagenet -i &lt;path/to/imagenet/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f mnist -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for export to MNIST format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(by default <code>False</code>);</li>
<li><code>--image-ext &lt;IMAGE_EXT&gt;</code> allow to specify image extension
for exporting dataset (by default <code>.png</code>).</li>
</ul>
<p>These commands also work for MNIST in CSV if you use <code>mnist_csv</code> instead of <code>mnist</code>.</p>
<h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the MNIST format in particular. Follow <a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with MNIST dataset:</p>
<h3 id="example-1-how-to-create-custom-mnist-like-dataset">Example 1. How to create custom MNIST-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)]</span>
    <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">)]</span>
    <span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">label</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;mnist&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="example-2-how-to-filter-and-convert-mnist-dataset-to-imagenet">Example 2. How to filter and convert MNIST dataset to ImageNet</h3>
<p>Convert MNIST dataset to ImageNet format, keep only images with <code>3</code> class
presented:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Download MNIST dataset:</span>
<span style="color:#8f5902;font-style:italic"># https://ossci-datasets.s3.amazonaws.com/mnist/train-images-idx3-ubyte.gz</span>
<span style="color:#8f5902;font-style:italic"># https://ossci-datasets.s3.amazonaws.com/mnist/train-labels-idx1-ubyte.gz</span>
datum convert --input-format mnist --input-path &lt;path/to/mnist&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format imagenet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --filter <span style="color:#4e9a06">&#39;/item[annotation/label=&#34;3&#34;]&#39;</span>
</code></pre></div><p>Examples of using this format from the code can be found in
the <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_mnist_format.py">binary format tests</a> and <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_mnist_csv_format.py">csv format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f97053c70a29d6713d3412af07bcdcca">5.10 - Open Images</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>A description of the Open Images Dataset (OID) format is available
on <a href="https://storage.googleapis.com/openimages/web/download.html">its website</a>.
Datumaro supports versions 4, 5 and 6.</p>
<p>Supported annotation types:</p>
<ul>
<li><code>Label</code> (human-verified image-level labels)</li>
<li><code>Bbox</code> (bounding boxes)</li>
<li><code>Mask</code> (segmentation masks)</li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li>
<p>Labels</p>
<ul>
<li><code>score</code> (read/write, float).
The confidence level from 0 to 1.
A score of 0 indicates that
the image does not contain objects of the corresponding class.</li>
</ul>
</li>
<li>
<p>Bounding boxes</p>
<ul>
<li><code>score</code> (read/write, float).
The confidence level from 0 to 1.
In the original dataset this is always equal to 1,
but custom datasets may be created with arbitrary values.</li>
<li><code>occluded</code> (read/write, boolean).
Whether the object is occluded by another object.</li>
<li><code>truncated</code> (read/write, boolean).
Whether the object extends beyond the boundary of the image.</li>
<li><code>is_group_of</code> (read/write, boolean).
Whether the object represents a group of objects of the same class.</li>
<li><code>is_depiction</code> (read/write, boolean).
Whether the object is a depiction (such as a drawing)
rather than a real object.</li>
<li><code>is_inside</code> (read/write, boolean).
Whether the object is seen from the inside.</li>
</ul>
</li>
<li>
<p>Masks</p>
<ul>
<li><code>box_id</code> (read/write, string).
An identifier for the bounding box associated with the mask.</li>
<li><code>predicted_iou</code> (read/write, float).
Predicted IoU value with respect to the ground truth.</li>
</ul>
</li>
</ul>
<h2 id="load-open-images-dataset">Load Open Images dataset</h2>
<p>The Open Images dataset is available for free download.</p>
<p>See the <a href="https://github.com/cvdfoundation/open-images-dataset"><code>open-images-dataset</code> GitHub repository</a>
for information on how to download the images.</p>
<p>Datumaro also requires the image description files,
which can be downloaded from the following URLs:</p>
<ul>
<li><a href="https://storage.googleapis.com/openimages/2018_04/image_ids_and_rotation.csv">complete set</a></li>
<li><a href="https://storage.googleapis.com/openimages/v6/oidv6-train-images-with-labels-with-rotation.csv">train set</a></li>
<li><a href="https://storage.googleapis.com/openimages/2018_04/validation/validation-images-with-rotation.csv">validation set</a></li>
<li><a href="https://storage.googleapis.com/openimages/2018_04/test/test-images-with-rotation.csv">test set</a></li>
</ul>
<p>Datumaro expects at least one of the files above to be present.</p>
<p>In addition, the following metadata file must be present as well:</p>
<ul>
<li><a href="https://storage.googleapis.com/openimages/v6/oidv6-class-descriptions.csv">class descriptions</a></li>
</ul>
<p>You can optionally download the following additional metadata file:</p>
<ul>
<li><a href="https://storage.googleapis.com/openimages/2018_04/bbox_labels_600_hierarchy.json">class hierarchy</a></li>
</ul>
<p>Annotations can be downloaded from the following URLs:</p>
<ul>
<li><a href="https://storage.googleapis.com/openimages/v6/oidv6-train-annotations-human-imagelabels.csv">train image labels</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/validation-annotations-human-imagelabels.csv">validation image labels</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/test-annotations-human-imagelabels.csv">test image labels</a></li>
<li><a href="https://storage.googleapis.com/openimages/v6/oidv6-train-annotations-bbox.csv">train bounding boxes</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/validation-annotations-bbox.csv">validation bounding boxes</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/test-annotations-bbox.csv">test bounding boxes</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/train-annotations-object-segmentation.csv">train segmentation masks (metadata)</a></li>
<li>train segmentation masks (images):
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-0.zip">0</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-1.zip">1</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-2.zip">2</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-3.zip">3</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-4.zip">4</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-5.zip">5</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-6.zip">6</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-7.zip">7</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-8.zip">8</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-9.zip">9</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-a.zip">a</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-b.zip">b</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-c.zip">c</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-d.zip">d</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-e.zip">e</a>
<a href="https://storage.googleapis.com/openimages/v5/train-masks/train-masks-f.zip">f</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/validation-annotations-object-segmentation.csv">validation segmentation masks (metadata)</a></li>
<li>validation segmentation masks (images):
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-0.zip">0</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-1.zip">1</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-2.zip">2</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-3.zip">3</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-4.zip">4</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-5.zip">5</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-6.zip">6</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-7.zip">7</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-8.zip">8</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-9.zip">9</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-a.zip">a</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-b.zip">b</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-c.zip">c</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-d.zip">d</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-e.zip">e</a>
<a href="https://storage.googleapis.com/openimages/v5/validation-masks/validation-masks-f.zip">f</a></li>
<li><a href="https://storage.googleapis.com/openimages/v5/test-annotations-object-segmentation.csv">test segmentation masks (metadata)</a></li>
<li>test segmentation masks (images):
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-0.zip">0</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-1.zip">1</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-2.zip">2</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-3.zip">3</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-4.zip">4</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-5.zip">5</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-6.zip">6</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-7.zip">7</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-8.zip">8</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-9.zip">9</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-a.zip">a</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-b.zip">b</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-c.zip">c</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-d.zip">d</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-e.zip">e</a>
<a href="https://storage.googleapis.com/openimages/v5/test-masks/test-masks-f.zip">f</a></li>
</ul>
<p>All annotation files are optional,
except that if the mask metadata files for a given subset are downloaded,
all corresponding images must be downloaded as well, and vice versa.</p>
<p>There are two ways to create Datumaro project and add OID to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format open_images --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f open_images &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory; run
<code>datum create --help</code> for more information.</p>
<p>Open Images dataset directory should have the following structure:</p>
<pre><code>└─ Dataset/
    ├── annotations/
    │   └── bbox_labels_600_hierarchy.json
    │   └── image_ids_and_rotation.csv
    │   └── oidv6-class-descriptions.csv
    │   └── *-annotations-bbox.csv
    │   └── *-annotations-human-imagelabels.csv
    │   └── *-annotations-object-segmentation.csv
    ├── images/
    |   ├── test/
    |   │   ├── &lt;image_name1.jpg&gt;
    |   │   ├── &lt;image_name2.jpg&gt;
    |   │   └── ...
    |   ├── train/
    |   │   ├── &lt;image_name1.jpg&gt;
    |   │   ├── &lt;image_name2.jpg&gt;
    |   │   └── ...
    |   └── validation/
    |       ├── &lt;image_name1.jpg&gt;
    |       ├── &lt;image_name2.jpg&gt;
    |       └── ...
    └── masks/
        ├── test/
        │   ├── &lt;mask_name1.png&gt;
        │   ├── &lt;mask_name2.png&gt;
        │   └── ...
        ├── train/
        │   ├── &lt;mask_name1.png&gt;
        │   ├── &lt;mask_name2.png&gt;
        │   └── ...
        └── validation/
            ├── &lt;mask_name1.png&gt;
            ├── &lt;mask_name2.png&gt;
            └── ...
</code></pre><p>The mask images must be extracted from the ZIP archives linked above.</p>
<p>To use per-subset image description files instead of <code>image_ids_and_rotation.csv</code>,
place them in the <code>annotations</code> subdirectory.</p>
<h3 id="creating-an-image-metadata-file">Creating an image metadata file</h3>
<p>To load bounding box and segmentation mask annotations,
Datumaro needs to know the sizes of the corresponding images.
By default, it will determine these sizes by loading each image from disk,
which requires the images to be present and makes the loading process slow.</p>
<p>If you want to load the aforementioned annotations on a machine where
the images are not available,
or just to speed up the dataset loading process,
you can extract the image size information in advance
and record it in an image metadata file.
This file must be placed at <code>annotations/images.meta</code>,
and must contain one line per image, with the following structure:</p>
<pre><code>&lt;ID&gt; &lt;height&gt; &lt;width&gt;
</code></pre><p>Where <code>&lt;ID&gt;</code> is the file name of the image without the extension,
and <code>&lt;height&gt;</code> and <code>&lt;width&gt;</code> are the dimensions of that image.
<code>&lt;ID&gt;</code> may be quoted with either single or double quotes.</p>
<p>The image metadata file, if present, will be used to determine the image
sizes without loading the images themselves.</p>
<p>Here&rsquo;s one way to create the <code>images.meta</code> file using ImageMagick,
assuming that the images are present on the current machine:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># run this from the dataset directory</span>
find images -name <span style="color:#4e9a06">&#39;*.jpg&#39;</span> -exec <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    identify -format <span style="color:#4e9a06">&#39;&#34;%[basename]&#34; %[height] %[width]\n&#39;</span> <span style="color:#ce5c00;font-weight:bold">{}</span> + <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &gt; annotations/images.meta
</code></pre></div><h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert OID into any other format <a href="../../docs/user-manual/supported-formats">Datumaro supports</a>.
To get the expected result, convert the dataset to a format
that supports image-level labels.
There are a few ways to convert OID to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project import -f open_images -i &lt;path/to/open_images&gt;
datum <span style="color:#204a87">export</span> -f cvat -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if open_images -i &lt;path/to/open_images&gt; -f cvat -o &lt;path/to/output/dir&gt;
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-open-images">Export to Open Images</h2>
<p>There are few ways to convert an existing dataset to the Open Images format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into Open Images format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f open_images -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -- --save_images

<span style="color:#8f5902;font-style:italic"># convert a dataset in another format to the Open Images format</span>
datum convert -if imagenet -i &lt;path/to/imagenet/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f open_images -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
</code></pre></div><p>Extra options for export to the Open Images format:</p>
<ul>
<li>
<p><code>--save-images</code> - save image files when exporting the dataset
(by default, <code>False</code>)</p>
</li>
<li>
<p><code>--image-ext IMAGE_EXT</code> - save image files with the specified extension
when exporting the dataset (by default, uses the original extension
or <code>.jpg</code> if there isn&rsquo;t one)</p>
</li>
</ul>
<h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the Open Images format in particular. Follow
<a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>Here are a few examples of using Datumaro operations to solve
particular problems with the Open Images dataset:</p>
<h3 id="example-1-load-the-open-images-dataset-and-convert-to-the-cvat-format">Example 1. Load the Open Images dataset and convert to the CVAT format</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f open_images ./open-images-dataset/
datum stats -p project
datum <span style="color:#204a87">export</span> -p project -o dataset -f cvat --overwrite -- --save-images
</code></pre></div><h3 id="example-2-create-a-custom-oid-like-dataset">Example 2. Create a custom OID-like dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">AnnotationType</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">LabelCategories</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000;font-weight:bold">[</span>
        <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span>
            <span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;0000000000000001&#39;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
            <span style="color:#000">subset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;validation&#39;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
                <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">}),</span>
                <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">}),</span>
            <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">],</span>
    <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;/m/0&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;/m/1&#39;</span><span style="color:#000;font-weight:bold">],</span>
<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;open_images&#39;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_open_images_format.py">the format tests</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-db1d30fa5536c19aa2aa75b33dbf92ea">5.11 - Pascal VOC</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>Pascal VOC format specification is available
<a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/devkit_doc.pdf">here</a>.</p>
<p>The dataset has annotations for multiple tasks. Each task has its own format
in Datumaro, and there is also a combined <code>voc</code> format, which includes all
the available tasks. The sub-formats have the same options as the &ldquo;main&rdquo;
format and only limit the set of annotation files they work with. To work with
multiple formats, use the corresponding option of the <code>voc</code> format.</p>
<p>Supported tasks / formats:</p>
<ul>
<li>The combined format - <code>voc</code></li>
<li>Image classification - <code>voc_classification</code></li>
<li>Object detection - <code>voc_detection</code></li>
<li>Action classification - <code>voc_action</code></li>
<li>Class and instance segmentation - <code>voc_segmentation</code></li>
<li>Person layout detection - <code>voc_layout</code></li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>Label</code> (classification)</li>
<li><code>Bbox</code> (detection, action detection and person layout)</li>
<li><code>Mask</code> (segmentation)</li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>occluded</code> (boolean) - indicates that a significant portion of the
object within the bounding box is occluded by another object</li>
<li><code>truncated</code> (boolean) - indicates that the bounding box specified for
the object does not correspond to the full extent of the object</li>
<li><code>difficult</code> (boolean) - indicates that the object is considered difficult
to recognize</li>
<li>action attributes (boolean) - <code>jumping</code>, <code>reading</code> and
<a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/actionexamples/index.html">others</a>.
Indicate that the object does the corresponding action.</li>
<li>arbitrary attributes (string/number) - A Datumaro extension. Stored
in the <code>attributes</code> section of the annotation <code>xml</code> file. Available for
bbox annotations only.</li>
</ul>
<h2 id="load-pascal-voc-dataset">Load Pascal VOC dataset</h2>
<p>The Pascal VOC dataset is available for free download
<a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/index.html#devkit">here</a></p>
<p>There are two ways to create Datumaro project and add Pascal VOC dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format voc --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f voc &lt;path/to/dataset&gt;
</code></pre></div><p>It is possible to specify project name and project directory run
<code>datum create --help</code> for more information.
Pascal VOC dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
   ├── label_map.txt # a list of non-Pascal labels (optional)
   │
   ├── Annotations/
   │     ├── ann1.xml # Pascal VOC format annotation file
   │     ├── ann2.xml
   │     └── ...
   ├── JPEGImages/
   │    ├── img1.jpg
   │    ├── img2.jpg
   │    └── ...
   ├── SegmentationClass/ # directory with semantic segmentation masks
   │    ├── img1.png
   │    ├── img2.png
   │    └── ...
   ├── SegmentationObject/ # directory with instance segmentation masks
   │    ├── img1.png
   │    ├── img2.png
   │    └── ...
   │
   └── ImageSets/
        ├── Main/ # directory with list of images for detection and classification task
        │   ├── test.txt  # list of image names in test subset  (without extension)
        |   ├── train.txt # list of image names in train subset (without extension)
        |   └── ...
        ├── Layout/ # directory with list of images for person layout task
        │   ├── test.txt
        |   ├── train.txt
        |   └── ...
        ├── Action/ # directory with list of images for action classification task
        │   ├── test.txt
        |   ├── train.txt
        |   └── ...
        └── Segmentation/ # directory with list of images for segmentation task
            ├── test.txt
            ├── train.txt
            └── ...
</code></pre><p>The <code>ImageSets</code> directory should contain at least one of the directories:
<code>Main</code>, <code>Layout</code>, <code>Action</code>, <code>Segmentation</code>.
These directories contain <code>.txt</code> files with a list of images in a subset,
the subset name is the same as the <code>.txt</code> file name. Subset names can be
arbitrary.</p>
<p>In <code>label_map.txt</code> you can define custom color map and non-pascal labels,
for example:</p>
<pre><code># label_map [label : color_rgb : parts : actions]
helicopter:::
elephant:0:124:134:head,ear,foot:
</code></pre><p>It is also possible to import grayscale (1-channel) PNG masks.
For grayscale masks provide a list of labels with the number of lines
equal to the maximum color index on images. The lines must be in the
right order so that line index is equal to the color index. Lines can
have arbitrary, but different, colors. If there are gaps in the used
color indices in the annotations, they must be filled with arbitrary
dummy labels. Example:</p>
<pre><code>car:0,128,0:: # color index 0
aeroplane:10,10,128:: # color index 1
_dummy2:2,2,2:: # filler for color index 2
_dummy3:3,3,3:: # filler for color index 3
boat:108,0,100:: # color index 3
...
_dummy198:198,198,198:: # filler for color index 198
_dummy199:199,199,199:: # filler for color index 199
the_last_label:12,28,0:: # color index 200
</code></pre><p>You can import dataset for specific tasks
of Pascal VOC dataset instead of the whole dataset,
for example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum add path -f voc_detection &lt;path/to/dataset/ImageSets/Main/train.txt&gt;
</code></pre></div><p>To make sure that the selected dataset has been added to the project, you
can run <code>datum info</code>, which will display the project and dataset information.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert Pascal VOC dataset into any other format
<a href="../../docs/user-manual/supported-formats">Datumaro supports</a>.</p>
<p>Such conversion will only be successful if the output
format can represent the type of dataset you want to convert,
e.g. image classification annotations can be
saved in <code>ImageNet</code> format, but no as <code>COCO keypoints</code>.</p>
<p>There are few ways to convert Pascal VOC dataset to other dataset format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -f voc -i &lt;path/to/voc&gt;
datum <span style="color:#204a87">export</span> -f coco -o &lt;path/to/output/dir&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if voc -i &lt;path/to/voc&gt; -f coco -o &lt;path/to/output/dir&gt;

</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-pascal-voc">Export to Pascal VOC</h2>
<p>There are few ways to convert an existing dataset to Pascal VOC format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into Pascal VOC format (classification) from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f voc -o &lt;path/to/export/dir&gt; -- --tasks classification

<span style="color:#8f5902;font-style:italic"># converting to Pascal VOC format from other format</span>
datum convert -if imagenet -i &lt;path/to/imagenet/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f voc -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --label_map voc --save-images
</code></pre></div><p>Extra options for export to Pascal VOC format:</p>
<ul>
<li>
<p><code>--save-images</code> - allow to export dataset with saving images
(by default <code>False</code>)</p>
</li>
<li>
<p><code>--image-ext IMAGE_EXT</code> - allow to specify image extension
for exporting dataset (by default use original or <code>.jpg</code> if none)</p>
</li>
<li>
<p><code>--apply-colormap APPLY_COLORMAP</code> - allow to use colormap for class
and instance masks (by default <code>True</code>)</p>
</li>
<li>
<p><code>--allow-attributes ALLOW_ATTRIBUTES</code> - allow export of attributes
(by default <code>True</code>)</p>
</li>
<li>
<p><code>--keep-empty KEEP_EMPTY</code> - write subset lists even if they are empty
(by default: <code>False</code>)</p>
</li>
<li>
<p><code>--tasks TASKS</code> - allow to specify tasks for export dataset,
by default Datumaro uses all tasks. Example:</p>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f voc -i ./VOC2012
datum <span style="color:#204a87">export</span> -p project -f voc -- --tasks detection,classification
</code></pre></div><ul>
<li><code>--label_map</code> allow to define a custom colormap. Example</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># mycolormap.txt [label : color_rgb : parts : actions]:</span>
<span style="color:#8f5902;font-style:italic"># cat:0,0,255::</span>
<span style="color:#8f5902;font-style:italic"># person:255,0,0:head:</span>
datum <span style="color:#204a87">export</span> -f voc_segmentation -- --label-map mycolormap.txt

<span style="color:#8f5902;font-style:italic"># or you can use original voc colomap:</span>
datum <span style="color:#204a87">export</span> -f voc_segmentation -- --label-map voc
</code></pre></div><h2 id="examples">Examples</h2>
<p>Datumaro supports filtering, transformation, merging etc. for all formats
and for the Pascal VOC format in particular. Follow
<a href="../../docs/user-manual/">user manual</a>
to get more information about these operations.</p>
<p>There are few examples of using Datumaro operations to solve
particular problems with Pascal VOC dataset:</p>
<h3 id="example-1-how-to-prepare-an-original-dataset-for-training">Example 1. How to prepare an original dataset for training.</h3>
<p>In this example, preparing the original dataset to train the semantic
segmentation model includes:
loading,
checking duplicate images,
setting the number of images,
splitting into subsets,
export the result to Pascal VOC format.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f voc_segmentation ./VOC2012/ImageSets/Segmentation/trainval.txt
datum stats -p project <span style="color:#8f5902;font-style:italic"># check statisctics.json -&gt; repeated images</span>
datum transform -p project -o ndr_project -t ndr -- -w trainval -k <span style="color:#0000cf;font-weight:bold">2500</span>
datum filter -p ndr_project -o trainval2500 -e <span style="color:#4e9a06">&#39;/item[subset=&#34;trainval&#34;]&#39;</span>
datum transform -p trainval2500 -o final_project -t random_split -- -s train:.8 -s val:.2
datum <span style="color:#204a87">export</span> -p final_project -o dataset -f voc -- --label-map voc --save-images
</code></pre></div><h3 id="example-2-how-to-create-custom-dataset">Example 2. How to create custom dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.util.image</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Image</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Image</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image1.jpg&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">size</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">)),</span>
       <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">),</span>
           <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;difficult&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;running&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">}),</span>
           <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">}),</span>
           <span style="color:#000">Polygon</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">9</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">9</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span>
        <span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;sky&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;water&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;lion&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;polygons_to_masks&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./mydataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label_map</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;my_labelmap.txt&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">my_labelmap.txt:
</span><span style="color:#4e9a06"># label:color_rgb:parts:actions
</span><span style="color:#4e9a06">person:0,0,255:hand,foot:jumping,running
</span><span style="color:#4e9a06">sky:128,0,0::
</span><span style="color:#4e9a06">water:0,128,0::
</span><span style="color:#4e9a06">lion:255,128,0::
</span><span style="color:#4e9a06">&#34;&#34;&#34;</span>
</code></pre></div><h3 id="example-3-load-filter-and-convert-from-code">Example 3. Load, filter and convert from code</h3>
<p>Load Pascal VOC dataset, and export train subset with items
which has <code>jumping</code> attribute:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./VOC2012&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">train_dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_subset</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;train&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">as_dataset</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">only_jumping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">ann</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">ann</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;jumping&#39;</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">True</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">False</span>

<span style="color:#000">train_dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">only_jumping</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">train_dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./jumping_label_me&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;label_me&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="example-4-get-information-about-items-in-pascal-voc-2012-dataset-for-segmentation-task">Example 4. Get information about items in Pascal VOC 2012 dataset for segmentation task:</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">AnnotationType</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./VOC2012&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;voc&#39;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">has_mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">ann</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">ann</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">type</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">mask</span><span style="color:#000;font-weight:bold">:</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">True</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#3465a4">False</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">has_mask</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pascal VOC 2012 has </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06"> images for segmentation task:&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">subset_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subset</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subsets</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">items</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">subset</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subset_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">end</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;;&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>After executing this code, we can see that there are 5826 images
in Pascal VOC 2012 has for segmentation task and this result is the same as the
<a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/dbstats.html">official documentation</a></p>
<p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_voc_format.py">tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0c9b196a180c68b9b42be11ddc52c8bb">5.12 - Supervisely Point Cloud</h1>
    
	<h2 id="format-specification">Format specification</h2>
<p>Point Cloud data format:</p>
<ul>
<li><a href="https://docs.supervise.ly/data-organization/00_ann_format_navi">specification</a>.</li>
<li><a href="https://drive.google.com/file/d/1BtZyffWtWNR-mk_PHNPMnGgSlAkkQpBl/view">example</a>.</li>
</ul>
<p>Supported annotation types:</p>
<ul>
<li><code>cuboid_3d</code></li>
</ul>
<p>Supported annotation attributes:</p>
<ul>
<li><code>track_id</code> (read/write, integer), responsible for <code>object</code> field</li>
<li><code>createdAt</code> (write, string),</li>
<li><code>updatedAt</code> (write, string),</li>
<li><code>labelerLogin</code> (write, string), responsible for the corresponding fields
in the annotation file.</li>
<li>arbitrary attributes</li>
</ul>
<p>Supported image attributes:</p>
<ul>
<li><code>description</code> (read/write, string),</li>
<li><code>createdAt</code> (write, string),</li>
<li><code>updatedAt</code> (write, string),</li>
<li><code>labelerLogin</code> (write, string), responsible for the corresponding fields
in the annotation file.</li>
<li><code>frame</code> (read/write, integer). Indicates frame number of the image.</li>
<li>arbitrary attributes</li>
</ul>
<h2 id="import-supervisely-point-cloud-dataset">Import Supervisely Point Cloud dataset</h2>
<p>An example dataset in Supervisely Point Cloud format is available for download:</p>
<p><a href="https://drive.google.com/u/0/uc?id=1BtZyffWtWNR-mk_PHNPMnGgSlAkkQpBl&amp;export=download">https://drive.google.com/u/0/uc?id=1BtZyffWtWNR-mk_PHNPMnGgSlAkkQpBl&amp;export=download</a></p>
<p>Point Cloud dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ Dataset/
    ├── ds0/
    │   ├── ann/
    │   │   ├── &lt;pcdname1.pcd.json&gt;
    │   │   ├── &lt;pcdname2.pcd.json&gt;
    │   │   └── ...
    │   ├── pointcloud/
    │   │   ├── &lt;pcdname1.pcd&gt;
    │   │   ├── &lt;pcdname1.pcd&gt;
    │   │   └── ...
    │   ├── related_images/
    │   │   ├── &lt;pcdname1_pcd&gt;/
    │   │   |  ├── &lt;image_name.ext.json&gt;
    │   │   |  ├── &lt;image_name.ext.json&gt;
    │   │   └── ...
    ├── key_id_map.json
    └── meta.json
</code></pre><p>There are two ways to import Supervisely Point Cloud dataset:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --format sly_pointcloud --input-path &lt;path/to/dataset&gt;
<span style="color:#8f5902;font-style:italic"># or</span>
datum create
datum add path -f sly_pointcloud &lt;path/to/dataset&gt;
</code></pre></div><p>To make sure that the selected dataset has been added to the project,
you can run <code>datum info</code>, which will display the project and dataset
information.</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert Supervisely Point Cloud dataset into any other
format <a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.</p>
<p>Such conversion will only be successful if the output
format can represent the type of dataset you want to convert,
e.g. 3D point clouds can be saved in KITTI Raw format,
but not in COCO keypoints.</p>
<p>There are few ways to convert Supervisely Point Cloud dataset
to other dataset formats:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -f sly_pointcloud -i &lt;path/to/sly_pcd/&gt; -o proj/
datum <span style="color:#204a87">export</span> -f kitti_raw -o &lt;path/to/output/dir&gt; -p proj/
<span style="color:#8f5902;font-style:italic"># or</span>
datum convert -if sly_pointcloud -i &lt;path/to/sly_pcd/&gt; -f kitti_raw
</code></pre></div><p>Some formats provide extra options for conversion.
These options are passed after double dash (<code>--</code>) in the command line.
To get information about them, run</p>
<p><code>datum export -f &lt;FORMAT&gt; -- -h</code></p>
<h2 id="export-to-supervisely-point-cloud">Export to Supervisely Point Cloud</h2>
<p>There are few ways to convert dataset to Supervisely Point Cloud format:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># export dataset into Supervisely Point Cloud format from existing project</span>
datum <span style="color:#204a87">export</span> -p &lt;path/to/project&gt; -f sly_pointcloud -o &lt;path/to/export/dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images
<span style="color:#8f5902;font-style:italic"># converting to Supervisely Point Cloud format from other format</span>
datum convert -if kitti_raw -i &lt;path/to/kitti_raw/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f sly_pointcloud -o &lt;path/to/export/dir&gt; -- --save-images
</code></pre></div><p>Extra options for exporting in Supervisely Point Cloud format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images. This will
include point clouds and related images (by default <code>False</code>)</li>
<li><code>--image-ext IMAGE_EXT</code> allow to specify image extension
for exporting dataset (by default - keep original or use <code>.png</code>, if none)</li>
<li><code>--reindex</code> assigns new indices to frames and annotations.</li>
<li><code>--allow-undeclared-attrs</code> allows writing arbitrary annotation attributes.
By default, only attributes specified in the input dataset metainfo
will be written.</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="example-1-import-dataset-compute-statistics">Example 1. Import dataset, compute statistics</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o project
datum add path -p project -f sly_pointcloud ../sly_dataset/
datum stats -p project
</code></pre></div><h3 id="example-2-convert-supervisely-point-clouds-to-kitti-raw">Example 2. Convert Supervisely Point Clouds to KITTI Raw</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert -if sly_pointcloud -i ../sly_pcd/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f kitti_raw -o my_kitti/ -- --save-images --reindex --allow-attrs
</code></pre></div><h3 id="example-3-create-a-custom-dataset">Example 3. Create a custom dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;frame_1&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">206</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">320.86</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">979.18</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.04</span><span style="color:#000;font-weight:bold">],</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;track_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;x&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">}),</span>

            <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">207</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">318.19</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">974.65</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.29</span><span style="color:#000;font-weight:bold">],</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;track_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">}),</span>
        <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000">pcd</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;path/to/pcd1.pcd&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;frame&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;description&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;zzz&#39;</span><span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">),</span>

    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;frm2&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Cuboid3d</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">208</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">23.04</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8.75</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">0.78</span><span style="color:#000;font-weight:bold">],</span>
                <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;occluded&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#3465a4">False</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;track_id&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">})</span>
        <span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000">pcd</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;path/to/pcd2.pcd&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">related_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;image2.png&#39;</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;frame&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;cat&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;dog&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;my_dataset/&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;sly_pointcloud&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">allow_undeclared_attrs</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Examples of using this format from the code can be found in
<a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/test_sly_pointcloud_format.py">the format tests</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f638f1a110145e49bc81ee72961dd7ef">5.13 - YOLO</h1>
    
	<h2 id="format-specification">Format specification</h2>
<ul>
<li>
<p>The YOLO dataset format is for training and validating object detection
models. Specification for this format available
<a href="https://github.com/AlexeyAB/darknet#how-to-train-to-detect-your-custom-objects">here</a>.
And also you can find some official examples on working with YOLO dataset
<a href="https://pjreddie.com/darknet/yolo/">here</a>;</p>
</li>
<li>
<p>The YOLO dataset format support the following types of annotations:</p>
<ul>
<li><code>Bounding boxes</code></li>
</ul>
</li>
<li>
<p>YOLO format doesn&rsquo;t support attributes for annotations;</p>
</li>
<li>
<p>The format only supports subsets named <code>train</code> or <code>valid</code>.</p>
</li>
</ul>
<h2 id="load-yolo-dataset">Load YOLO dataset</h2>
<p>Few ways to create Datumaro project and add YOLO dataset to it:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f yolo -i &lt;path/to/yolo/dataset&gt;

<span style="color:#8f5902;font-style:italic"># another way to do the same:</span>
datum create -o project
datum add path -p project -f yolo -i &lt;path/to/yolo/dataset&gt;

<span style="color:#8f5902;font-style:italic"># and you can add another one yolo dataset:</span>
datum add path -p project -f yolo -i &lt;path/to/other/yolo/dataset&gt;
</code></pre></div><p>YOLO dataset directory should have the following structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>└─ yolo_dataset/
   │
   ├── obj.names  # file with list of classes
   ├── obj.data   # file with dataset information
   ├── train.txt  # list of image paths in train subset
   ├── valid.txt  # list of image paths in valid subset
   │
   ├── obj_train_data/  # directory with annotations and images for train subset
   │    ├── image1.txt  # list of labeled bounding boxes for image1
   │    ├── image1.jpg
   │    ├── image2.txt
   │    ├── image2.jpg
   │    ├── ...
   │
   ├── obj_valid_data/  # directory with annotations and images for valid subset
   │    ├── image101.txt
   │    ├── image101.jpg
   │    ├── image102.txt
   │    ├── image102.jpg
   │    ├── ...
</code></pre><blockquote>
<p>YOLO dataset cannot contain a subset with a name other than <code>train</code> or <code>valid</code>.
If imported dataset contains such subsets, they will be ignored.
If you are exporting a project into yolo format,
all subsets different from <code>train</code> and <code>valid</code> will be skipped.
If there is no subset separation in a project, the data
will be saved in <code>train</code> subset.</p>
</blockquote>
<ul>
<li><code>obj.data</code> should have the following content, it is not necessary to have both
subsets, but necessary to have one of them:</li>
</ul>
<pre><code>classes = 5 # optional
names = &lt;path/to/obj.names&gt;
train = &lt;path/to/train.txt&gt;
valid = &lt;path/to/valid.txt&gt;
backup = backup/ # optional
</code></pre><ul>
<li><code>obj.names</code> contain list of classes.
The line number for the class is the same as its index:</li>
</ul>
<pre><code>label1  # label1 has index 0
label2  # label2 has index 1
label3  # label2 has index 2
...
</code></pre><ul>
<li>Files <code>train.txt</code> and <code>valid.txt</code> should have the following structure:</li>
</ul>
<pre><code>&lt;path/to/image1.jpg&gt;
&lt;path/to/image2.jpg&gt;
...
</code></pre><ul>
<li>Files in directories <code>obj_train_data/</code> and <code>obj_valid_data/</code>
should contain information about labeled bounding boxes
for images:</li>
</ul>
<pre><code># image1.txt:
# &lt;label_index&gt; &lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;
0 0.250000 0.400000 0.300000 0.400000
3 0.600000 0.400000 0.400000 0.266667
</code></pre><p>Here <code>x_center</code>, <code>y_center</code>, <code>width</code>, and <code>height</code> are relative to the image&rsquo;s
width and height. The <code>x_center</code> and <code>y_center</code> are center of rectangle
(are not top-left corner).</p>
<h2 id="export-to-other-formats">Export to other formats</h2>
<p>Datumaro can convert YOLO dataset into any other format
<a href="../../docs/user-manual/supported-formats/">Datumaro supports</a>.
For successful conversion the output format should support
object detection task (e.g. Pascal VOC, COCO, TF Detection API etc.)</p>
<p>Examples:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f yolo -i &lt;path/to/yolo/dataset&gt;
datum <span style="color:#204a87">export</span> -p project -f voc -o &lt;path/to/output/voc/dataset&gt;
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert -if yolo -i &lt;path/to/yolo/dataset&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              -f coco_instances -o &lt;path/to/output/coco/dataset&gt;
</code></pre></div><h2 id="export-to-yolo-format">Export to YOLO format</h2>
<p>Datumaro can convert an existing dataset to YOLO format,
if the dataset supports object detection task.</p>
<p>Example:</p>
<pre><code>datum import -p project -f coco_instances -i &lt;path/to/coco/dataset&gt;
datum export -p project -f yolo -o &lt;path/to/output/yolo/dataset&gt; -- --save-images
</code></pre><p>Extra options for export to YOLO format:</p>
<ul>
<li><code>--save-images</code> allow to export dataset with saving images
(default: <code>False</code>);</li>
<li><code>--image-ext &lt;IMAGE_EXT&gt;</code> allow to specify image extension
for exporting dataset (default: use original or <code>.jpg</code>, if none).</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="example-1-prepare-pascal-voc-dataset-for-exporting-to-yolo-format-dataset">Example 1. Prepare PASCAL VOC dataset for exporting to YOLO format dataset</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f voc -i ./VOC2012
datum filter -p project -e <span style="color:#4e9a06">&#39;/item[subset=&#34;train&#34; or subset=&#34;val&#34;]&#39;</span> -o trainval_voc
datum transform -p trainval_voc -o trainvalid_voc <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t map_subsets -- -s train:train -s val:valid
datum <span style="color:#204a87">export</span> -p trainvalid_voc -f yolo -o ./yolo_dataset -- --save-images
</code></pre></div><h3 id="example-2-remove-some-class-from-yolo-dataset">Example 2. Remove some class from YOLO dataset</h3>
<p>Delete all items, which contain <code>cat</code> objects and remove
<code>cat</code> from list of classes:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f yolo -i ./yolo_dataset
datum filter -p project -o filtered -m i+a -e <span style="color:#4e9a06">&#39;/item/annotation[label!=&#34;cat&#34;]&#39;</span>
datum transform -p filtered -o without_cat -t remap_labels -- -l cat:
datum <span style="color:#204a87">export</span> -p without_cat -f yolo -o ./yolo_without_cats
</code></pre></div><h3 id="example-3-create-custom-dataset-in-yolo-format">Example 3. Create custom dataset in YOLO format</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">numpy</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">np</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">DatasetItem</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_iterable</span><span style="color:#000;font-weight:bold">([</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image_001&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;train&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
            <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">DatasetItem</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;image_002&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">subset</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;train&#39;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ones</span><span style="color:#000;font-weight:bold">((</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)),</span>
        <span style="color:#000">annotations</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">],</span> <span style="color:#000">categories</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;house&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;bridge&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;crosswalk&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;traffic_light&#39;</span><span style="color:#000;font-weight:bold">])</span>

<span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">export</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;../yolo_dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;yolo&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save_images</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">True</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h3 id="example-4-get-information-about-objects-on-each-image">Example 4. Get information about objects on each image</h3>
<p>If you only want information about label names for each
images, then you can get it from code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.dataset</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Dataset</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">AnnotationType</span>

<span style="color:#000">dataset</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">import_from</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;./yolo_dataset&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;yolo&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">cats</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dataset</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">categories</span><span style="color:#000;font-weight:bold">()[</span><span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">item</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">dataset</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">ann</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">annotations</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">cats</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">ann</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>And If you want complete information about each items you can run:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import -o project -f yolo -i ./yolo_dataset
datum filter -p project --dry-run -e <span style="color:#4e9a06">&#39;/item&#39;</span>
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bb346cf0596c62e042775b393e7fd9b8">6 - Plugins</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-900c5314d5f38425d40d967abd17bea1">6.1 - OpenVINO™ Inference Interpreter</h1>
    <div class="lead">Interpreter samples to parse OpenVINO™ inference outputs. This section on <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/datumaro/plugins/openvino_plugin">GitHub</a></div>
	<h2 id="models-supported-from-interpreter-samples">Models supported from interpreter samples</h2>
<p>There are detection and image classification examples.</p>
<ul>
<li>
<p>Detection (SSD-based)</p>
<ul>
<li>
<p>Intel Pre-trained Models &gt; Object Detection</p>
<ul>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_face_detection_0200_description_face_detection_0200.html">face-detection-0200</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_face_detection_0202_description_face_detection_0202.html">face-detection-0202</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_face_detection_0204_description_face_detection_0204.html">face-detection-0204</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_detection_0200_description_person_detection_0200.html">person-detection-0200</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_detection_0201_description_person_detection_0201.html">person-detection-0201</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_detection_0202_description_person_detection_0202.html">person-detection-0202</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_vehicle_bike_detection_2000_description_person_vehicle_bike_detection_2000.html">person-vehicle-bike-detection-2000</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_vehicle_bike_detection_2001_description_person_vehicle_bike_detection_2001.html">person-vehicle-bike-detection-2001</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_person_vehicle_bike_detection_2002_description_person_vehicle_bike_detection_2002.html">person-vehicle-bike-detection-2002</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_vehicle_detection_0200_description_vehicle_detection_0200.html">vehicle-detection-0200</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_vehicle_detection_0201_description_vehicle_detection_0201.html">vehicle-detection-0201</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_vehicle_detection_0202_description_vehicle_detection_0202.html">vehicle-detection-0202</a></li>
</ul>
</li>
<li>
<p>Public Pre-Trained Models(OMZ) &gt; Object Detection</p>
<ul>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_public_ssd_mobilenet_v1_coco_ssd_mobilenet_v1_coco.html">ssd_mobilenet_v1_coco</a></li>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_public_ssd_mobilenet_v2_coco_ssd_mobilenet_v2_coco.html">ssd_mobilenet_v2_coco</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Image Classification</p>
<ul>
<li>Public Pre-Trained Models(OMZ) &gt; Classification
<ul>
<li><a href="https://docs.openvinotoolkit.org/latest/omz_models_public_mobilenet_v2_pytorch_mobilenet_v2_pytorch.html">mobilenet-v2-pytorch</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>You can find more OpenVINO™ Trained Models
<a href="https://docs.openvinotoolkit.org/latest/omz_models_intel_index.html">here</a>
To run the inference with OpenVINO™, the model format should be Intermediate
Representation(IR).
For the Caffe/TensorFlow/MXNet/Kaldi/ONNX models, please see the <a href="https://docs.openvinotoolkit.org/latest/openvino_docs_MO_DG_prepare_model_convert_model_Converting_Model.html">Model Conversion Instruction</a></p>
<p>You need to implement your own interpreter samples to support the other
OpenVINO™ Trained Models.</p>
<h2 id="model-download">Model download</h2>
<ul>
<li>
<p>Prerequisites</p>
<ul>
<li>OpenVINO™ (To install OpenVINO™, please see the
<a href="https://docs.openvinotoolkit.org/latest/openvino_docs_install_guides_installing_openvino_linux.html">OpenVINO™ Installation Instruction</a>)</li>
<li>OpenVINO™ models (To download OpenVINO™ models, please see the <a href="https://docs.openvinotoolkit.org/latest/omz_tools_downloader_README.html">Model Downloader Instruction</a>)</li>
<li>PASCAL VOC 2012 dataset (To download VOC 2012 dataset, please go <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/#devkit">VOC2012 download</a>)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># cd &lt;openvino_dir&gt;/deployment_tools/open_model_zoo/tools/downloader</span>
<span style="color:#8f5902;font-style:italic"># ./downloader.py --name &lt;model_name&gt;</span>
<span style="color:#8f5902;font-style:italic">#</span>
<span style="color:#8f5902;font-style:italic"># Examples</span>
<span style="color:#204a87">cd</span> /opt/intel/openvino/deployment_tools/open_model_zoo/tools/downloader
./downloader.py --name face-detection-0200
</code></pre></div></li>
</ul>
<h2 id="model-inference">Model inference</h2>
<ul>
<li>
<p>Prerequisites:</p>
<ul>
<li>OpenVINO™ (To install OpenVINO™, please see the
<a href="https://docs.openvinotoolkit.org/latest/openvino_docs_install_guides_installing_openvino_linux.html">OpenVINO™ Installation Instruction</a>)</li>
<li>Datumaro (To install Datumaro, please see the <a href="../../docs/user-manual/">User Manual</a>)</li>
<li>OpenVINO™ models (To download OpenVINO™ models, please see the <a href="https://docs.openvinotoolkit.org/latest/omz_tools_downloader_README.html">Model Downloader Instruction</a>)</li>
<li>PASCAL VOC 2012 dataset (To download VOC 2012 dataset, please go <a href="http://host.robots.ox.ac.uk/pascal/VOC/voc2012/#devkit">VOC2012 download</a>)</li>
</ul>
</li>
<li>
<p>To run the inference with OpenVINO™ models and the interpreter samples,
please follow the instructions below.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># source &lt;openvino_dir&gt;/bin/setupvars.sh</span>
<span style="color:#8f5902;font-style:italic"># datum create -o &lt;proj_dir&gt;</span>
<span style="color:#8f5902;font-style:italic"># datum model add -l &lt;launcher&gt; -p &lt;proj_dir&gt; --copy -- -d &lt;path_to_xml&gt; -w &lt;path_to_bin&gt; -i &lt;path_to_interpreter_script&gt;</span>
<span style="color:#8f5902;font-style:italic"># datum add path -p &lt;proj_dir&gt; -f &lt;format&gt; &lt;path_to_dataset&gt;</span>
<span style="color:#8f5902;font-style:italic"># datum model run -p &lt;proj_dir&gt; -m model-0</span>
<span style="color:#8f5902;font-style:italic">#</span>
<span style="color:#8f5902;font-style:italic"># Examples</span>
<span style="color:#8f5902;font-style:italic"># Detection&gt; ssd_mobilenet_v2_coco</span>
<span style="color:#204a87">source</span> /opt/intel/openvino/bin/setupvars.sh
<span style="color:#204a87">cd</span> datumaro/plugins/openvino_plugin
datum create -o proj_ssd_mobilenet_v2_coco_detection
datum model add -l openvino -p proj_ssd_mobilenet_v2_coco_detection --copy -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --output-layers<span style="color:#ce5c00;font-weight:bold">=</span>do_ExpandDims_conf/sigmoid <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d model/ssd_mobilenet_v2_coco.xml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -w model/ssd_mobilenet_v2_coco.bin <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i samples/ssd_mobilenet_coco_detection_interp.py
datum add path -p proj_ssd_mobilenet_v2_coco_detection -f voc VOCdevkit/
datum model run -p proj_ssd_mobilenet_v2_coco_detection -m model-0

<span style="color:#8f5902;font-style:italic"># Classification&gt; mobilenet-v2-pytorch</span>
<span style="color:#204a87">source</span> /opt/intel/openvino/bin/setupvars.sh
<span style="color:#204a87">cd</span> datumaro/plugins/openvino_plugin
datum create -o proj_mobilenet_v2_classification
datum model add -l openvino -p proj_mobilenet_v2_classification --copy -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d model/mobilenet-v2-pytorch.xml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -w model/mobilenet-v2-pytorch.bin <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i samples/mobilenet_v2_pytorch_interp.py
datum add path -p proj_mobilenet_v2_classification -f voc VOCdevkit/
datum model run -p proj_mobilenet_v2_classification -m model-0
</code></pre></div></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-05b7a8e562e0a482b29460c121776963">7 - Contribution Guide</h1>
    
	<h2 id="related-sections">Related sections:</h2>
<ul>
<li><a href="../../docs/design/">Design document</a></li>
<li><a href="../../docs/developer_manual/">Developer manual</a></li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Python (3.6+)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/openvinotoolkit/datumaro
</code></pre></div><p>Optionally, install a virtual environment (recommended):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m pip install virtualenv
python -m virtualenv venv
. venv/bin/activate
</code></pre></div><p>Then install all dependencies:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87;font-weight:bold">while</span> <span style="color:#204a87">read</span> -r p<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span> pip install <span style="color:#000">$p</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">done</span> &lt; requirements.txt
</code></pre></div><p>If you&rsquo;re working inside of a CVAT environment:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">. .env/bin/activate
<span style="color:#204a87;font-weight:bold">while</span> <span style="color:#204a87">read</span> -r p<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span> pip install <span style="color:#000">$p</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">done</span> &lt; datumaro/requirements.txt
</code></pre></div><p>Install Datumaro:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install -e /path/to/the/cloned/repo/
</code></pre></div><p><strong>Optional dependencies</strong></p>
<p>These components are only required for plugins and not installed by default:</p>
<ul>
<li>OpenVINO</li>
<li>Accuracy Checker</li>
<li>TensorFlow</li>
<li>PyTorch</li>
<li>MxNet</li>
<li>Caffe</li>
</ul>
<h2 id="usage">Usage</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum --help
python -m datumaro --help
python datumaro/ --help
python datum.py --help
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datumaro</span>
</code></pre></div><h2 id="code-style">Code style</h2>
<p>Try to be readable and consistent with the existing codebase.</p>
<p>The project mostly follows PEP8 with little differences.
Continuation lines have a standard indentation step by default,
or any other, if it improves readability. For long conditionals use 2 steps.
No trailing whitespaces, 80 characters per line.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">do_important_work</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">parameter1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parameter2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">parameter3</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">option1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">option2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">option3</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#3465a4">None</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">:</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    Optional description. Mandatory for API.
</span><span style="color:#4e9a06">    Use comments for implementation specific information, use docstrings
</span><span style="color:#4e9a06">    to give information to user / developer.
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">    Returns: status (str) - Possible values: &#39;done&#39;, &#39;failed&#39;
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>

    <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">do</span> <span style="color:#000">stuff</span> <span style="color:#ce5c00;font-weight:bold">...</span>

    <span style="color:#8f5902;font-style:italic"># Use +1 level of indentation for continuation lines</span>
    <span style="color:#000">variable_with_a_long_but_meaningful_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> \
        <span style="color:#000">function_with_a_long_but_meaningful_name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg3</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">kwarg1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">value_with_a_long_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">kwarg2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">value_with_a_long_name</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#8f5902;font-style:italic"># long conditions, loops, with etc. also use +1 level of indentation</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">condition1</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">long_condition2</span> <span style="color:#204a87;font-weight:bold">or</span> \
            <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">condition3</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">condition4</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">condition5</span> <span style="color:#204a87;font-weight:bold">or</span> \
            <span style="color:#000">condition6</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">condition7</span><span style="color:#000;font-weight:bold">:</span>

        <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">do</span> <span style="color:#000">other</span> <span style="color:#000">stuff</span> <span style="color:#ce5c00;font-weight:bold">...</span>

    <span style="color:#204a87;font-weight:bold">elif</span> <span style="color:#000">other_conditions</span><span style="color:#000;font-weight:bold">:</span>

        <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">some</span> <span style="color:#000">other</span> <span style="color:#000">things</span> <span style="color:#ce5c00;font-weight:bold">...</span>

    <span style="color:#8f5902;font-style:italic"># in some cases special formatting can improve code readability</span>
    <span style="color:#000">specific_case_formatting</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">array</span><span style="color:#000;font-weight:bold">([</span>
        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">],</span>
    <span style="color:#000;font-weight:bold">],</span> <span style="color:#000">dtype</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">int32</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">status</span>
</code></pre></div><h2 id="environment">Environment</h2>
<p>The recommended editor is VS Code with the Python language plugin.</p>
<h2 id="testing-a-idtestinga">Testing <a id="testing"></a></h2>
<p>It is expected that all Datumaro functionality is covered and checked by
unit tests. Tests are placed in the <code>tests/</code> directory. Additional
pre-generated files for tests can be stored in the <code>tests/assets/</code> directory.
CLI tests are separated from the core tests, they are stored in the
<code>tests/cli/</code> directory.</p>
<p>Currently, we use <a href="https://docs.pytest.org/"><code>pytest</code></a> for testing, but we
also compatible with <code>unittest</code>.</p>
<p>To run tests use:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pytest -v
<span style="color:#8f5902;font-style:italic"># or</span>
python -m pytest -v
</code></pre></div><h3 id="test-cases-a-idtest_case_descriptiona">Test cases <a id="Test_case_description"></a></h3>
<h3 id="test-marking-a-idtest_markinga">Test marking <a id="Test_marking"></a></h3>
<p>For better integration with CI and requirements tracking,
we use special annotations for tests.</p>
<p>A test needs to linked with a requirement it is related to. To link a
test, use:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">unittest</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">TestCase</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">.requirements</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Requirements</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mark_requirement</span>

<span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyTests</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">TestCase</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#5c35cc;font-weight:bold">@mark_requirement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_GENERAL_REQ</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_my_requirement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">do</span> <span style="color:#000">stuff</span> <span style="color:#ce5c00;font-weight:bold">...</span>
</code></pre></div><p>Such marking will apply markings from the requirement specified.
They can be overridden for a specific test:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">pytest</span>

    <span style="color:#5c35cc;font-weight:bold">@pytest.mark.proirity_low</span>
    <span style="color:#5c35cc;font-weight:bold">@mark_requirement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_GENERAL_REQ</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_my_requirement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">do</span> <span style="color:#000">stuff</span> <span style="color:#ce5c00;font-weight:bold">...</span>
</code></pre></div><h4 id="requirements-a-idrequirementsa">Requirements <a id="Requirements"></a></h4>
<p>Requirements and other links need to be added to <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/requirements.py"><code>tests/requirements.py</code></a>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">DATUM_244</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Add Snyk integration&#34;</span>
<span style="color:#000">DATUM_BUG_219</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Return format is not uniform&#34;</span>
</code></pre></div><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># Fully defined in GitHub issues:</span>
<span style="color:#5c35cc;font-weight:bold">@pytest.mark.reqids</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_244</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_333</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># And defined any other way:</span>
<span style="color:#5c35cc;font-weight:bold">@pytest.mark.reqids</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_GENERAL_REQ</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h5 id="available-annotations-for-tests-and-requirements">Available annotations for tests and requirements</h5>
<p>Markings are defined in <a href="https://github.com/openvinotoolkit/datumaro/tree/develop/tests/conftest.py"><code>tests/conftest.py</code></a>.</p>
<p><strong>A list of requirements and bugs</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@pytest.mark.requids</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_123</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#5c35cc;font-weight:bold">@pytest.mark.bugs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Requirements</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">DATUM_BUG_456</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><strong>A priority</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@pytest.mark.priority_low</span>
<span style="color:#5c35cc;font-weight:bold">@pytest.mark.priority_medium</span>
<span style="color:#5c35cc;font-weight:bold">@pytest.mark.priority_high</span>
</code></pre></div><p><strong>Component</strong>
The marking used for indication of different system components</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@pytest.mark.components</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">DatumaroComponent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Datumaro</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><strong>Skipping tests</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@pytest.mark.skip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">SkipMessages</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">NOT_IMPLEMENTED</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><strong>Parametrized runs</strong></p>
<p>Parameters are used for running the same test with different parameters e.g.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@pytest.mark.parametrize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;numpy_array, batch_size&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">np</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">zeros</span><span style="color:#000;font-weight:bold">([</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span>
<span style="color:#000;font-weight:bold">])</span>
</code></pre></div><h3 id="test-documentation-a-idtestdoca">Test documentation <a id="TestDoc"></a></h3>
<p>Tests are documented with docs strings. Test descriptions must contain
the following: sections: <code>Description</code>, <code>Expected results</code> and <code>Steps</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_can_convert_polygons_to_mask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">self</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#4e9a06">&#34;&#34;&#34;
</span><span style="color:#4e9a06">    &lt;b&gt;Description:&lt;/b&gt;
</span><span style="color:#4e9a06">    Ensure that the dataset polygon annotation can be properly converted
</span><span style="color:#4e9a06">    into dataset segmentation mask.
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">    &lt;b&gt;Expected results:&lt;/b&gt;
</span><span style="color:#4e9a06">    Dataset segmentation mask converted from dataset polygon annotation
</span><span style="color:#4e9a06">    is equal to an expected mask.
</span><span style="color:#4e9a06">
</span><span style="color:#4e9a06">    &lt;b&gt;Steps:&lt;/b&gt;
</span><span style="color:#4e9a06">    1. Prepare dataset with polygon annotation
</span><span style="color:#4e9a06">    2. Prepare dataset with expected mask segmentation mode
</span><span style="color:#4e9a06">    3. Convert source dataset to target, with conversion of annotation
</span><span style="color:#4e9a06">      from polygon to mask.
</span><span style="color:#4e9a06">    4. Verify that resulting segmentation mask is equal to the expected mask.
</span><span style="color:#4e9a06">    &#34;&#34;&#34;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bf73365d45cbeba80db44f1ed292b48e">8 - Release notes</h1>
    
	<p>Notes about the release of the developed version can be
read in the <a href="https://github.com/openvinotoolkit/datumaro/blob/develop/CHANGELOG.md">CHANGELOG.md of the develop branch</a>.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="">
    <a class="text-white" rel="noopener noreferrer" href="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" rel="noopener noreferrer" href="https://github.com/openvinotoolkit/datumaro">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center order-sm-2">
        <small class="mr-1"><a href="https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html">Privacy Policy</a></small>
        |
        <small class="mx-1"><a href="https://www.intel.com/content/www/us/en/legal/terms-of-use.html">Terms of Use</a></small>
        <br/>
        <div class="footer-disclaimer text-white ">
          <small>Intel technologies may require enabled hardware, software or service activation. // No product or component can be absolutely secure. // Your costs and results may vary. // Performance varies by use, configuration and other factors. // See our complete legal <u><a href="https://edc.intel.com/content/www/us/en/products/performance/benchmarks/overview/?r=219444055">Notices and Disclaimers</a></u>. // Intel is committed to respecting human rights and avoiding complicity in human rights abuses. See Intel’s <a href="https://www.intel.com/content/www/us/en/policy/policy-human-rights.html"><u>Global Human Rights Principles</u></a>. Intel’s products and software are intended only to be used in applications that do not cause or contribute to a violation of an internationally recognized human right.</small>
        </div>
        
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" integrity="sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK" crossorigin="anonymous"></script>





 













<script src="../../js/main.min.ee00f42d1b949caa55ccf416202998d65afac8f58091e2719c89d4fc3518550e.js" integrity="sha256-7gD0LRuUnKpVzPQWICmY1lr6yPWAkeJxnInU/DUYVQ4=" crossorigin="anonymous"></script>



<script src='../../js/prism.js'></script>



  </body>
</html>
