<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.1" /><link rel="canonical" type="text/html" href="../../../../docs/user-manual/command-reference/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="../../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../../favicons/android-192x192.png" sizes="192x192">

<title>Command reference | Dataset Management Framework</title>
<meta name="description" content=""><meta property="og:title" content="Command reference" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/user-manual/command-reference/" /><meta property="og:site_name" content="Dataset Management Framework" />

<meta itemprop="name" content="Command reference">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Command reference"/>
<meta name="twitter:description" content=""/>




<link rel="preload" href="../../../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" as="style">
<link href="../../../../scss/main.min.7739044bd284ace8b77f1ace79422fd408a2224eb69c6b8d48ef94dde2a179d5.css" rel="stylesheet" integrity="">


<script
  src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>






<link rel="stylesheet" href="../../../../css/prism.css"/>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="../../../../docs">
    <span class="navbar-logo"></span><span class="font-weight-bold">Dataset Management Framework</span>
  </a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      
      
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          
          
          
          
          
          
          <a class="nav-link" href="https://github.com/openvinotoolkit/datumaro"  ><i class='fab fa-github'></i><span>GitHub</span></a>
        </li>
      
        <li class="nav-item mr-4 mb-2 mb-lg-0" id="api">
          <a class="nav-link" href="../../../../api">API documentation</a>
        </li>
      
        <li class="nav-item dropdown mr-4 d-lg-block">
          

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
  v0.1.11
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
  
    
      <a class="dropdown-item" href="../../../../../docs/user-manual/command-reference/">develop</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.1.11/docs/user-manual/command-reference/">v0.1.11</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2/docs/user-manual/command-reference/">v0.2</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.1/docs/user-manual/command-reference/">v0.2.1</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.2/docs/user-manual/command-reference/">v0.2.2</a>
  
    
      <a class="dropdown-item" href="../../../../../v0.2.3/docs/user-manual/command-reference/">v0.2.3</a>
  
</div>

        </li>
      
      
    </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../../../offline-search-index.34baac9cd79acf0e17f6bc8829702639.json"
  data-offline-search-base-href="../../../../"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../../docs/user-manual/command-reference/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Command reference</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-a9290d217d55a8c42ce091cd380bf6d5">Convert datasets</a></li>


    
  
    
    
	
<li>2: <a href="#pg-173caf62a686687455f33853a96dbde0">Create project</a></li>


    
  
    
    
	
<li>3: <a href="#pg-5affd4a9f8d308e6d52cbac1d44c036d">Add and remove data</a></li>


    
  
    
    
	
<li>4: <a href="#pg-64028402ed2d50dec6e5481c49c890d7">Filter project</a></li>


    
  
    
    
	
<li>5: <a href="#pg-0d8ee2f09185bc2bd6a509f73215ff1b">Update project (merge)</a></li>


    
  
    
    
	
<li>6: <a href="#pg-7dbf48bb790ca34047b0c2c48fb7516c">Import project</a></li>


    
  
    
    
	
<li>7: <a href="#pg-92f13d53dbb65289b79bc4e4409decf0">Export project</a></li>


    
  
    
    
	
<li>8: <a href="#pg-a0d844d533cc20134007e1f5332a7320">Merge projects</a></li>


    
  
    
    
	
<li>9: <a href="#pg-0c02cb7f94ecdc879c944a0ec2ca01e1">Compare projects</a></li>


    
  
    
    
	
<li>10: <a href="#pg-9931fd883b9b1613bee97be12a614e7c">Obtaining project info</a></li>


    
  
    
    
	
<li>11: <a href="#pg-c2fe9ce334f91ae473c2ef7ca38d0953">Obtaining project statistics</a></li>


    
  
    
    
	
<li>12: <a href="#pg-18bbac5473774df0fffd18c506ff0423">Validate project annotations</a></li>


    
  
    
    
	
<li>13: <a href="#pg-270c588ff5ee4373633c3de0d7aca5fc">Register model</a></li>


    
  
    
    
	
<li>14: <a href="#pg-32084b6dd7a72d6f57f59963221f62cf">Run inference</a></li>


    
  
    
    
	
<li>15: <a href="#pg-70576ec909ab77bc58e96d7af0f685a7">Run inference explanation</a></li>


    
  
    
    
	
<li>16: <a href="#pg-20d9a8bc914df04488a2ff09c22fb1c2">Transform Project</a></li>


    
  

    </ul>


<div class="content">
      <blockquote>
<p><strong>Note</strong>: command invocation syntax is subject to change,
<strong>always refer to command &ndash;help output</strong></p>
</blockquote>
<p>Available CLI commands:</p>
<div class="text-center large-scheme">
<pre><code class="language-mermaid" data-lang="mermaid">flowchart LR
    d{datum}
    p((project))
    s((source))
    m((model))
    d==&gt;p
    p==create===&gt;str1([Creates a Datumaro project])
    p==import===&gt;str2([Generates a project from other project or dataset in specific format])
    p==export===&gt;str3([Saves dataset in a specific format])
    p==extract===&gt;str4([Extracts subproject by filter])
    p==merge===&gt;str5([Adds new items to project])
    p==diff===&gt;str6([Compares two projects])
    p==transform===&gt;str7([Applies specific transformation to the dataset])
    p==info===&gt;str8([Outputs valuable info])
    d==&gt;s
    s==add===&gt;str9([Adds data source by its URL])
    s==remove===&gt;str10([Remove source dataset])
    d==&gt;m
    m==add===&gt;str11([Registers model for inference])
    m==remove===&gt;str12([Removes model from project])
    m==run===&gt;str13([Executes network for inference])
    d==&gt;c(create)===&gt;str14([Calls project create])
    d==&gt;a(add)===&gt;str15([Calls source add])
    d==&gt;r(remove)===&gt;str16([Calls source remove])
    d==&gt;e(export)===&gt;str17([Calls project export])
    d==&gt;exp(explain)===&gt;str18([Runs inference explanation])
</code></pre></div>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a9290d217d55a8c42ce091cd380bf6d5">1 - Convert datasets</h1>
    
	<p>This command allows to convert a dataset from one format into another.
In fact, this command is a combination of <code>project import</code> and <code>project export</code>
and just provides a simpler way to obtain the same result when no extra options
is needed. A list of supported formats can be found in the <code>--help</code> output of
this command.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --help

datum convert <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i &lt;input path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -if &lt;input format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;output format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>extra parameters <span style="color:#204a87;font-weight:bold">for</span> output format<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: convert a VOC-like dataset to a COCO-like one:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum convert --input-format voc --input-path &lt;path/to/voc/&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output-format coco
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-173caf62a686687455f33853a96dbde0">2 - Create project</h1>
    
	<p>The command creates an empty project. Once a Project is created, there are
a few options to interact with it.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create --help

datum create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;project_dir&gt;
</code></pre></div><p>Example: create an empty project <code>my_dataset</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create -o my_dataset/
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5affd4a9f8d308e6d52cbac1d44c036d">3 - Add and remove data</h1>
    
	<p>A Project can contain a number of external Data Sources. Each Data Source
describes a way to produce dataset items. A Project combines dataset items from
all the sources and its own dataset into one composite dataset. You can manage
project sources by commands in the <code>source</code> command line context.</p>
<p>Datasets come in a wide variety of formats. Each dataset
format defines its own data structure and rules on how to
interpret the data. For example, the following data structure
is used in COCO format:</p>
<!--lint disable fenced-code-flag-->
<pre><code>/dataset/
- /images/&lt;id&gt;.jpg
- /annotations/
</code></pre><!--lint enable fenced-code-flag-->
<p>Supported formats are listed in the command help. Check <a href="../../../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum add --help
datum remove --help

datum add <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    path &lt;path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;name&gt;

datum remove <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;name&gt;
</code></pre></div><p>Example: create a project from a bunch of different annotations and images,
and generate TFrecord for TF Detection API for model training</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
<span style="color:#8f5902;font-style:italic"># &#39;default&#39; is the name of the subset below</span>
datum add path &lt;path/to/coco/instances_default.json&gt; -f coco_instances
datum add path &lt;path/to/cvat/default.xml&gt; -f cvat
datum add path &lt;path/to/voc&gt; -f voc_detection
datum add path &lt;path/to/datumaro/default.json&gt; -f datumaro
datum add path &lt;path/to/images/dir&gt; -f image_dir
datum <span style="color:#204a87">export</span> -f tf_detection_api
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-64028402ed2d50dec6e5481c49c890d7">4 - Filter project</h1>
    
	<p>This command allows to create a sub-Project from a Project. The new project
includes only items satisfying some condition. <a href="https://devhints.io/xpath">XPath</a>
is used as a query format.</p>
<p>There are several filtering modes available (<code>-m/--mode</code> parameter).
Supported modes:</p>
<ul>
<li><code>i</code>, <code>items</code></li>
<li><code>a</code>, <code>annotations</code></li>
<li><code>i+a</code>, <code>a+i</code>, <code>items+annotations</code>, <code>annotations+items</code></li>
</ul>
<p>When filtering annotations, use the <code>items+annotations</code>
mode to point that annotation-less dataset items should be
removed. To select an annotation, write an XPath that
returns <code>annotation</code> elements (see examples).</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter --help

datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;&lt;xpath filter expression&gt;&#39;</span>
</code></pre></div><p>Example: extract a dataset with only images which <code>width</code> &lt; <code>height</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;/item[image/width &lt; image/height]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only images of subset <code>train</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum project filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#4e9a06">&#39;/item[subset=&#34;train&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only large annotations of class <code>cat</code> and any
non-<code>persons</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --mode annotations -e <span style="color:#4e9a06">&#39;/item/annotation[(label=&#34;cat&#34; and area &gt; 99.5) or label!=&#34;person&#34;]&#39;</span>
</code></pre></div><p>Example: extract a dataset with only occluded annotations, remove empty images</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum filter <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m i+a -e <span style="color:#4e9a06">&#39;/item/annotation[occluded=&#34;True&#34;]&#39;</span>
</code></pre></div><p>Item representations are available with <code>--dry-run</code> parameter:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#204a87;font-weight:bold">&lt;item&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>290768<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;subset&gt;</span>minival2014<span style="color:#204a87;font-weight:bold">&lt;/subset&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;image&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;width&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/width&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;height&gt;</span>612<span style="color:#204a87;font-weight:bold">&lt;/height&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;depth&gt;</span>3<span style="color:#204a87;font-weight:bold">&lt;/depth&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/image&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>80154<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>39<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>264.59<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>150.25<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>11.199999999999989<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>42.31<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>473.87199999999956<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;annotation&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;id&gt;</span>669839<span style="color:#204a87;font-weight:bold">&lt;/id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;type&gt;</span>bbox<span style="color:#204a87;font-weight:bold">&lt;/type&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;label_id&gt;</span>41<span style="color:#204a87;font-weight:bold">&lt;/label_id&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;x&gt;</span>163.58<span style="color:#204a87;font-weight:bold">&lt;/x&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;y&gt;</span>191.75<span style="color:#204a87;font-weight:bold">&lt;/y&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;w&gt;</span>76.98999999999998<span style="color:#204a87;font-weight:bold">&lt;/w&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;h&gt;</span>73.63<span style="color:#204a87;font-weight:bold">&lt;/h&gt;</span>
    <span style="color:#204a87;font-weight:bold">&lt;area&gt;</span>5668.773699999998<span style="color:#204a87;font-weight:bold">&lt;/area&gt;</span>
  <span style="color:#204a87;font-weight:bold">&lt;/annotation&gt;</span>
  ...
<span style="color:#204a87;font-weight:bold">&lt;/item&gt;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0d8ee2f09185bc2bd6a509f73215ff1b">5 - Update project (merge)</h1>
    
	<p>This command updates items in a project from another one
(check <a href="../../../../docs/user-manual/command-reference/merge-projects/">Merge Projects</a>
for complex merging).</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge --help

datum merge <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;other project dir&gt;
</code></pre></div><p>Example: update annotations in the <code>first_project</code> with annotations
from the <code>second_project</code> and save the result as <code>merged_project</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p first_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o merged_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    second_project
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7dbf48bb790ca34047b0c2c48fb7516c">6 - Import project</h1>
    
	<p>This command creates a Project from an existing dataset.</p>
<p>Supported formats are listed in the command help. Check <a href="../../../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import --help

datum import <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i &lt;dataset_path&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;project_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt;
</code></pre></div><p>Example: create a project from COCO-like dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i /home/coco_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o /home/project_dir <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f coco
</code></pre></div><p>An <em>MS COCO</em>-like dataset should have the following directory structure:</p>
<!--lint disable fenced-code-flag-->
<pre><code>COCO/
├── annotations/
│   ├── instances_val2017.json
│   ├── instances_train2017.json
├── images/
│   ├── val2017
│   ├── train2017
</code></pre><!--lint enable fenced-code-flag-->
<p>Everything after the last <code>_</code> is considered a subset name in the COCO format.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92f13d53dbb65289b79bc4e4409decf0">7 - Export project</h1>
    
	<p>This command exports a Project as a dataset in some format.</p>
<p>Supported formats are listed in the command help. Check <a href="../../../../docs/user-manual/extending/">extending tips</a>
for information on extra format support.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> --help

datum <span style="color:#204a87">export</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f &lt;format&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>additional format parameters<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: save project as VOC-like dataset, include images, convert images to <code>PNG</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum <span style="color:#204a87">export</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p test_project <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o test_project-export <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -f voc <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- --save-images --image-ext<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;.png&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a0d844d533cc20134007e1f5332a7320">8 - Merge projects</h1>
    
	<p>This command merges items from 2 or more projects and checks annotations for
errors.</p>
<p>Spatial annotations are compared by distance and intersected, labels and
attributes are selected by voting.
Merge conflicts, missing items and annotations, other errors are saved into a <code>.json</code> file.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge --help

datum merge &lt;project dirs&gt;
</code></pre></div><p>Example: merge 4 (partially-)intersecting projects,</p>
<ul>
<li>consider voting succeeded when there are 3+ same votes</li>
<li>consider shapes intersecting when IoU &gt;= 0.6</li>
<li>check annotation groups to have <code>person</code>, <code>hand</code>, <code>head</code> and <code>foot</code>
(<code>?</code> for optional)</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum merge project1/ project2/ project3/ project4/ <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --quorum <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -iou 0.6 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --groups <span style="color:#4e9a06">&#39;person,hand?,head,foot?&#39;</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0c02cb7f94ecdc879c944a0ec2ca01e1">9 - Compare projects</h1>
    
	<p>The command compares two datasets and saves the results in the
specified directory. The current project is considered to be
&ldquo;ground truth&rdquo;.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum diff --help

datum diff &lt;other_project_dir&gt; -o &lt;save_dir&gt;
</code></pre></div><p>Example: compare a dataset with model inference</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum transform &lt;...&gt; -o inference
datum diff inference -o diff
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9931fd883b9b1613bee97be12a614e7c">10 - Obtaining project info</h1>
    
	<p>This command outputs project status information.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum info --help

datum info <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt;
</code></pre></div><p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum info -p /test_project

Project:
  name: test_project
  location: /test_project
Sources:
  <span style="color:#204a87">source</span> <span style="color:#4e9a06">&#39;instances_minival2014&#39;</span>:
    format: coco_instances
    url: /coco_like/annotations/instances_minival2014.json
Dataset:
  length: <span style="color:#0000cf;font-weight:bold">5000</span>
  categories: label
    label:
      count: <span style="color:#0000cf;font-weight:bold">80</span>
      labels: person, bicycle, car, motorcycle <span style="color:#ce5c00;font-weight:bold">(</span>and <span style="color:#0000cf;font-weight:bold">76</span> more<span style="color:#ce5c00;font-weight:bold">)</span>
  subsets: minival2014
    subset <span style="color:#4e9a06">&#39;minival2014&#39;</span>:
      length: <span style="color:#0000cf;font-weight:bold">5000</span>
      categories: label
        label:
          count: <span style="color:#0000cf;font-weight:bold">80</span>
          labels: person, bicycle, car, motorcycle <span style="color:#ce5c00;font-weight:bold">(</span>and <span style="color:#0000cf;font-weight:bold">76</span> more<span style="color:#ce5c00;font-weight:bold">)</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c2fe9ce334f91ae473c2ef7ca38d0953">11 - Obtaining project statistics</h1>
    
	<p>This command computes various project statistics, such as:</p>
<ul>
<li>image mean and std. dev.</li>
<li>class and attribute balance</li>
<li>mask pixel balance</li>
<li>segment area distribution</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats --help

datum stats <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt;
</code></pre></div><p>Example:</p>
<details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum stats -p test_project

<span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;annotations&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;labels&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;attributes&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;gender&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 358,
                    <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                        <span style="color:#4e9a06">&#34;female&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            149,
                            0.41620111731843573
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;male&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            209,
                            0.5837988826815642
                        <span style="color:#ce5c00;font-weight:bold">]</span>
                    <span style="color:#ce5c00;font-weight:bold">}</span>,
                    <span style="color:#4e9a06">&#34;values count&#34;</span>: 2,
                    <span style="color:#4e9a06">&#34;values present&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                        <span style="color:#4e9a06">&#34;female&#34;</span>,
                        <span style="color:#4e9a06">&#34;male&#34;</span>
                    <span style="color:#ce5c00;font-weight:bold">]</span>
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#4e9a06">&#34;view&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 340,
                    <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                        <span style="color:#4e9a06">&#34;__undefined__&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            4,
                            0.011764705882352941
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;front&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            54,
                            0.1588235294117647
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;left&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            14,
                            0.041176470588235294
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;rear&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            235,
                            0.6911764705882353
                        <span style="color:#ce5c00;font-weight:bold">]</span>,
                        <span style="color:#4e9a06">&#34;right&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                            33,
                            0.09705882352941177
                        <span style="color:#ce5c00;font-weight:bold">]</span>
                    <span style="color:#ce5c00;font-weight:bold">}</span>,
                    <span style="color:#4e9a06">&#34;values count&#34;</span>: 5,
                    <span style="color:#4e9a06">&#34;values present&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                        <span style="color:#4e9a06">&#34;__undefined__&#34;</span>,
                        <span style="color:#4e9a06">&#34;front&#34;</span>,
                        <span style="color:#4e9a06">&#34;left&#34;</span>,
                        <span style="color:#4e9a06">&#34;rear&#34;</span>,
                        <span style="color:#4e9a06">&#34;right&#34;</span>
                    <span style="color:#ce5c00;font-weight:bold">]</span>
                <span style="color:#ce5c00;font-weight:bold">}</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>,
            <span style="color:#4e9a06">&#34;count&#34;</span>: 2038,
            <span style="color:#4e9a06">&#34;distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;car&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    340,
                    0.16683022571148184
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;cyclist&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    194,
                    0.09519136408243375
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;head&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    354,
                    0.17369970559371933
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;ignore&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    100,
                    0.04906771344455348
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;left_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    238,
                    0.11678115799803729
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;person&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    358,
                    0.17566241413150147
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;right_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    77,
                    0.037782139352306184
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;road_arrows&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    326,
                    0.15996074582924436
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;traffic_sign&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    51,
                    0.025024533856722278
                <span style="color:#ce5c00;font-weight:bold">]</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;segments&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;area distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 1318,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 11425.1,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 0.0,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.9627465303140978
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 1,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 22850.2,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 11425.1,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0007304601899196494
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 34275.3,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 22850.2,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 45700.4,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 34275.3,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 57125.5,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 45700.4,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 68550.6,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 57125.5,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 79975.7,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 68550.6,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 91400.8,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 79975.7,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 0,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 102825.90000000001,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 91400.8,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.0
                <span style="color:#ce5c00;font-weight:bold">}</span>,
                <span style="color:#ce5c00;font-weight:bold">{</span>
                    <span style="color:#4e9a06">&#34;count&#34;</span>: 50,
                    <span style="color:#4e9a06">&#34;max&#34;</span>: 114251.0,
                    <span style="color:#4e9a06">&#34;min&#34;</span>: 102825.90000000001,
                    <span style="color:#4e9a06">&#34;percent&#34;</span>: 0.036523009495982466
                <span style="color:#ce5c00;font-weight:bold">}</span>
            <span style="color:#ce5c00;font-weight:bold">]</span>,
            <span style="color:#4e9a06">&#34;avg. area&#34;</span>: 5411.624543462382,
            <span style="color:#4e9a06">&#34;pixel distribution&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
                <span style="color:#4e9a06">&#34;car&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    13655,
                    0.0018431496518735067
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;cyclist&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    939005,
                    0.12674674030446592
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;head&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;ignore&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    5501200,
                    0.7425510702956085
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;left_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;person&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    954654,
                    0.12885903974805205
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;right_hand&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;road_arrows&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>,
                <span style="color:#4e9a06">&#34;traffic_sign&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
                    0,
                    0.0
                <span style="color:#ce5c00;font-weight:bold">]</span>
            <span style="color:#ce5c00;font-weight:bold">}</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;annotations by type&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;bbox&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">548</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;caption&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;label&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;mask&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;points&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">669</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;polygon&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">821</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#34;polyline&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#34;count&#34;</span>: <span style="color:#0000cf;font-weight:bold">0</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;annotations count&#34;</span>: 2038,
    <span style="color:#4e9a06">&#34;dataset&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;image mean&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
            107.06903686941979,
            79.12831698580979,
            52.95829558185416
        <span style="color:#ce5c00;font-weight:bold">]</span>,
        <span style="color:#4e9a06">&#34;image std&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
            49.40237673503467,
            43.29600731496902,
            35.47373007603151
        <span style="color:#ce5c00;font-weight:bold">]</span>,
        <span style="color:#4e9a06">&#34;images count&#34;</span>: <span style="color:#0000cf;font-weight:bold">100</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#34;images count&#34;</span>: 100,
    <span style="color:#4e9a06">&#34;subsets&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{}</span>,
    <span style="color:#4e9a06">&#34;unannotated images&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#4e9a06">&#34;img00051&#34;</span>,
        <span style="color:#4e9a06">&#34;img00052&#34;</span>,
        <span style="color:#4e9a06">&#34;img00053&#34;</span>,
        <span style="color:#4e9a06">&#34;img00054&#34;</span>,
        <span style="color:#4e9a06">&#34;img00055&#34;</span>,
    <span style="color:#ce5c00;font-weight:bold">]</span>,
    <span style="color:#4e9a06">&#34;unannotated images count&#34;</span>: 5,
    <span style="color:#4e9a06">&#34;unique images count&#34;</span>: 97,
    <span style="color:#4e9a06">&#34;repeating images count&#34;</span>: 3,
    <span style="color:#4e9a06">&#34;repeating images&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00057&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00058&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00059&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00060&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
        <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#4e9a06">&#34;img00061&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>, <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;img00062&#34;</span>, <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)]</span>,
    <span style="color:#ce5c00;font-weight:bold">]</span>,
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-18bbac5473774df0fffd18c506ff0423">12 - Validate project annotations</h1>
    
	<p>This command inspects annotations with respect to the task type
and stores the result in JSON file.</p>
<p>The task types supported are <code>classification</code>, <code>detection</code>, and <code>segmentation</code>.</p>
<p>The validation result contains</p>
<ul>
<li><code>annotation statistics</code> based on the task type</li>
<li><code>validation reports</code>, such as
<ul>
<li>items not having annotations</li>
<li>items having undefined annotations</li>
<li>imbalanced distribution in class/attributes</li>
<li>too small or large values</li>
</ul>
</li>
<li><code>summary</code></li>
</ul>
<p>Usage:</p>
<ul>
<li>There are five configurable parameters for validation
<ul>
<li><code>few_samples_thr</code> : threshold for giving a warning for minimum number of
samples per class</li>
<li><code>imbalance_ratio_thr</code> : threshold for giving imbalance data warning</li>
<li><code>far_from_mean_thr</code> : threshold for giving a warning that data is far
from mean</li>
<li><code>dominance_ratio_thr</code> : threshold for giving a warning bounding box
imbalance</li>
<li><code>topk_bins</code> : ratio of bins with the highest number of data to total bins
in the histogram</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate --help

datum validate -p &lt;project dir&gt; -t &lt;task_type&gt; -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -fs &lt;few_samples_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -ir &lt;imbalance_ratio_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;far_from_mean_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -dr &lt;dominance_ratio_thr&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k &lt;topk_bins&gt;
</code></pre></div><p>Example : give warning when imbalance ratio of data with classification task
over 40</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum validate -p prj-cls -t classification -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -ir <span style="color:#0000cf;font-weight:bold">40</span>
</code></pre></div><p>Here is the list of validation items(a.k.a. anomaly types).</p>
<table>
<thead>
<tr>
<th>Anomaly Type</th>
<th>Description</th>
<th>Task Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>MissingLabelCategories</td>
<td>Metadata (ex. LabelCategories) should be defined</td>
<td>common</td>
</tr>
<tr>
<td>MissingAnnotation</td>
<td>No annotation found for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MissingAttribute</td>
<td>An attribute key is missing for an Item</td>
<td>common</td>
</tr>
<tr>
<td>MultiLabelAnnotations</td>
<td>Item needs a single label</td>
<td>classification</td>
</tr>
<tr>
<td>UndefinedLabel</td>
<td>A label not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>UndefinedAttribute</td>
<td>An attribute not defined in the metadata is found for an item</td>
<td>common</td>
</tr>
<tr>
<td>LabelDefinedButNotFound</td>
<td>A label is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>AttributeDefinedButNotFound</td>
<td>An attribute is defined, but not found actually</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneLabel</td>
<td>The dataset consists of only label</td>
<td>common</td>
</tr>
<tr>
<td>OnlyOneAttributeValue</td>
<td>The dataset consists of only attribute value</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInLabel</td>
<td>The number of samples in a label might be too low</td>
<td>common</td>
</tr>
<tr>
<td>FewSamplesInAttribute</td>
<td>The number of samples in an attribute might be too low</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedLabels</td>
<td>There is an imbalance in the label distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedAttribute</td>
<td>There is an imbalance in the attribute distribution</td>
<td>common</td>
</tr>
<tr>
<td>ImbalancedDistInLabel</td>
<td>Values (ex. bbox width) are not evenly distributed for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>ImbalancedDistInAttribute</td>
<td>Values (ex. bbox width) are not evenly distributed for an attribute</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>NegativeLength</td>
<td>The width or height of bounding box is negative</td>
<td>detection</td>
</tr>
<tr>
<td>InvalidValue</td>
<td>There&rsquo;s invalid (ex. inf, nan) value for bounding box info.</td>
<td>detection</td>
</tr>
<tr>
<td>FarFromLabelMean</td>
<td>An annotation has an too small or large value than average for a label</td>
<td>detection, segmentation</td>
</tr>
<tr>
<td>FarFromAttrMean</td>
<td>An annotation has an too small or large value than average for an attribute</td>
<td>detection, segmentation</td>
</tr>
</tbody>
</table>
<p>Validation Result Format:</p>
<details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;statistics&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#8f5902;font-style:italic">## common statistics</span>
        <span style="color:#4e9a06">&#39;label_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_labels&#39;</span>: &lt;dict&gt;,   <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;count:int&gt;</span>
            <span style="color:#4e9a06">&#39;undefined_labels&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;count&#39;: &lt;int&gt;,</span>
            <span style="color:#8f5902;font-style:italic">#     &#39;items_with_undefined_label&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;attribute_distribution&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
            <span style="color:#4e9a06">&#39;defined_attributes&#39;</span>: &lt;dict&gt;,
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_missing_attribute&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
            <span style="color:#4e9a06">&#39;undefined_attributes&#39;</span>: &lt;dict&gt;
            <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: {</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;distribution&#39;: {&lt;attr_value:str&gt;: &lt;count:int&gt;, },</span>
            <span style="color:#8f5902;font-style:italic">#         &#39;items_with_undefined_attr&#39;: [&lt;item_key&gt;, ]</span>
            <span style="color:#8f5902;font-style:italic">#     }</span>
            <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#ce5c00;font-weight:bold">}</span>,
        <span style="color:#4e9a06">&#39;total_ann_count&#39;</span>: &lt;int&gt;,
        <span style="color:#4e9a06">&#39;items_missing_annotation&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for classification task</span>
        <span style="color:#4e9a06">&#39;items_with_multiple_labels&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [&lt;item_key&gt;, ]</span>

        <span style="color:#8f5902;font-style:italic">## statistics for detection task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;x&#39;, &#39;y&#39;, &#39;width&#39;, &#39;height&#39;,</span>
        <span style="color:#8f5902;font-style:italic">#               &#39;area(wxh)&#39;, &#39;ratio(w/h)&#39;, &#39;short&#39;, &#39;long&#39;</span>
        <span style="color:#8f5902;font-style:italic"># - &#39;short&#39; is min(w,h) and &#39;long&#39; is max(w,h).</span>
        <span style="color:#4e9a06">&#39;items_with_negative_length&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: { &lt;ann_id:int&gt;: { &lt;&#39;width&#39;|&#39;height&#39;&gt;: &lt;value&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;bbox_template&gt;</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {&lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;bbox_template&gt;, }, }</span>
        <span style="color:#4e9a06">&#39;bbox_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;bbox count:int&gt;</span>

        <span style="color:#8f5902;font-style:italic">## statistics for segmentation task</span>
        <span style="color:#4e9a06">&#39;items_with_invalid_value&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: [ &lt;property:str&gt;, ], }</span>
        <span style="color:#8f5902;font-style:italic"># - properties: &#39;area&#39;, &#39;width&#39;, &#39;height&#39;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_label&#39;</span>: &lt;dict&gt;, <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: &lt;mask_template&gt;</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_attribute&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &lt;label:str&gt;: {</span>
        <span style="color:#8f5902;font-style:italic">#     &lt;attribute:str&gt;: { &lt;attr_value&gt;: &lt;mask_template&gt;, }</span>
        <span style="color:#8f5902;font-style:italic"># }</span>
        <span style="color:#4e9a06">&#39;mask_distribution_in_dataset_item&#39;</span>: &lt;dict&gt;,
        <span style="color:#8f5902;font-style:italic"># &#39;&lt;item_key&gt;&#39;: &lt;mask/polygon count: int&gt;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>,
    <span style="color:#4e9a06">&#39;validation_reports&#39;</span>: &lt;list&gt;, <span style="color:#8f5902;font-style:italic"># [ &lt;validation_error_format&gt;, ]</span>
    <span style="color:#8f5902;font-style:italic"># validation_error_format = {</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;anomaly_type&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;description&#39;: &lt;str&gt;,</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;severity&#39;: &lt;str&gt;, # &#39;warning&#39; or &#39;error&#39;</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;item_id&#39;: &lt;str&gt;,  # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic">#     &#39;subset&#39;: &lt;str&gt;,   # optional, when it is related to a DatasetItem</span>
    <span style="color:#8f5902;font-style:italic"># }</span>
    <span style="color:#4e9a06">&#39;summary&#39;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;errors&#39;</span>: &lt;count: int&gt;,
        <span style="color:#4e9a06">&#39;warnings&#39;</span>: &lt;count: int&gt;
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">}</span>

</code></pre></div><p><code>item_key</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">item_key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">DatasetItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">subset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p><code>bbox_template</code> and <code>mask_template</code> are defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">bbox_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;area(wxh)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;ratio(w/h)&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;short&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># short = min(w, h)</span>
    <span style="color:#4e9a06">&#39;long&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>   <span style="color:#8f5902;font-style:italic"># long = max(w, h)</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000">mask_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;area&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;width&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;height&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">numerical_stat_template</span><span style="color:#ce5c00;font-weight:bold">&gt;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><code>numerical_stat_template</code> is defined as,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">numerical_stat_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#39;items_far_from_mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">dict</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#8f5902;font-style:italic"># {&#39;&lt;item_key&gt;&#39;: {&lt;ann_id:int&gt;: &lt;value:float&gt;, }, }</span>
    <span style="color:#4e9a06">&#39;mean&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;stdev&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;min&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;max&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;median&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">float</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#39;histogram&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#39;bins&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span>   <span style="color:#8f5902;font-style:italic"># [&lt;float&gt;, ]</span>
        <span style="color:#4e9a06">&#39;counts&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">list</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#8f5902;font-style:italic"># [&lt;int&gt;, ]</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></details>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-270c588ff5ee4373633c3de0d7aca5fc">13 - Register model</h1>
    
	<p>Supported models:</p>
<ul>
<li>OpenVINO</li>
<li>Custom models via custom <code>launchers</code></li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model add --help
</code></pre></div><p>Example: register an OpenVINO model</p>
<p>A model consists of a graph description and weights. There is also a script
used to convert model outputs to internal data structures.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create
datum model add <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -n &lt;model_name&gt; -l open_vino -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -d &lt;path_to_xml&gt; -w &lt;path_to_bin&gt; -i &lt;path_to_interpretation_script&gt;
</code></pre></div><p>Interpretation script for an OpenVINO detection model (<code>convert.py</code>):
You can find OpenVINO model interpreter samples in
<code>datumaro/plugins/openvino/samples</code> (<a href="../../../../docs/plugins/openvino_plugin/">instruction</a>).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span>
<span style="color:#000">conf_thresh</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.1</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">conf_thresh</span><span style="color:#000;font-weight:bold">:</span>
                <span style="color:#204a87;font-weight:bold">continue</span>

            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">get_categories</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#8f5902;font-style:italic"># Optionally, provide output categories - label map etc.</span>
    <span style="color:#8f5902;font-style:italic"># Example:</span>
    <span style="color:#000">label_categories</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LabelCategories</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;person&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">label_categories</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;car&#39;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">AnnotationType</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">label_categories</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-32084b6dd7a72d6f57f59963221f62cf">14 - Run inference</h1>
    
	<p>This command applies model to dataset images and produces a new project.</p>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum model run --help

datum model run <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;model_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;save_dir&gt;
</code></pre></div><p>Example: launch inference on a dataset</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum import &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum model run -m mymodel -o inference
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-70576ec909ab77bc58e96d7af0f685a7">15 - Run inference explanation</h1>
    
	<p>Runs an explainable AI algorithm for a model.</p>
<p>This tool is supposed to help an AI developer to debug a model and a dataset.
Basically, it executes inference and tries to find problems in the trained
model - determine decision boundaries and belief intervals for the classifier.</p>
<p>Currently, the only available algorithm is RISE (<a href="https://arxiv.org/pdf/1806.07421.pdf">article</a>),
which runs inference and then re-runs a model multiple times on each
image to produce a heatmap of activations for each output of the
first inference. As a result, we obtain few heatmaps, which
shows, how image pixels affected the inference result. This algorithm doesn&rsquo;t
require any special information about the model, but it requires the model to
return all the outputs and confidences. The algorithm only supports
classification and detection models.</p>
<p>The following use cases available:</p>
<ul>
<li>RISE for classification</li>
<li>RISE for object detection</li>
</ul>
<p>Usage:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum explain --help

datum explain <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m &lt;model_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;save_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t &lt;target&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;method&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    &lt;method_params&gt;
</code></pre></div><p>Example: run inference explanation on a single image with visualization</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum create &lt;...&gt;
datum model add mymodel &lt;...&gt;
datum explain -t image.png -m mymodel <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    rise --max-samples <span style="color:#0000cf;font-weight:bold">1000</span> --progressive
</code></pre></div><blockquote>
<p>Note: this algorithm requires the model to return
<em>all</em> (or a <em>reasonable</em> amount) the outputs and confidences unfiltered,
i.e. all the <code>Label</code> annotations for classification models and
all the <code>Bbox</code>es for detection models.
You can find examples of the expected model outputs in <a href="https://github.com/openvinotoolkit/datumaro/blob/develop/tests/test_RISE.py"><code>tests/test_RISE.py</code></a></p>
</blockquote>
<p>For OpenVINO models the output processing script would look like this:</p>
<p>Classification scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.util.annotation_util</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">softmax</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, logits, shape = (N, n_classes)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">confs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">softmax</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">])</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">conf</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">confs</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conf</span><span style="color:#000;font-weight:bold">)})</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div><p>Object Detection scenario:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datumaro.components.extractor</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#8f5902;font-style:italic"># return a significant number of output boxes to make multiple runs</span>
<span style="color:#8f5902;font-style:italic"># statistically correct and meaningful</span>
<span style="color:#000">max_det</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1000</span>

<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">process_outputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
    <span style="color:#8f5902;font-style:italic"># inputs = model input, array or images, shape = (N, C, H, W)</span>
    <span style="color:#8f5902;font-style:italic"># outputs = model output, shape = (N, 1, K, 7)</span>
    <span style="color:#8f5902;font-style:italic"># results = conversion result, [ [ Annotation, ... ], ... ]</span>
    <span style="color:#000">results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#204a87">input</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">output</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">zip</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">outputs</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">shape</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">detections</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">]</span>
        <span style="color:#000">image_results</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[]</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">det</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">detections</span><span style="color:#000;font-weight:bold">):</span>
            <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">conf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">])</span>
            <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">w</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_width</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_width</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">h</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">det</span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">input_height</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">input_height</span><span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000">image_results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Bbox</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">h</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#000">label</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">attributes</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;score&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">conf</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">))</span>

            <span style="color:#000">results</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">image_results</span><span style="color:#000;font-weight:bold">[:</span><span style="color:#000">max_det</span><span style="color:#000;font-weight:bold">])</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">results</span>
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20d9a8bc914df04488a2ff09c22fb1c2">16 - Transform Project</h1>
    
	<p>This command allows to modify images or annotations in a project all at once.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform --help

datum transform <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -p &lt;project_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o &lt;output_dir&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t &lt;transform_name&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -- <span style="color:#ce5c00;font-weight:bold">[</span>extra transform options<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Example: split a dataset randomly to <code>train</code> and <code>test</code> subsets, ratio is 2:1</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t random_split -- --subset train:.67 --subset test:.33
</code></pre></div><p>Example: split a dataset in task-specific manner. The tasks supported are
classification, detection, segmentation and re-identification.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t classification --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t detection --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t segmentation --subset train:.5 --subset val:.2 --subset test:.3

datum transform -t split -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -t reid --subset train:.5 --subset val:.2 --subset test:.3 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --query .5
</code></pre></div><p>Example: convert polygons to masks, masks to boxes etc.:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t boxes_to_masks
datum transform -t masks_to_polygons
datum transform -t polygons_to_masks
datum transform -t shapes_to_boxes
</code></pre></div><p>Example: remap dataset labels, <code>person</code> to <code>car</code> and <code>cat</code> to <code>dog</code>,
keep <code>bus</code>, remove others</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t remap_labels -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -l person:car -l bus:bus -l cat:dog <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --default delete
</code></pre></div><p>Example: rename dataset items by a regular expression</p>
<ul>
<li>Replace <code>pattern</code> with <code>replacement</code></li>
<li>Remove <code>frame_</code> from item ids</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|pattern|replacement|&#39;</span>
datum transform -t rename -- -e <span style="color:#4e9a06">&#39;|frame_(\d+)|\\1|&#39;</span>
</code></pre></div><p>Example: sampling dataset items as many as the number of target samples with
sampling method entered by the user, divide into <code>sampled</code> and <code>unsampled</code>
subsets</p>
<ul>
<li>There are five methods of sampling the m option.
<ul>
<li><code>topk</code>: Return the k with high uncertainty data</li>
<li><code>lowk</code>: Return the k with low uncertainty data</li>
<li><code>randk</code>: Return the random k data</li>
<li><code>mixk</code>: Return half to topk method and the rest to lowk method</li>
<li><code>randtopk</code>: First, select 3 times the number of k randomly, and return
the topk among them.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t sampler -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -a entropy <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -i train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -o sampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -u unsampled <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -m topk <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k <span style="color:#0000cf;font-weight:bold">20</span>
</code></pre></div><p>Example : control number of outputs to 100 after NDR</p>
<ul>
<li>There are two methods in NDR e option
<ul>
<li><code>random</code>: sample from removed data randomly</li>
<li><code>similarity</code>: sample from removed data with ascending</li>
</ul>
</li>
<li>There are two methods in NDR u option
<ul>
<li><code>uniform</code>: sample data with uniform distribution</li>
<li><code>inverse</code>: sample data with reciprocal of the number</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">datum transform -t ndr -- <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -w train <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -a gradient <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -k <span style="color:#0000cf;font-weight:bold">100</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e random <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -u uniform
</code></pre></div>
</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="">
    <a class="text-white" rel="noopener noreferrer" href="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" rel="noopener noreferrer" href="https://github.com/openvinotoolkit/datumaro">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center order-sm-2">
        <small class="mr-1"><a href="https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html">Privacy Policy</a></small>
        |
        <small class="mx-1"><a href="https://www.intel.com/content/www/us/en/legal/terms-of-use.html">Terms of Use</a></small>
        <br/>
        <div class="footer-disclaimer text-white ">
          <small>Intel technologies may require enabled hardware, software or service activation. // No product or component can be absolutely secure. // Your costs and results may vary. // Performance varies by use, configuration and other factors. // See our complete legal <u><a href="https://edc.intel.com/content/www/us/en/products/performance/benchmarks/overview/?r=219444055">Notices and Disclaimers</a></u>. // Intel is committed to respecting human rights and avoiding complicity in human rights abuses. See Intel’s <a href="https://www.intel.com/content/www/us/en/policy/policy-human-rights.html"><u>Global Human Rights Principles</u></a>. Intel’s products and software are intended only to be used in applications that do not cause or contribute to a violation of an internationally recognized human right.</small>
        </div>
        
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" integrity="sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK" crossorigin="anonymous"></script>





 













<script src="../../../../js/main.min.ee00f42d1b949caa55ccf416202998d65afac8f58091e2719c89d4fc3518550e.js" integrity="sha256-7gD0LRuUnKpVzPQWICmY1lr6yPWAkeJxnInU/DUYVQ4=" crossorigin="anonymous"></script>



<script src='../../../../js/prism.js'></script>



  </body>
</html>
